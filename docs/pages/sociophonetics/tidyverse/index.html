<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joey Stanley">
<meta name="dcterms.date" content="2017-09-04">

<title>Introduction to Tidyverse – Joey Stanley</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=350348361"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '350348361', { 'anonymize_ip': true});
</script>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,200..900;1,200..900&amp;family=Noto+Music&amp;family=Noto+Sans+Display:ital,wght@0,100..900;1,100..900&amp;family=Noto+Sans+Math&amp;family=Noto+Sans+Mono:wght@100..900&amp;family=Noto+Sans:ital,wght@0,100..900;1,100..900&amp;family=Noto+Serif+Display:ital,wght@0,100..900;1,100..900&amp;family=Noto+Serif:ital,wght@0,100..900;1,100..900&amp;display=swap" rel="stylesheet">


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title"><span id="name">Joey Stanley</span><br><span id="tagline">assistant professor, linguistics</span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">About Me <em>who am I?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../cv/index.html"> 
<span class="menu-text">CV <em>what have I done?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../research/index.html"> 
<span class="menu-text">Research <em>what do I research?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../teaching.html"> 
<span class="menu-text">Teaching <em>what do I teach?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../pages/idiolect"> 
<span class="menu-text">Idiolect <em>what do I sound like?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog/index.html"> 
<span class="menu-text">Blog <em>what’s going on?</em></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:joey_stanley@byu.edu"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-list" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-list" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-list">    
        <li>
    <a class="dropdown-item" href="https://bsky.app/profile/joeystanley.com">
 <span class="dropdown-text"><i class="fa-brands fa-bluesky" aria-label="bluesky"></i> Bluesky</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://twitter.com/joey_stan"><i class="bi bi-twitter" role="img">
</i> 
 <span class="dropdown-text">Twitter</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://scholar.google.com/citations?user=61pJV_YAAAAJ&amp;hl=en&amp;oi=sra"><i class="bi bi-mortarboard-fill" role="img">
</i> 
 <span class="dropdown-text">Google Scholar</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/JoeyStanley/joeystanley_new"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Github</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../joeystanley.com/feed.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="dropdown-text">RSS feed</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#what-is-the-tidyverse" id="toc-what-is-the-tidyverse" class="nav-link" data-scroll-target="#what-is-the-tidyverse">What is the tidyverse?</a></li>
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  </ul></li>
  <li><a href="#getting-data-in-and-out-of-r" id="toc-getting-data-in-and-out-of-r" class="nav-link" data-scroll-target="#getting-data-in-and-out-of-r">Getting data in and out of R</a>
  <ul class="collapse">
  <li><a href="#reading-in-a-.csv-file" id="toc-reading-in-a-.csv-file" class="nav-link" data-scroll-target="#reading-in-a-.csv-file">Reading in a .csv file</a></li>
  <li><a href="#reading-in-an-excel-file" id="toc-reading-in-an-excel-file" class="nav-link" data-scroll-target="#reading-in-an-excel-file">Reading in an Excel file</a></li>
  <li><a href="#reading-in-a-.txt-file" id="toc-reading-in-a-.txt-file" class="nav-link" data-scroll-target="#reading-in-a-.txt-file">Reading in a .txt file</a></li>
  <li><a href="#saving-r-data-to-your-computer" id="toc-saving-r-data-to-your-computer" class="nav-link" data-scroll-target="#saving-r-data-to-your-computer">Saving R data to your computer</a></li>
  </ul></li>
  <li><a href="#the-select-function" id="toc-the-select-function" class="nav-link" data-scroll-target="#the-select-function">The <code>select</code> function</a>
  <ul class="collapse">
  <li><a href="#reorder-columns" id="toc-reorder-columns" class="nav-link" data-scroll-target="#reorder-columns">Reorder columns</a></li>
  <li><a href="#tangent-the-pipe" id="toc-tangent-the-pipe" class="nav-link" data-scroll-target="#tangent-the-pipe">Tangent: <code>%&gt;%</code> (“the pipe”)</a></li>
  <li><a href="#removing-columns" id="toc-removing-columns" class="nav-link" data-scroll-target="#removing-columns">Removing columns</a></li>
  <li><a href="#additional-select-tricks" id="toc-additional-select-tricks" class="nav-link" data-scroll-target="#additional-select-tricks">Additional <code>select</code> tricks</a></li>
  </ul></li>
  <li><a href="#the-mutate-function" id="toc-the-mutate-function" class="nav-link" data-scroll-target="#the-mutate-function">The <code>mutate</code> function</a>
  <ul class="collapse">
  <li><a href="#creating-new-columns" id="toc-creating-new-columns" class="nav-link" data-scroll-target="#creating-new-columns">Creating new columns</a></li>
  <li><a href="#modifying-columns" id="toc-modifying-columns" class="nav-link" data-scroll-target="#modifying-columns">Modifying columns</a></li>
  </ul></li>
  <li><a href="#miscellaneous-functions" id="toc-miscellaneous-functions" class="nav-link" data-scroll-target="#miscellaneous-functions">Miscellaneous functions</a>
  <ul class="collapse">
  <li><a href="#the-filter-function" id="toc-the-filter-function" class="nav-link" data-scroll-target="#the-filter-function">The <code>filter</code> function</a></li>
  <li><a href="#changing-column-names" id="toc-changing-column-names" class="nav-link" data-scroll-target="#changing-column-names">Changing column names</a></li>
  </ul></li>
  <li><a href="#final-remarks" id="toc-final-remarks" class="nav-link" data-scroll-target="#final-remarks">Final remarks</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to Tidyverse</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joey Stanley </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 4, 2017</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">January 9, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is Part 3 of a <a href="../../../pages/sociophonetics">series on sociophonetic data analysis</a>.</p>
</div>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Working with data can be super frustrating. I recall a time in grad school when I spent something like 6–8 hours to get my data transformed into the format I wanted, and that was using a super clunky workaround. Soon after that, I learned about a set of packages called “the tidyverse.” More importantly, I read the online book, <em>R for Data Science</em> written by Garrett Grolemund and Hadley Wickham (freely available at <a href="http://r4ds.had.co.nz">http://r4ds.had.co.nz</a>) that explains how to use these packages and the functions within them. This has completely changed how I work in R and allows me to do some really power data transformation with ease.</p>
<p>In the next section, I discuss a little bit about what the tidyverse is, but if you want to get to the good stuff, feel free to skip it.</p>
<section id="what-is-the-tidyverse" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-tidyverse">What is the tidyverse?</h3>
<p>According to its website (<a href="http://tidyverse.org">tidyverse.org</a>), “The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying philosophy and common APIs.” Let’s break that down.</p>
<ol type="1">
<li><p><em>It’s a collection of R packages</em>—When you install the <code>tidyverse</code> package, all you’re doing is installing several other packages that fall its umbrella. Some of the packages that are part of <code>tidyverse</code> include <code>dplyr</code>, <code>tidyr</code>, and <code>ggplot2</code>, which are among the most popular R packages ever. There are others that are super useful like <code>readxl</code> that are part of the tidyverse, but don’t come installed automatically with the <code>tidyverse</code> package, so you’ll have to load them explicitly.</p></li>
<li><p><em>They share an underlying philosophy and common APIs</em>—This is one of the reasons that makes the tidyverse so great: all the packages seamlessly integrate and work together harmoniously. There’s nothing worse than having to modify your dataframe in some way in order to get it to work for some function and then modify it again to get it work with some other function in another package. With the tidyverse, you can jump from one of its packages to another and send data around and nothing will ever get mad at you.</p></li>
<li><p><em>They are designed for data science</em>—A lot of what R can do is for statistical modeling on your data. Tidyverse isn’t heavy on statistics, but it can help you every step of the way otherwise. You can read in your data, make any modifications, and visualize it with no problem. When it actually comes to fancy statistical models though, you’ll have to find more specialized packages. This is not to say that the tidyverse is deficient in any way: reshaping and tidying your data is no small feat and the tidyverse makes this a <em>lot</em> easier.</p></li>
<li><p><em>They are opinionated</em>—The primary author of many authors these packages, Hadley Wickham, is very open about how they are created, and says that this is just <em>one</em> way to work with data in R. You’re certainly welcome to work with your data another way, but using the tidyverse is not the only solution: it’s just one opinion of how it should be best done.</p></li>
</ol>
<p>There’s a ridiculous amount to cover when teaching the tidyverse. Just <code>ggplot2</code> alone would take dozens of workshops to cover everything. The possibilities are nearly endless and I obviously can’t teach you everything in just a short online tutorial. To give you an idea of what functions in the tidyverse can do, here’s a brief summary of <em>some</em> of its packages (all written by Hadley Wickham with addition authors in parentheses):</p>
<ol type="1">
<li><p><code>ggplot2</code> is a very popular suite for visualizing data. Unlike other visualizations you might do, <code>ggplot2</code> allows for pretty much infinite customization in your plots, which is really handy if you have nit-picky details you want to control.</p></li>
<li><p><code>dplyr</code> (Romain Francois, Lionel Henry, and Kirill Müller) lets you manipulate your data by doing things like adding and removing columns, filtering and subsetting your data, and summarizing your data (such as getting the average of some value per group within your data).</p></li>
<li><p><code>tidyr</code> (Lionel Henry) lets you reshape your data from “wide” to “tall” format. It’s like <code>reshape</code> and <code>reshape2</code> (also written by Hadley Wickham), but in my opinion it does the job better with code that’s easier to interpret.</p></li>
<li><p><code>readxl</code> (Jennifer Bryan) makes allows you to read in Excel files directly into R without the need to convert to .csv first</p></li>
<li><p><code>forcats</code> comes with a bunch of functions for working with categorical data.</p></li>
<li><p><code>stringr</code> makes it easier to work with text in your data.</p></li>
</ol>
<p>There are many other packages that are part of the tidyverse that handle more specific tasks like working with particular data types. There are also ones that are more for the R programmer and can help you publish your R scripts into your own libraries. For now, I’ll stick with just the basics, but be aware that there is much, <em>much</em> more.</p>
</section>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<p>Just like any other R package, installing <code>tidyverse</code> is straightforward.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You only need to run this once and then it’s on your computer.</p>
<p>As always, installing it doesn’t make it automatically available to R though, so you’ll need to explicitly tell R you’ll be working with the package, using the <code>library</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<p>The colorful messages just let you know what other packages are being loaded at the same time (there should be nine: <code>dplyr</code>, <code>forcats</code>, <code>ggplot2</code>, <code>lubridate</code>, <code>purrr</code>, <code>readr</code>, <code>stringr</code>, <code>tibble</code>, and <code>tidyr</code>), and what versions. Alternatively, you can read in these packages individually and everything will be fine, but by loading <code>tidyverse</code> you can take care of those all in one step.</p>
<p>You may also see some conflicts. What this says is that there are functions called <code>filter</code> and <code>lag</code> in both the <code>dplyr</code> and <code>stats</code> package (<code>stats</code> comes preinstalled with R and is automatically loaded because it contains a lot of useful functions). Normally, functions from add-on libraries will be “masked by” the base functions, meaning the new one won’t be used. However, here, <code>tidyverse</code> has done the opposite, and the <code>filter()</code> function in <code>dplyr</code> is overriding the one in <code>stats</code>.</p>
<p>So without further ado, let’s see how we can get data in and out of R.</p>
</section>
</section>
<section id="getting-data-in-and-out-of-r" class="level2">
<h2 class="anchored" data-anchor-id="getting-data-in-and-out-of-r">Getting data in and out of R</h2>
<p>Unless you plan on generating your own data, you’ll need to get your data into R, usually as one of the first things you do. We’ve already seen how to get your data in in <a href="../../../pages/r_basics">a previous tutorial</a>, but there is a tidyverse way of doing it that’s very similar. There are several ways we can do this, and the function you use will depend on what kind of file you’re reading in. Here, I’ve broken it down into .csv, .txt, and .xlsx files. For this section I’ll be drawing from Chapter 11 “Data Import” from <em>R for Data Science</em>, which can be read here: <a href="http://r4ds.had.co.nz/data-import.html">http://r4ds.had.co.nz/data-import.html</a>.</p>
<section id="reading-in-a-.csv-file" class="level3">
<h3 class="anchored" data-anchor-id="reading-in-a-.csv-file">Reading in a .csv file</h3>
<p>If you’ve read data into R before, you’ve probably used the standard <code>read.csv</code> function (which has a period (<code>.</code>) in the function name). This one works just fine and you can get by perfectly well with it. However, tidyverse’s <code>read_csv</code> (with an underscore), has some additional perks that the standard function doesn’t come with. To show the first one, let’s go ahead and read in some data. If you have something on your computer, feel free to load it in like this. (Obviously, this code won’t work on your computer: you’ll have to change the path to some directory where you have data.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For Macs</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/joeystanley/Desktop/path/to/data/menu.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># For Windows</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">joeystanley</span><span class="sc">\\</span><span class="st">Desktop</span><span class="sc">\\</span><span class="st">path</span><span class="sc">\\</span><span class="st">to</span><span class="sc">\\</span><span class="st">data</span><span class="sc">\\</span><span class="st">menu.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If your data is in the same folder as the script you’re working with, you can just type the name of the file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"menu.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you don’t have anything ready, feel free to use this sample data. We’ll start with one one we used in the first ggplot2 workshop, the McDonald’s data. It is available for free at <a href="https://www.kaggle.com/mcdonalds/nutrition-facts">Kaggle.com</a>, where you can get complete nutritional information. I’ve got a subset of this data on my website, so you can just read in this file directly from there into R by typing in the URL.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>menu <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://joeystanley.com/data/menu.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 260 Columns: 6
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): Category, Item
dbl (4): Oz, Calories, Fat, Sugars

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>The first perk of <code>read_csv</code> is that it gives you some output showing you how it parsed each column of your spreadsheet. As we learned in the first ggplot2 workshop, not all data should be treated the same. Numbers are very different from text, and R (as well as you) should be aware of what data types are contained in your file so that it (and you) can work with it the best way possible. There are some heuristics that determine how <code>read_csv</code> parses your data which we won’t get into here, but it’s nice to see what the final result was just to make sure that numbers get treated as numbers, text as text, etc. Later in this workshop we’ll see one way to change it in case the function got something wrong.</p>
<p>The second perk of <code>read_csv</code> is that it turns your data into what’s called a “tibble”, which is tidyverse’s version of a dataframe. At its core, it is actually a dataframe, just like anything else in R, but it also has some additional perks. One major difference between dataframes and tibbles can be seen when you print them. When you print a regular dataframe, it’ll vomit out <em>everything</em>. You get all rows (even if there are many of them) and all columns, which can be hard to read if your screen isn’t wide enough to display them since they’ll spill over into multiple rows. Here’s our menu data printed out as a dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(menu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    Category                                                          Item  Oz
1  Breakfast                                                  Egg McMuffin 4.8
2  Breakfast                                             Egg White Delight 4.8
3  Breakfast                                              Sausage McMuffin 3.9
4  Breakfast                                     Sausage McMuffin with Egg 5.7
5  Breakfast                              Sausage McMuffin with Egg Whites 5.7
6  Breakfast                                          Steak &amp; Egg McMuffin 6.5
7  Breakfast                 Bacon, Egg &amp; Cheese Biscuit (Regular Biscuit) 5.3
8  Breakfast                   Bacon, Egg &amp; Cheese Biscuit (Large Biscuit) 5.8
9  Breakfast Bacon, Egg &amp; Cheese Biscuit with Egg Whites (Regular Biscuit) 5.4
10 Breakfast   Bacon, Egg &amp; Cheese Biscuit with Egg Whites (Large Biscuit) 5.9
   Calories Fat Sugars
1       300  13      3
2       250   8      3
3       370  23      2
4       450  28      2
5       400  23      2
6       430  23      3
7       460  26      3
8       520  30      4
9       410  20      3
10      470  25      4</code></pre>
</div>
</div>
<p>I’ve truncated the output to save space, but on your screen you’ll see that this displays the entire contents of the dataframe. When we print the tibble version, it’s a lot shorter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>menu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 260 × 6
   Category  Item                                       Oz Calories   Fat Sugars
   &lt;chr&gt;     &lt;chr&gt;                                   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 Breakfast Egg McMuffin                              4.8      300    13      3
 2 Breakfast Egg White Delight                         4.8      250     8      3
 3 Breakfast Sausage McMuffin                          3.9      370    23      2
 4 Breakfast Sausage McMuffin with Egg                 5.7      450    28      2
 5 Breakfast Sausage McMuffin with Egg Whites          5.7      400    23      2
 6 Breakfast Steak &amp; Egg McMuffin                      6.5      430    23      3
 7 Breakfast Bacon, Egg &amp; Cheese Biscuit (Regular B…   5.3      460    26      3
 8 Breakfast Bacon, Egg &amp; Cheese Biscuit (Large Bis…   5.8      520    30      4
 9 Breakfast Bacon, Egg &amp; Cheese Biscuit with Egg W…   5.4      410    20      3
10 Breakfast Bacon, Egg &amp; Cheese Biscuit with Egg W…   5.9      470    25      4
# ℹ 250 more rows</code></pre>
</div>
</div>
<p>When you look at a tibble, you only peek at the data. You get the first 10 rows and only as many columns as can fit on your screen without spilling over into a new column. If there are additional columns, they’re listed at the bottom. You also get to see what datatype each column is at the top of each column below the column names. This printing feature makes it easy to examine just a portion of your data without flooding your R Console.</p>
<p>Finally, using <code>read_csv</code> is actually about 10 times faster than the regular <code>read.csv</code> function. If you work with very large datasets, this is a very good thing. Furthermore, if it does take more than about five seconds to read in your file, you’ll actually get a little progress bar down in your R Console saying how much it’s done and how long it has taken. This is nice to see so you know that R is making progress and hasn’t crashed.</p>
<p>Side note, since the menu items are so long, I’m going to truncate it for display purposes only. You don’t have to do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>menu<span class="sc">$</span>Item <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(menu<span class="sc">$</span>Item, <span class="dv">1</span>, <span class="dv">24</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(menu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  Category  Item                        Oz Calories   Fat Sugars
  &lt;chr&gt;     &lt;chr&gt;                    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 Breakfast Egg McMuffin               4.8      300    13      3
2 Breakfast Egg White Delight          4.8      250     8      3
3 Breakfast Sausage McMuffin           3.9      370    23      2
4 Breakfast Sausage McMuffin with Eg   5.7      450    28      2
5 Breakfast Sausage McMuffin with Eg   5.7      400    23      2
6 Breakfast Steak &amp; Egg McMuffin       6.5      430    23      3</code></pre>
</div>
</div>
</section>
<section id="reading-in-an-excel-file" class="level3">
<h3 class="anchored" data-anchor-id="reading-in-an-excel-file">Reading in an Excel file</h3>
<p>In the Intro to R Workshop, I said that it’s possible to load Excel files directly into R. Before learning how to do this, I did a lot of work in Excel, but then I would have to save it as a .csv, which just involved so many steps of clicking “Save As…”, switching to .csv, and then Excel would give me all these warning messages saying I’ll lose formatting. Even then, I could only save one sheet at a time <em>and</em> I had two different identical datasets saved to my computer. It just just such a hassle.</p>
<p>Reading in Excel files is possible thanks to the <code>read_excel</code> function which is in the <code>readxl</code> package. There are actually several packages that do the same thing, but this one is part of the tidyverse. However, it does not come standard in the <code>tidyverse</code> library, so you’ll have to load it explicitly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"readx"</span>) <span class="co"># If you haven't already.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The syntax of <code>read_excel</code> is very similar to <code>read_csv</code>, which is a trend you’ll notice over and over in the tidyverse. All you need to do is specify the path to the file itself. Unfortunately, in the case of Excel files, you can’t read them directly from a website like you can with csv files, so you’ll have to download the data and then load it from your computer from wherever you saved your file. You can just go to <a href="&quot;http://joeystanley.com/data/snoozing.xlsx&quot;">http://joeystanley.com/data/snoozing.xlsx</a> and it’ll automatically download.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>snooze <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"/Users/joeystanley/Desktop/snoozing.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This file contains some fake data I created on how sleeping patterns. We’ll get to it later in the workshop. The crucial thing now is that it’s an Excel file and it can be read in directly into R which is pretty cool. By default, this reads in the first sheet of the Excel file. You can change this by adding the <code>sheet</code> argument and providing either the name of the sheet, or the sheet number. This particular file contains two sheets: the first has all the data and the second is nonsense. We can specify that we want the second sheet (called “blank”) by indicating it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>blank <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"/Users/joeystanley/Desktop/snoozing.xlsx"</span>, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sheet=</span><span class="st">"blank"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The perks of using <code>read_excel</code> are essentially the same as using <code>read_csv</code>: your data is saved as a tibble and it’s much faster.</p>
<p>There is <em>much</em> more that you can do with reading data into R, not only with just those two functions, but with many other specialized functions in <code>readr</code> and <code>readxl</code>, including those for reading in specific data formats. For example, you can specify column names or column types as you read it in so you don’t have to change them later. I’ll let you explore those on your own.</p>
<section id="your-turn" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="your-turn">Your turn!</h4>
<section id="the-challenge" class="level5">
<h5 class="anchored" data-anchor-id="the-challenge">The challenge</h5>
<p>Look at the help for <code>read_excel</code> (by running the command <code>?read_excel</code>) and explore some of the other arguments you can add to the function.</p>
</section>
<section id="the-solution" class="level5">
<h5 class="anchored" data-anchor-id="the-solution">The solution</h5>
<p>Some of the arguments you can add to the function include the following. Note that many of these also apply to <code>read_csv</code>.</p>
<ol type="1">
<li><p><code>col_names = c("example1", "example2")</code>—This is nice if you have some spreadsheet that has column names you don’t like. They might be very long, or contain spaces or other funny characters that are hard to work with in R. I recently worked with a file that had many, very long, very similar column names, so I used this argument to change those column names right away. You just need to supply a list of names in the order they appear in the spreadsheet.</p></li>
<li><p><code>col_types</code> is a way to make sure R gets the data type for each column correct from the start. This might be good if there are lots of factors in your data, or if R consistently gets a column wrong, or if you’re just tired of the message when reading data in. For example, if you wanted to make sure the <code>Category</code> column <code>menu</code> data was a factor and not a character, you could do this:</p>
<p>::: {.cell}</p>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(<span class="st">"http://joeystanley.com/data/menu.csv"</span>, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">Category =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="cn">NULL</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<p>This is handy, but it takes some getting used to. For more help, look at section <a href="http://r4ds.had.co.nz/data-import.html#parsing-a-file">11.4.2</a> of <em>R for Data Science</em>.</p></li>
<li><p>I’ve had to use <code>skip = 3</code> when I read in some census data. The file I downloaded had three lines of citation information that weren’t actually part of the data. The real table started at line 4, so I was just able to skipped them without modifying the original Excel file.</p></li>
</ol>
<p>There are others, but these are the ones I’ve used recently.</p>
</section>
</section>
</section>
<section id="reading-in-a-.txt-file" class="level3">
<h3 class="anchored" data-anchor-id="reading-in-a-.txt-file">Reading in a .txt file</h3>
<p>Even though they’re probably the simplest type, .txt files are a little bit trickier to work with. All the .txt files have been “tab-delimited”, meaning that it was essentially a spreadsheet but instead of commas separating each cell, there were tabs. This filetype is actually useful because if some of your columns contain commas (city + state, sentences, etc.), using a tab makes sure those commas don’t separate columns unexpectedly.</p>
<p>The function for this is <code>read_delim</code>. It looks very similar to <code>read_csv</code> and <code>read_excel</code>, except you need to specify the <code>delim</code> argument. If the file is separated by tabs, you can use <code>"\t"</code> for that, which is “computer talk” for a tab character. The cereal data, which we used in the second ggplot2 data, is also stored on my website as a tab-delimited file. This is another dataset made available through <a href="http://kaggle.com">Kaggle.com</a> that contain nutritional information of 80 different kinds of cereal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"http://joeystanley.com/data/cereal.txt"</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that you may have gotten that long message about what kinds of columns were read in. This is a nice case where using the <code>col_types</code> argument would be good because we actually have two changes to make. And if you specify just one column, the message goes away for the rest of them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Users/joeystanley/Desktop/github/joeystanley/data/cereal.txt"</span>, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="cn">NULL</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">mfr  =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="cn">NULL</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>           ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="saving-r-data-to-your-computer" class="level3">
<h3 class="anchored" data-anchor-id="saving-r-data-to-your-computer">Saving R data to your computer</h3>
<p>So we’ve covered how to get data into R, it might be useful to look at how to get data <em>out</em> of R. Often you’ll make all sorts of changes to your data and it would be nice to save that so you don’t have to do that all over again. Or sometimes there will be useful output or transformations of your data that are super useful to hold on to for later.</p>
<p>The main function I use is <code>write_csv</code>, which is straightforward. First, provide the dataset you want to save, and then specify where you want it to be saved.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(snooze, <span class="st">"/Users/joeystanley/Desktop/snooze.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The comma-separated value is recommended because it’s easiest to use later by R or other programs. But if you want to save it as a .txt file, just use <code>write_delim</code>, with the extra argument of specifying what should separate the columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(snooze, <span class="st">"/Users/joeystanley/Desktop/snooze.txt"</span>, <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I don’t know of a way to create Excel files in R. They are actually quite a bit more complicated because they have to store information about all sorts of stuff like potential colors, borders, fonts, etc. I’m sure someone has created a package to do that, but you’re on your own for figuring out how.</p>
<section id="your-turn-1" class="level4">
<h4 class="anchored" data-anchor-id="your-turn-1">Your turn!</h4>
<p>Try reading in a dataset of your own into R. Check the file time and use the appropriate command. You may use any additional arguments as you see fit. Make sure that everything looks good when you <code>View</code> your data.</p>
</section>
</section>
</section>
<section id="the-select-function" class="level2">
<h2 class="anchored" data-anchor-id="the-select-function">The <code>select</code> function</h2>
<p>Whenever I read data into R, the very next step is always to process the data a little further. Out-of-the-box, it’s never exactly how I want it. We saw some of this processing with the <code>col_types</code> argument in the <code>read_*</code> family of functions. In this section, we’ll look at how to reorder or remove columns using the <code>select</code> function.</p>
<section id="reorder-columns" class="level3">
<h3 class="anchored" data-anchor-id="reorder-columns">Reorder columns</h3>
<p>You would think that reorder columns in R would be straightforward. But, as far as I’m aware, it’s not easy using regular R functions. Let’s take our McDonald’s data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(menu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  Category  Item                        Oz Calories   Fat Sugars
  &lt;chr&gt;     &lt;chr&gt;                    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 Breakfast Egg McMuffin               4.8      300    13      3
2 Breakfast Egg White Delight          4.8      250     8      3
3 Breakfast Sausage McMuffin           3.9      370    23      2
4 Breakfast Sausage McMuffin with Eg   5.7      450    28      2
5 Breakfast Sausage McMuffin with Eg   5.7      400    23      2
6 Breakfast Steak &amp; Egg McMuffin       6.5      430    23      3</code></pre>
</div>
</div>
<p>Let’s say we wanted to just move things around a little bit so that the <code>Item</code> column is first instead of <code>Category</code>, and then you want <code>Sugars</code> to go before <code>Calories</code>. In base R, you accomplish this by referring the the column order:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>menu[, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  Item                     Category     Oz Sugars Calories   Fat
  &lt;chr&gt;                    &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 Egg McMuffin             Breakfast   4.8      3      300    13
2 Egg White Delight        Breakfast   4.8      3      250     8
3 Sausage McMuffin         Breakfast   3.9      2      370    23
4 Sausage McMuffin with Eg Breakfast   5.7      2      450    28
5 Sausage McMuffin with Eg Breakfast   5.7      2      400    23
6 Steak &amp; Egg McMuffin     Breakfast   6.5      3      430    23</code></pre>
</div>
</div>
<p>This is fine, and actually quite succinct, but it has some problems. First, if there’re only six columns this isn’t a big deal to count all of them. But if you have dozens of columns, it can get tedious to sit there and count them, and then you’re bound to get something wrong anyway. Also, it’s not clear what the numbers refer to. Furthermore, if your original dataset changes and now you have a new column somewhere in the middle, everything will get completely messed up. With the <code>select</code> function (which is in the <code>dplyr</code> package), you can refer to the columns by name—and you don’t even need to put quotes around them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(menu, Item, Category, Oz, Sugars, Calories, Fat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  Item                     Category     Oz Sugars Calories   Fat
  &lt;chr&gt;                    &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 Egg McMuffin             Breakfast   4.8      3      300    13
2 Egg White Delight        Breakfast   4.8      3      250     8
3 Sausage McMuffin         Breakfast   3.9      2      370    23
4 Sausage McMuffin with Eg Breakfast   5.7      2      450    28
5 Sausage McMuffin with Eg Breakfast   5.7      2      400    23
6 Steak &amp; Egg McMuffin     Breakfast   6.5      3      430    23</code></pre>
</div>
</div>
<p>This is admittedly a bit more typing, but I think the clarity is worth it. With <code>select</code>, all you do is first type the name of the dataset you want to work with, and then just start listing columns, separated by commas. This overcomes all the problems with the base R way: you don’t have to sit and count a bunch of columns anymore (referring to names is easier than numbers), it’s clear what this does, and if you get a random new column in the middle, you still end up with the colum order you want.</p>
</section>
<section id="tangent-the-pipe" class="level3">
<h3 class="anchored" data-anchor-id="tangent-the-pipe">Tangent: <code>%&gt;%</code> (“the pipe”)</h3>
<p>One of the handier things about the tidyverse is this cool function called “the pipe” (<code>%&gt;%</code>). This is a way to rewrite your functions so that they’re a little bit easier and they focus more on what the functions are doing.</p>
<p>To give an example of what the pipe does, consider the following snippets of code that each produce identical outputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Hi, Mom!"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="st">"Hi, Mom!"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hi, Mom!"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, pi, <span class="dv">4</span>)))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, pi, <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, pi, <span class="dv">4</span>, <span class="cn">NA</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, pi, <span class="dv">4</span>, <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.628</code></pre>
</div>
</div>
<p>What the pipe does is it takes whatever is on the left and makes it the first argument to whatever is on the right. For many functions, that first argument is the data that the functions works with. This is handy because it makes the dataset standout visually in the code, rather than it being buried deep within somewhere. This is especially evident when we have to nest multiple functions together or when there are arguments to the functions. The pipe separates all these out in a way that makes it clear what everything is doing and which arguments go with which function.</p>
<p>When you read the code, you can think of the pipe as “and then…”. So in the last example, you might read it as “take this list of values, <em>and then</em> find it’s mean (after removing NAs), <em>and then</em> round it (to three decimal places).”</p>
<p>The pipe is super handy for pretty much all tidyverse stuff. So for example, you could rewrite chunk of code above that used the <code>select</code> function as this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>menu <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Item, Category, Oz, Sugars, Calories, Fat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 260 × 6
   Item                     Category     Oz Sugars Calories   Fat
   &lt;chr&gt;                    &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
 1 Egg McMuffin             Breakfast   4.8      3      300    13
 2 Egg White Delight        Breakfast   4.8      3      250     8
 3 Sausage McMuffin         Breakfast   3.9      2      370    23
 4 Sausage McMuffin with Eg Breakfast   5.7      2      450    28
 5 Sausage McMuffin with Eg Breakfast   5.7      2      400    23
 6 Steak &amp; Egg McMuffin     Breakfast   6.5      3      430    23
 7 Bacon, Egg &amp; Cheese Bisc Breakfast   5.3      3      460    26
 8 Bacon, Egg &amp; Cheese Bisc Breakfast   5.8      4      520    30
 9 Bacon, Egg &amp; Cheese Bisc Breakfast   5.4      3      410    20
10 Bacon, Egg &amp; Cheese Bisc Breakfast   5.9      4      470    25
# ℹ 250 more rows</code></pre>
</div>
</div>
<p>This makes it even clearer because the only thing within the <code>select</code> parentheses are the column names themselves. In fact, because the pipe allows you to stack functions, you could even read in the data and then reorder it all in one block. The following snippet reads in data, reorders it, prints it out, and saves the result into the <code>menu</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>menu <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://joeystanley.com/data/menu.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Item, Category, Oz, Sugars, Calories, Fat) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 260 × 6
   Item                     Category     Oz Sugars Calories   Fat
   &lt;chr&gt;                    &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
 1 Egg McMuffin             Breakfast   4.8      3      300    13
 2 Egg White Delight        Breakfast   4.8      3      250     8
 3 Sausage McMuffin         Breakfast   3.9      2      370    23
 4 Sausage McMuffin with Eg Breakfast   5.7      2      450    28
 5 Sausage McMuffin with Eg Breakfast   5.7      2      400    23
 6 Steak &amp; Egg McMuffin     Breakfast   6.5      3      430    23
 7 Bacon, Egg &amp; Cheese Bisc Breakfast   5.3      3      460    26
 8 Bacon, Egg &amp; Cheese Bisc Breakfast   5.8      4      520    30
 9 Bacon, Egg &amp; Cheese Bisc Breakfast   5.4      3      410    20
10 Bacon, Egg &amp; Cheese Bisc Breakfast   5.9      4      470    25
# ℹ 250 more rows</code></pre>
</div>
</div>
<p>Another handy thing is that since it’s all being treated as one giant line of code, you can put your cursor anywhere in the entire block and run it, and it’ll do the whole thing for you. So you don’t need to highlight the whole block in order to run it.</p>
<p>Being able to do a whole bunch of stuff at once like this is really nice also because then you don’t have to keep track of multiple versions of the same data. You don’t need a <code>menu</code> and a <code>menu_reordered</code> or a <code>menu_clean</code> object: you can just do it all at once and skip the intermediate steps. Pretty handy. I would highly recommend getting used to the pipe because it will save you a lot of hassle.</p>
</section>
<section id="removing-columns" class="level3">
<h3 class="anchored" data-anchor-id="removing-columns">Removing columns</h3>
<p>Sometimes the data you read in has too many columns and you just want to get rid of them to make things easier. In base R, the way I learned how to remove a column was to set it equal to null:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>bad_column <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That was fine if it was a one-off thing, but if there were many of them, it was kind of annoying to do. In tidyverse, you can actually also use the <code>select</code> function to do this. Let’s say we read in the menu data, but we don’t need to worry about the <code>Oz</code> column. We can easy remove it by putting a minus sign before it in <code>select</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>menu <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Oz) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 260 × 5
  Item                     Category  Sugars Calories   Fat
  &lt;chr&gt;                    &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 Egg McMuffin             Breakfast      3      300    13
2 Egg White Delight        Breakfast      3      250     8
3 Sausage McMuffin         Breakfast      2      370    23
4 Sausage McMuffin with Eg Breakfast      2      450    28
5 Sausage McMuffin with Eg Breakfast      2      400    23
# ℹ 255 more rows</code></pre>
</div>
</div>
<p>Alternatively, we can just list the columns we want to <em>keep</em>, and <code>select</code> will drop the rest:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>menu <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Item, Category, Sugars, Calories, Fat) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 260 × 5
  Item                     Category  Sugars Calories   Fat
  &lt;chr&gt;                    &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 Egg McMuffin             Breakfast      3      300    13
2 Egg White Delight        Breakfast      3      250     8
3 Sausage McMuffin         Breakfast      2      370    23
4 Sausage McMuffin with Eg Breakfast      2      450    28
5 Sausage McMuffin with Eg Breakfast      2      400    23
# ℹ 255 more rows</code></pre>
</div>
</div>
<p>In fact, you can even just reorder things if you need, and the ones you don’t include will be silently dropped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>menu <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Fat, Calories, Item) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 260 × 3
    Fat Calories Item                    
  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;                   
1    13      300 Egg McMuffin            
2     8      250 Egg White Delight       
3    23      370 Sausage McMuffin        
4    28      450 Sausage McMuffin with Eg
5    23      400 Sausage McMuffin with Eg
# ℹ 255 more rows</code></pre>
</div>
</div>
<p>However, doing this is potentially troublesome for you down the road. If you decide you need that column you want at a later date, it’s not immediately obvious where it went. This is why you should comment your code to explain <em>why</em> things are written the way they are.</p>
</section>
<section id="additional-select-tricks" class="level3">
<h3 class="anchored" data-anchor-id="additional-select-tricks">Additional <code>select</code> tricks</h3>
<p>If you have only a few columns, it’s not too big of a deal to type them all out. But if you have many, it can get tedious, especially if you only need to make a couple changes. Fortunately, <code>select</code> has a way to specify multiple columns at once, analgous with how some R syntax works. In R, you can use a colon <code>:</code> to specify a range of things.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3 10 11 12 13 14 15 16 17 18 19 20</code></pre>
</div>
</div>
<p>You can do a similar thing in <code>select</code>. If you want to include many adjacent columns, just use a colon between them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>menu <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Item, Oz<span class="sc">:</span>Fat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 260 × 5
   Item                        Oz Sugars Calories   Fat
   &lt;chr&gt;                    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
 1 Egg McMuffin               4.8      3      300    13
 2 Egg White Delight          4.8      3      250     8
 3 Sausage McMuffin           3.9      2      370    23
 4 Sausage McMuffin with Eg   5.7      2      450    28
 5 Sausage McMuffin with Eg   5.7      2      400    23
 6 Steak &amp; Egg McMuffin       6.5      3      430    23
 7 Bacon, Egg &amp; Cheese Bisc   5.3      3      460    26
 8 Bacon, Egg &amp; Cheese Bisc   5.8      4      520    30
 9 Bacon, Egg &amp; Cheese Bisc   5.4      3      410    20
10 Bacon, Egg &amp; Cheese Bisc   5.9      4      470    25
# ℹ 250 more rows</code></pre>
</div>
</div>
<p>As mentioned above, one downside of <code>select</code> is that if you forget to specify a column in <code>select</code>, it’ll silently disappear and you won’t know where it went until you do some further digging. Using the colon solves this problem to some extent because it’ll capture everything between those two columns, whether you meant to or not. You can also use the <code>everything()</code> function to select everything that you haven’t already done yet. This makes sure you don’t miss any:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>menu <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Item, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 260 × 6
   Item                     Category     Oz Sugars Calories   Fat
   &lt;chr&gt;                    &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
 1 Egg McMuffin             Breakfast   4.8      3      300    13
 2 Egg White Delight        Breakfast   4.8      3      250     8
 3 Sausage McMuffin         Breakfast   3.9      2      370    23
 4 Sausage McMuffin with Eg Breakfast   5.7      2      450    28
 5 Sausage McMuffin with Eg Breakfast   5.7      2      400    23
 6 Steak &amp; Egg McMuffin     Breakfast   6.5      3      430    23
 7 Bacon, Egg &amp; Cheese Bisc Breakfast   5.3      3      460    26
 8 Bacon, Egg &amp; Cheese Bisc Breakfast   5.8      4      520    30
 9 Bacon, Egg &amp; Cheese Bisc Breakfast   5.4      3      410    20
10 Bacon, Egg &amp; Cheese Bisc Breakfast   5.9      4      470    25
# ℹ 250 more rows</code></pre>
</div>
</div>
<p>So the <code>select</code> function can do a lot. It’s probably just as easy as base R, but it might be a little bit clearer for you or another person to understand the code being used.</p>
<section id="you-turn" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="you-turn">You turn!</h4>
<section id="the-challenge-1" class="level5">
<h5 class="anchored" data-anchor-id="the-challenge-1">The challenge</h5>
<p>Read in one of your own datasets and play around with the <code>select</code> function. If you don’t have one ready, try working with the <code>cereal</code> dataset. Try putting the columns in a more logical order or removing ones you don’t need.</p>
</section>
<section id="the-solution-1" class="level5">
<h5 class="anchored" data-anchor-id="the-solution-1">The solution</h5>
<p>With the <code>cereal</code> data, there are some columns I don’t need all the time or that I don’t understand what they’re for. I can use <code>select</code> to remove them and then reorder things.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(name, rating, cups, calories<span class="sc">:</span>fiber) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  name                   rating  cups calories sugars protein   fat sodium fiber
  &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 100% Bran                68.4  0.33       70      6       4     1    130  10  
2 100% Natural Bran        34.0  1         120      8       3     5     15   2  
3 All-Bran                 59.4  0.33       70      5       4     1    260   9  
4 All-Bran with Extra F…   93.7  0.5        50      0       4     0    140  14  
5 Almond Delight           34.4  0.75      110      8       2     2    200   1  
6 Apple Cinnamon Cheeri…   29.5  0.75      110     10       2     2    180   1.5</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="the-mutate-function" class="level2">
<h2 class="anchored" data-anchor-id="the-mutate-function">The <code>mutate</code> function</h2>
<p>Another super common function that I use is <code>mutate</code>, which is in the <code>dplyr</code> package. This function can both create new columns and modify existing ones. Let’s see how it’s done.</p>
<section id="creating-new-columns" class="level3">
<h3 class="anchored" data-anchor-id="creating-new-columns">Creating new columns</h3>
<p>The <code>cereal</code> data we have is good because it lists a lot of nutritional information that you might find on the box. However, it doesn’t show any calculations of this data. Let’s say we want to see what the sugariest cereal is. Let’s make a quick tangent and look at the <code>arrange</code> function. Using <code>arrange</code>, we can sort our data (alphabetically or numerically) based on the values in some column. By default, it’ll put them from lowest to highest, but if we put a minus sign before the column name, it’ll sort it from highest to lowest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>mfr, <span class="sc">-</span>type, <span class="sc">-</span>shelf, <span class="sc">-</span>weight) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="sc">-</span>sugars) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  name                   cups rating calories sugars protein   fat sodium fiber
  &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Golden Crisp           0.88   35.3      100     15       2     0     45     0
2 Smacks                 0.75   31.2      110     15       2     1     70     1
3 Apple Jacks            1      33.2      110     14       2     0    125     1
4 Post Nat. Raisin Bran  0.67   37.8      120     14       3     1    200     6
5 Total Raisin Bran      1      28.6      140     14       3     1    190     4
6 Cocoa Puffs            1      22.7      110     13       1     1    180     0</code></pre>
</div>
</div>
<p>So according to this, the top five sugariest cereals per serving are Golden Crisp, Smacks, Apple Jacks, and two kinds of Raisin Bran. (Personally, it’s satisfying to see Smacks up there: even as a kid I thought that cereal was way too sugary!) But this is a little deceivin, because the serving size is a little bit different for each one. What if we want to see the amount of sugar per cup? I personally never eat what the recommended serving size is for cereal because I just fill my bowl up the same regardless of what kind of cereal I have. So a better idea of how much sugar has is to look at the cereal per cup rather than per serving.</p>
<p>We can add columns with the <code>mutate</code> function. First, type whatever you want to name the new column, an equals sign, and then whatever calculations you want. If you want to refer to other columns, just type them (without quotes) and it’ll take care of it for you. So here, I’m creating a new column called <code>sugar_per_cup</code>, which is a calculation of the values in the <code>sugars</code> column divided by the values in the <code>cups</code> column. I’ll then sort the data by the amount of sugar per cup rather than per serving.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>mfr, <span class="sc">-</span>type, <span class="sc">-</span>shelf, <span class="sc">-</span>weight) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sugar_per_cup =</span> sugars <span class="sc">/</span> cups) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="sc">-</span>sugar_per_cup) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  name      cups rating calories sugars protein   fat sodium fiber sugar_per_cup
  &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
1 Post Na…  0.67   37.8      120     14       3     1    200   6            20.9
2 Oatmeal…  0.5    30.5      130     10       3     2    170   1.5          20  
3 Smacks    0.75   31.2      110     15       2     1     70   1            20  
4 Mueslix…  0.67   30.3      160     13       3     2    150   3            19.4
5 100% Br…  0.33   68.4       70      6       4     1    130  10            18.2
6 Fruitfu…  0.67   41.0      120     12       3     0    240   5            17.9</code></pre>
</div>
</div>
<p>Now this paints a different picture. Now the top five sugariest cereals <em>per cup</em> are all different (except for Smacks!). So now, next time you pour yourself some Raisin Bran—a supposedly healthy cereal—keep in mind that you’re eating a whopping 20 grams of sugar per cup.</p>
<section id="your-turn-2" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="your-turn-2">Your turn!</h4>
<section id="the-challenge-2" class="level5">
<h5 class="anchored" data-anchor-id="the-challenge-2">The challenge</h5>
<ol type="1">
<li><p>Before moving on, just make sure that you fully understand all five lines in the code block above. We’re starting to get to the point where our blocks of code are getting long, and if you just gloss over them, it won’t be clear what each function doing every step of the way.</p></li>
<li><p>Pick a different nutritional fact about the cereal and see if you can find any differences when you sort the table by that fact by serving as opposed to by cup.</p></li>
</ol>
</section>
<section id="the-solution-2" class="level5">
<h5 class="anchored" data-anchor-id="the-solution-2">The solution</h5>
<p>I decided to go with sodium. Maybe you’re on a low-sodium diet and want to know which cereals to avoid. Here are the cereals with the most sodium per serving.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by amount of sodium per serving.</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(name, cups, sodium) <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="sc">-</span>sodium) <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  name            cups sodium
  &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;
1 Product 19      1       320
2 Cheerios        1.25    290
3 Corn Flakes     1       290
4 Rice Krispies   1       290
5 Corn Chex       1       280
6 Golden Grahams  0.75    280</code></pre>
</div>
</div>
<p>But, if we create a new column with sodium per cup, it shows a different list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by amount of sodium per cup</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(name, cups, sodium) <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sodium_per_cup =</span> sodium <span class="sc">/</span> cups) <span class="sc">%&gt;%</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="sc">-</span>sodium_per_cup) <span class="sc">%&gt;%</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  name            cups sodium sodium_per_cup
  &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;          &lt;dbl&gt;
1 All-Bran        0.33    260           788.
2 Grape-Nuts      0.25    170           680 
3 100% Bran       0.33    130           394.
4 Golden Grahams  0.75    280           373.
5 Fruitful Bran   0.67    240           358.
6 Wheat Chex      0.67    230           343.</code></pre>
</div>
</div>
<p>So unless you’re careful about serving size, you should definitely avoid All-Bran and Grape-Nuts if you’re watching your sodium.</p>
</section>
</section>
</section>
<section id="modifying-columns" class="level3">
<h3 class="anchored" data-anchor-id="modifying-columns">Modifying columns</h3>
<p>We can also use <code>mutate</code> to modify existing columns. A big reason to modify something is if it’s in the wrong data type. For example, if you are reading data about a sports team and you have a column with the jersey number, R will read that in as a numeric value when it really should be treated as a categorical variable. (Player 20 is not inherently twice as big or twice as good as player 10!) In R there are actually several more data types than just “categorical” or “numeric.” Unfortunately, we don’t have time in this workshops to cover the details of all of them.</p>
<p>One thing you may want to do is rename and change the order of factors in a categorical variable. We saw this in the second ggplot2 workshop when making a barplot to control the labels at the bottom and the order the bars appear. The following is the code we used to rename the factors using base R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First make a copy</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>cereal_renamed <span class="ot">&lt;-</span> cereal</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy and paste this complicated code one-by-one</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)[<span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)<span class="sc">==</span><span class="st">"K"</span>] <span class="ot">&lt;-</span> <span class="st">"Kellogg's"</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)[<span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)<span class="sc">==</span><span class="st">"G"</span>] <span class="ot">&lt;-</span> <span class="st">"General Mills"</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)[<span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)<span class="sc">==</span><span class="st">"P"</span>] <span class="ot">&lt;-</span> <span class="st">"Post"</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)[<span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)<span class="sc">==</span><span class="st">"Q"</span>] <span class="ot">&lt;-</span> <span class="st">"Quaker Oats"</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)[<span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)<span class="sc">==</span><span class="st">"R"</span>] <span class="ot">&lt;-</span> <span class="st">"Ralston Purina"</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)[<span class="fu">levels</span>(cereal_renamed<span class="sc">$</span>mfr)<span class="sc">==</span><span class="st">"N"</span>] <span class="ot">&lt;-</span> <span class="st">"Nabisco"</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot it</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cereal_renamed, <span class="fu">aes</span>(mfr)) <span class="sc">+</span> </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The problem with this is that it takes quite a bit of complicated code to do that, and the code itself is quite repetitive. We then saw that with the package <code>forcats</code>, which is part of the tidyverse, you can do that a lot simpler:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>cereal_renamed <span class="ot">&lt;-</span> cereal</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>cereal_renamed<span class="sc">$</span>mfr <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(cereal_renamed<span class="sc">$</span>mfr,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Kellogg's"</span> <span class="ot">=</span> <span class="st">"K"</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"General Mills"</span> <span class="ot">=</span> <span class="st">"G"</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Post"</span> <span class="ot">=</span> <span class="st">"P"</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Quaker Oats"</span> <span class="ot">=</span> <span class="st">"Q"</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Ralston Purina"</span> <span class="ot">=</span> <span class="st">"R"</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Nabisco"</span> <span class="ot">=</span> <span class="st">"N"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In fact, we can make this even more succinct using the <code>mutate</code> function. Similar to creating new columns, you first type the name of the “new” column, but if that name matches an existing column name, it’ll overwrite it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>cereal_renamed <span class="ot">&lt;-</span> cereal <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mfr =</span> <span class="fu">fct_recode</span>(mfr,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Kellogg's"</span> <span class="ot">=</span> <span class="st">"K"</span>,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"General Mills"</span> <span class="ot">=</span> <span class="st">"G"</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Post"</span> <span class="ot">=</span> <span class="st">"P"</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Quaker Oats"</span> <span class="ot">=</span> <span class="st">"Q"</span>,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Ralston Purina"</span> <span class="ot">=</span> <span class="st">"R"</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Nabisco"</span> <span class="ot">=</span> <span class="st">"N"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This saves even more typing because you don’t have to keep typing <code>cereal</code> or <code>cereal_renamed</code> over and over. In fact, we can even pipe this straight into <code>ggplot</code> since <code>cereal</code> is the first argument of that function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mfr =</span> <span class="fu">fct_recode</span>(mfr,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Kellogg's"</span> <span class="ot">=</span> <span class="st">"K"</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"General Mills"</span> <span class="ot">=</span> <span class="st">"G"</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Post"</span> <span class="ot">=</span> <span class="st">"P"</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Quaker Oats"</span> <span class="ot">=</span> <span class="st">"Q"</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Ralston Purina"</span> <span class="ot">=</span> <span class="st">"R"</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Nabisco"</span> <span class="ot">=</span> <span class="st">"N"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(mfr)) <span class="sc">+</span> </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So in one chunk of code, we can take the <code>cereal</code> data frame, modify it, and plot it. That’s pretty cool.</p>
<p>The next step in the ggplot2 workshop was to then reorder the columns, and we used the following code to do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>cereal_ordered <span class="ot">&lt;-</span> cereal_renamed</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>cereal_ordered<span class="sc">$</span>mfr <span class="ot">&lt;-</span> <span class="fu">factor</span>(cereal_ordered<span class="sc">$</span>mfr, </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Kellogg's"</span>, <span class="st">"General Mills"</span>, <span class="st">"Post"</span>, </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Ralston Purina"</span>, <span class="st">"Quaker Oats"</span>, <span class="st">"Nabisco"</span>))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cereal_ordered, <span class="fu">aes</span>(mfr)) <span class="sc">+</span> </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can consolidate this into one chunk of code using <code>mutate</code>. We first take the <code>cereal_renamed</code> data, and add “new” column called <code>mfr</code> that takes the old column <code>mfr</code> and turns it into a factor with the levels being those cereals in that order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>cereal_renamed <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mfr =</span> <span class="fu">factor</span>(mfr, </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Kellogg's"</span>, <span class="st">"General Mills"</span>, <span class="st">"Post"</span>, </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Ralston Purina"</span>, <span class="st">"Quaker Oats"</span>, <span class="st">"Nabisco"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The purpose of reordering the columns like this was to put them in order of frequency. With six columns, it’s not a big deal, but if you have many more, it can get tedious. In the ggplot2 workshop, I said we can use tidyverse functions to do this automatically, and so here we are! The function you want is also in the <code>forcats</code> package and is called <code>fct_infreq</code>. To use it, just put the name of the column you want to sort.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>cereal_renamed <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mfr =</span> <span class="fu">fct_infreq</span>(mfr)) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(mfr)) <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The function does exactly what we expect. It creates a “new” column called <code>mfr</code> that takes the old <code>mfr</code> column and sorts the factors in order of frequency. Pretty slick.</p>
<section id="your-turn-3" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="your-turn-3">Your turn!</h4>
<section id="the-challenge-3" class="level5">
<h5 class="anchored" data-anchor-id="the-challenge-3">The challenge</h5>
<p>Part of the reason for why the pipe is so useful is that we don’t have to make all these intermediate dataframes that are all similar to each other and only differ slightly. In the ggplot2 workshops, we had <code>cereal</code>, <code>cereal_renamed</code>, and <code>cereal_ordered</code>. With the pipe and <code>mutate</code>, we can do all the cleaning in one step, straight from reading the data in. So, your challenge is to do the following in one block of piped functions:</p>
<ol type="1">
<li><p>Read the cereal data in, making sure that the <code>type</code> and <code>mfr</code> columns are read in as factors.</p></li>
<li><p>Change the <code>mfr</code> column so that the full, unabbreviated forms are used.</p></li>
<li><p>Put the <code>mfr</code> column in order of frequency.</p></li>
<li><p>Print it out.</p></li>
</ol>
<p>Then take that data and create a bar plot. It should look identical to the above plot.</p>
</section>
<section id="the-solution-3" class="level5">
<h5 class="anchored" data-anchor-id="the-solution-3">The solution</h5>
<p>Below you’ll find the entire block that accomplishes this task. Note that you’re perfectly welcome to have two separate <code>mutate</code> functions in the same piped block. However, you can also put multiple changes within the same mutate function—you just need to put a comma between them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example code: do not run!</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>sample_data <span class="sc">%&gt;%</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">z =</span> x <span class="sc">+</span> y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that doing it this way, you can refer to columns you’ve just created/modified and it’ll work the way you want them to. So, in the block below, I only have one <code>mutate</code> function that takes care of the recoding and the releveling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read it in as a tab-delineated file</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>cereal <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Users/joeystanley/Desktop/github/joeystanley/data/cereal.txt"</span>, </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Make sure the column types are correct.</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="cn">NULL</span>),</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">mfr  =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="cn">NULL</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>           )) <span class="sc">%&gt;%</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Spell the manufacturers out instead of the abbreviations.</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mfr =</span> <span class="fu">fct_recode</span>(mfr,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Kellogg's"</span> <span class="ot">=</span> <span class="st">"K"</span>,</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"General Mills"</span> <span class="ot">=</span> <span class="st">"G"</span>,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Post"</span> <span class="ot">=</span> <span class="st">"P"</span>,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Quaker Oats"</span> <span class="ot">=</span> <span class="st">"Q"</span>,</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Ralston Purina"</span> <span class="ot">=</span> <span class="st">"R"</span>,</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Nabisco"</span> <span class="ot">=</span> <span class="st">"N"</span>),</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>           <span class="co"># ...and put them in order of frequency.</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">mfr =</span> <span class="fu">fct_infreq</span>(mfr)) <span class="sc">%&gt;%</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print it out.</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 75 × 13
   name      mfr   type  shelf weight  cups rating calories sugars protein   fat
   &lt;chr&gt;     &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 100% Bran Nabi… C         3   1     0.33   68.4       70      6       4     1
 2 100% Nat… Quak… C         3   1     1      34.0      120      8       3     5
 3 All-Bran  Kell… C         3   1     0.33   59.4       70      5       4     1
 4 All-Bran… Kell… C         3   1     0.5    93.7       50      0       4     0
 5 Almond D… Rals… C         3   1     0.75   34.4      110      8       2     2
 6 Apple Ci… Gene… C         1   1     0.75   29.5      110     10       2     2
 7 Apple Ja… Kell… C         2   1     1      33.2      110     14       2     0
 8 Basic 4   Gene… C         3   1.33  0.75   37.0      130      8       3     2
 9 Bran Chex Rals… C         1   1     0.67   49.1       90      6       2     1
10 Bran Fla… Post  C         3   1     0.67   53.3       90      5       3     0
# ℹ 65 more rows
# ℹ 2 more variables: sodium &lt;dbl&gt;, fiber &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="miscellaneous-functions" class="level2">
<h2 class="anchored" data-anchor-id="miscellaneous-functions">Miscellaneous functions</h2>
<p>In this last section, we’ll take a look at a couple other functions that you might find to be useful: <code>filter</code> and <code>rename</code>.</p>
<section id="the-filter-function" class="level3">
<h3 class="anchored" data-anchor-id="the-filter-function">The <code>filter</code> function</h3>
<p>Sometimes you don’t want to work with your entire data frame and you just want to see a subset. Base R has a function called <code>subset</code> that actually works quite well. The <code>dplyr</code> package also has one, <code>filter</code>, that accomplishes the same thing. For consistency’s sake, we’ll continue with the tidyverse version.</p>
<p>In our cereal data, we have one column, <code>type</code>, that specifies whether it’s a hot (=<code>H</code>) or cold (=<code>C</code>) cereal. But, if you look at the data, you’ll see that there’s just one hot cereal in the whole list, “Cream of Wheat (Quick).”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cereal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name                       mfr     type       shelf           weight    
 Length:75          Kellogg's     :23   C:74   Min.   :1.000   Min.   :0.50  
 Class :character   General Mills :22   H: 1   1st Qu.:1.500   1st Qu.:1.00  
 Mode  :character   Post          : 9          Median :2.000   Median :1.00  
                    Ralston Purina: 8          Mean   :2.227   Mean   :1.03  
                    Quaker Oats   : 7          3rd Qu.:3.000   3rd Qu.:1.00  
                    Nabisco       : 6          Max.   :3.000   Max.   :1.50  
      cups            rating         calories         sugars     
 Min.   :0.2500   Min.   :18.04   Min.   : 50.0   Min.   : 0.00  
 1st Qu.:0.6700   1st Qu.:32.69   1st Qu.:100.0   1st Qu.: 3.00  
 Median :0.7500   Median :40.11   Median :110.0   Median : 7.00  
 Mean   :0.8207   Mean   :42.39   Mean   :107.1   Mean   : 7.08  
 3rd Qu.:1.0000   3rd Qu.:50.28   3rd Qu.:110.0   3rd Qu.:11.00  
 Max.   :1.5000   Max.   :93.70   Max.   :160.0   Max.   :15.00  
    protein           fat          sodium          fiber       
 Min.   :1.000   Min.   :0.0   Min.   :  0.0   Min.   : 0.000  
 1st Qu.:2.000   1st Qu.:0.0   1st Qu.:135.0   1st Qu.: 1.000  
 Median :2.000   Median :1.0   Median :180.0   Median : 2.000  
 Mean   :2.493   Mean   :1.0   Mean   :163.9   Mean   : 2.173  
 3rd Qu.:3.000   3rd Qu.:1.5   3rd Qu.:215.0   3rd Qu.: 3.000  
 Max.   :6.000   Max.   :5.0   Max.   :320.0   Max.   :14.000  </code></pre>
</div>
</div>
<p>It might be nice to just filter that one out. Using <code>filter</code>, we just need to provide a true/false statement using some <em>operator</em>. The following list covers most operators in R:</p>
<div class="plain-bulleted-list">
<ul>
<li><code>==</code>: “equal to” (note that you need <em>two</em> equals signs)</li>
<li><code>&lt;</code>: “less than”</li>
<li><code>&lt;=</code>: “less than or equal to”</li>
<li><code>&gt;</code>: “greater than”</li>
<li><code>&gt;=</code>: “greater than or equal to”</li>
<li><code>!=</code>: “not equal to”</li>
</ul>
</div>
<p>So with this, we can use the true/false statement <code>type == "C"</code> or <code>type != "H"</code> and it’ll filter everything out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(type <span class="sc">!=</span> <span class="st">"H"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 74 × 13
  name       mfr   type  shelf weight  cups rating calories sugars protein   fat
  &lt;chr&gt;      &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 100% Bran  Nabi… C         3      1  0.33   68.4       70      6       4     1
2 100% Natu… Quak… C         3      1  1      34.0      120      8       3     5
3 All-Bran   Kell… C         3      1  0.33   59.4       70      5       4     1
4 All-Bran … Kell… C         3      1  0.5    93.7       50      0       4     0
5 Almond De… Rals… C         3      1  0.75   34.4      110      8       2     2
# ℹ 69 more rows
# ℹ 2 more variables: sodium &lt;dbl&gt;, fiber &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Poof! That hot cereal is gone, and we’re left with the 74 remaining ones.</p>
<p>Just as we can put multiple <code>mutate</code> functions combined into one, we can do the same thing with <code>filter</code>. Let’s say we want to get rid of the hot cereal <em>and</em> only keep anything with less than 7 grams of sugar per serving. All we need to do is separate them with a comma:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(type <span class="sc">!=</span> <span class="st">"H"</span>, sugars <span class="sc">&lt;</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 35 × 13
   name      mfr   type  shelf weight  cups rating calories sugars protein   fat
   &lt;chr&gt;     &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 100% Bran Nabi… C         3      1  0.33   68.4       70      6       4     1
 2 All-Bran  Kell… C         3      1  0.33   59.4       70      5       4     1
 3 All-Bran… Kell… C         3      1  0.5    93.7       50      0       4     0
 4 Bran Chex Rals… C         1      1  0.67   49.1       90      6       2     1
 5 Bran Fla… Post  C         3      1  0.67   53.3       90      5       3     0
 6 Cheerios  Gene… C         1      1  1.25   50.8      110      1       6     2
 7 Corn Chex Rals… C         1      1  1      41.4      110      3       2     0
 8 Corn Fla… Kell… C         1      1  1      45.9      100      2       2     0
 9 Crispix   Kell… C         3      1  1      46.9      110      3       2     0
10 Double C… Rals… C         3      1  0.75   44.3      100      5       2     0
# ℹ 25 more rows
# ℹ 2 more variables: sodium &lt;dbl&gt;, fiber &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We’re left with 35 cereals now, just the cold cereals with less than 7 grams of sugar. We can use this technique to stack multiple filters, such as keeping just the cold cereals that have between 6 and 8 grams of sugar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(type <span class="sc">!=</span> <span class="st">"H"</span>, sugars <span class="sc">&gt;=</span> <span class="dv">6</span>, sugars <span class="sc">&lt;=</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 13
   name      mfr   type  shelf weight  cups rating calories sugars protein   fat
   &lt;chr&gt;     &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 100% Bran Nabi… C         3   1     0.33   68.4       70      6       4     1
 2 100% Nat… Quak… C         3   1     1      34.0      120      8       3     5
 3 Almond D… Rals… C         3   1     0.75   34.4      110      8       2     2
 4 Basic 4   Gene… C         3   1.33  0.75   37.0      130      8       3     2
 5 Bran Chex Rals… C         1   1     0.67   49.1       90      6       2     1
 6 Clusters  Gene… C         3   1     0.5    40.4      110      7       3     2
 7 Cracklin… Kell… C         3   1     0.5    40.4      110      7       3     3
 8 Frosted … Kell… C         2   1     0.8    58.3      100      7       3     0
 9 Just Rig… Kell… C         3   1     1      36.5      110      6       2     1
10 Life      Quak… C         2   1     0.67   45.3      100      6       4     2
11 Multi-Gr… Gene… C         1   1     1      40.1      100      6       2     1
12 Nutri-Gr… Kell… C         3   1.33  0.67   40.7      140      7       3     2
13 Quaker O… Quak… C         3   1     0.5    49.5      100      6       4     1
14 Raisin N… Gene… C         3   1     0.5    39.7      100      8       3     2
15 Raisin S… Kell… C         3   1     0.5    55.3       90      6       2     0
16 Wheaties… Gene… C         1   1     0.75   36.2      110      8       2     1
# ℹ 2 more variables: sodium &lt;dbl&gt;, fiber &lt;dbl&gt;</code></pre>
</div>
</div>
<p>That leaves just 16 of them. What if you wanted to do the opposite, and look at cereals at the extremes, say with either 0 or 14 or more grams? Here, no cereal will satisfy both constraints since they are mutually exclusive. But some will satisfy one or the other, so we need to tell filter to do an “or”. This is done using the vertical bar <code>|</code> (on my keyboard is the key right above the “enter” key, when holding “shift”) instead of a comma. When R returns rows that satisfy either the left or the right filter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(type <span class="sc">!=</span> <span class="st">"H"</span>, sugars <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> sugars <span class="sc">&gt;=</span> <span class="dv">14</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 13
  name       mfr   type  shelf weight  cups rating calories sugars protein   fat
  &lt;chr&gt;      &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 All-Bran … Kell… C         3   1     0.5    93.7       50      0       4     0
2 Apple Jac… Kell… C         2   1     1      33.2      110     14       2     0
3 Golden Cr… Post  C         1   1     0.88   35.3      100     15       2     0
4 Post Nat.… Post  C         3   1.33  0.67   37.8      120     14       3     1
5 Puffed Ri… Quak… C         3   0.5   1      60.8       50      0       1     0
# ℹ 6 more rows
# ℹ 2 more variables: sodium &lt;dbl&gt;, fiber &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Note that here, the <code>type != "H"</code> gets evaluated separately. So this filter returns rows that are not hot cereals <em>and</em> have either 0 or 14 or more grams of sugar.</p>
<p>So what if we wanted to show just the three smallest manufacturers of cereal? You might be tempted to do something like this, stringing together a couple “or” statements:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(mfr <span class="sc">==</span> <span class="st">"Nabisco"</span> <span class="sc">|</span> mfr <span class="sc">==</span> <span class="st">"Quaker Oats"</span> <span class="sc">|</span> mfr <span class="sc">==</span> <span class="st">"Ralston Purina"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 13
  name       mfr   type  shelf weight  cups rating calories sugars protein   fat
  &lt;chr&gt;      &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 100% Bran  Nabi… C         3      1  0.33   68.4       70      6       4     1
2 100% Natu… Quak… C         3      1  1      34.0      120      8       3     5
3 Almond De… Rals… C         3      1  0.75   34.4      110      8       2     2
4 Bran Chex  Rals… C         1      1  0.67   49.1       90      6       2     1
5 Cap'n'Cru… Quak… C         2      1  0.75   18.0      120     12       1     2
# ℹ 16 more rows
# ℹ 2 more variables: sodium &lt;dbl&gt;, fiber &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This works just fine, but it seems a but cumbersome, especially if the list of factors you want to show is long. We can actually use a different operator, the fancy looking <code>%in%</code>, which will check whether something exists inside of a list. On the left we put the column we want to filter by and on the right we supply a list of strings we want it to look through.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(mfr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Nabisco"</span>, <span class="st">"Quaker Oats"</span>, <span class="st">"Ralston Purina"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 13
  name       mfr   type  shelf weight  cups rating calories sugars protein   fat
  &lt;chr&gt;      &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 100% Bran  Nabi… C         3      1  0.33   68.4       70      6       4     1
2 100% Natu… Quak… C         3      1  1      34.0      120      8       3     5
3 Almond De… Rals… C         3      1  0.75   34.4      110      8       2     2
4 Bran Chex  Rals… C         1      1  0.67   49.1       90      6       2     1
5 Cap'n'Cru… Quak… C         2      1  0.75   18.0      120     12       1     2
# ℹ 16 more rows
# ℹ 2 more variables: sodium &lt;dbl&gt;, fiber &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Incidentally, you can reverse this, and just show rows where the manufacturer is <em>not</em> one of those three by simply putting an exclamation point before the column name:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>mfr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Nabisco"</span>, <span class="st">"Quaker Oats"</span>, <span class="st">"Ralston Purina"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 13
  name       mfr   type  shelf weight  cups rating calories sugars protein   fat
  &lt;chr&gt;      &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 All-Bran   Kell… C         3   1     0.33   59.4       70      5       4     1
2 All-Bran … Kell… C         3   1     0.5    93.7       50      0       4     0
3 Apple Cin… Gene… C         1   1     0.75   29.5      110     10       2     2
4 Apple Jac… Kell… C         2   1     1      33.2      110     14       2     0
5 Basic 4    Gene… C         3   1.33  0.75   37.0      130      8       3     2
# ℹ 49 more rows
# ℹ 2 more variables: sodium &lt;dbl&gt;, fiber &lt;dbl&gt;</code></pre>
</div>
</div>
<p>So the filter is powerful. I use it all the time to make various subsets of my data. It does exactly what I want it to do, and while you may have to type a couple symbols you don’t normally do, the syntax is easy to pick up.</p>
</section>
<section id="changing-column-names" class="level3">
<h3 class="anchored" data-anchor-id="changing-column-names">Changing column names</h3>
<p>The final thing I’d like to show for this workshop is how to rename columns. There are lots of reasons for why you might want to do this. In the ggplot2 workshop, we saw how to do this on the fly within a block of <code>ggplot</code> code, but sometimes you want to make it a permanent change to your data. Using the tools you have now, you might be tempted to simply create a new column that’s a copy of the old one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">manufacturer =</span> mfr) <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But the problem is you end up with two identical columns. Okay fine, we can then remove the old one:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">manufacturer =</span> mfr) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>mfr) <span class="sc">%&gt;%</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 75 × 13
  name      type  shelf weight  cups rating calories sugars protein   fat sodium
  &lt;chr&gt;     &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 100% Bran C         3      1  0.33   68.4       70      6       4     1    130
2 100% Nat… C         3      1  1      34.0      120      8       3     5     15
3 All-Bran  C         3      1  0.33   59.4       70      5       4     1    260
4 All-Bran… C         3      1  0.5    93.7       50      0       4     0    140
5 Almond D… C         3      1  0.75   34.4      110      8       2     2    200
# ℹ 70 more rows
# ℹ 2 more variables: fiber &lt;dbl&gt;, manufacturer &lt;fct&gt;</code></pre>
</div>
</div>
<p>Okay, but now the columns are out of order. You’ll have to then put them back in the correct order:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">manufacturer =</span> mfr) <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(name, manufacturer, <span class="fu">everything</span>(), <span class="sc">-</span>mfr) <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 75 × 13
  name      manufacturer type  shelf weight  cups rating calories sugars protein
  &lt;chr&gt;     &lt;fct&gt;        &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 100% Bran Nabisco      C         3      1  0.33   68.4       70      6       4
2 100% Nat… Quaker Oats  C         3      1  1      34.0      120      8       3
3 All-Bran  Kellogg's    C         3      1  0.33   59.4       70      5       4
4 All-Bran… Kellogg's    C         3      1  0.5    93.7       50      0       4
5 Almond D… Ralston Pur… C         3      1  0.75   34.4      110      8       2
# ℹ 70 more rows
# ℹ 3 more variables: fat &lt;dbl&gt;, sodium &lt;dbl&gt;, fiber &lt;dbl&gt;</code></pre>
</div>
</div>
<p>That seems like a lot of work, and it’s quite error prone if you have lots of columns and lots of changes to make. Fortunately, <code>dplyr</code> has the <code>rename</code> function, which does all this in one simple line of code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">manufacturer =</span> mfr)  <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 75 × 13
  name      manufacturer type  shelf weight  cups rating calories sugars protein
  &lt;chr&gt;     &lt;fct&gt;        &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 100% Bran Nabisco      C         3      1  0.33   68.4       70      6       4
2 100% Nat… Quaker Oats  C         3      1  1      34.0      120      8       3
3 All-Bran  Kellogg's    C         3      1  0.33   59.4       70      5       4
4 All-Bran… Kellogg's    C         3      1  0.5    93.7       50      0       4
5 Almond D… Ralston Pur… C         3      1  0.75   34.4      110      8       2
# ℹ 70 more rows
# ℹ 3 more variables: fat &lt;dbl&gt;, sodium &lt;dbl&gt;, fiber &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Poof. It’s as easy as that.</p>
<p>Technically, you can actually rename columns within <code>select</code>. So if you really want to combine renaming, reordering, and removing columns at once, you can. You do this by putting the new name in ticks (the thing next to the “1” key with the tilde) and an equals sign before the old name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>cereal <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(name, <span class="st">`</span><span class="at">manufacturer</span><span class="st">`</span> <span class="ot">=</span> mfr, rating) <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 75 × 3
   name                      manufacturer   rating
   &lt;chr&gt;                     &lt;fct&gt;           &lt;dbl&gt;
 1 100% Bran                 Nabisco          68.4
 2 100% Natural Bran         Quaker Oats      34.0
 3 All-Bran                  Kellogg's        59.4
 4 All-Bran with Extra Fiber Kellogg's        93.7
 5 Almond Delight            Ralston Purina   34.4
 6 Apple Cinnamon Cheerios   General Mills    29.5
 7 Apple Jacks               Kellogg's        33.2
 8 Basic 4                   General Mills    37.0
 9 Bran Chex                 Ralston Purina   49.1
10 Bran Flakes               Post             53.3
# ℹ 65 more rows</code></pre>
</div>
</div>
<p>I don’t really use this very often because I like to make the renaming explicit, but it’s a nice shortcut if you need it.</p>
<section id="your-turn-4" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="your-turn-4">Your turn!</h4>
<section id="the-challenge-4" class="level5">
<h5 class="anchored" data-anchor-id="the-challenge-4">The challenge</h5>
<p>Try doing the following steps all as one series of piped functions. There’s no strict order that they need to apply so you’re free to organize the code in a way that makes sense to you.</p>
<ol type="1">
<li><p>Read in the cereal data frame, making sure that the <code>type</code> and <code>mfr</code> columns are read in as factors.</p></li>
<li><p>Create a column for the amount of sugar per cup.</p></li>
<li><p>Get rid of all the columns except the name of the cereal, the manufacturer, and the new column with the amount of cereal per cup.</p></li>
<li><p>Change the <code>mfr</code> column so that full names are used instead of just abbreviations.</p></li>
<li><p>Order the factors in the <code>mfr</code> column in order of frequency.</p></li>
<li><p>Sort the dataframe by how much sugar there is per cup.</p></li>
<li><p>Rename the <code>mfr</code> column to <code>manufactuer</code></p></li>
<li><p>Only display cereals where the rating is higher than the average. (Hint: you may need the <code>mean()</code> function.)</p></li>
</ol>
</section>
<section id="the-solution-4" class="level5">
<h5 class="anchored" data-anchor-id="the-solution-4">The solution</h5>
<p>Here is my complete block of code. I’ve explained by process underneath.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read it in as a tab-delineated file</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>cereal <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Users/joeystanley/Desktop/github/joeystanley/data/cereal.txt"</span>, </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Make sure the column types are correct.</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="cn">NULL</span>),</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">mfr  =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="cn">NULL</span>)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>           )) <span class="sc">%&gt;%</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename manufacturer</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">manufacturer =</span> mfr) <span class="sc">%&gt;%</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Only show those that are better than average rating.</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(rating <span class="sc">&gt;</span> <span class="fu">mean</span>(rating)) <span class="sc">%&gt;%</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create the sugar_per_cup variable</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sugar_per_cup =</span> sugars <span class="sc">/</span> cups,</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Recode the manufacturers</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">manufacturer =</span> <span class="fu">fct_recode</span>(manufacturer,</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Kellogg's"</span> <span class="ot">=</span> <span class="st">"K"</span>,</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"General Mills"</span> <span class="ot">=</span> <span class="st">"G"</span>,</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Post"</span> <span class="ot">=</span> <span class="st">"P"</span>,</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Quaker Oats"</span> <span class="ot">=</span> <span class="st">"Q"</span>,</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Ralston Purina"</span> <span class="ot">=</span> <span class="st">"R"</span>,</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Nabisco"</span> <span class="ot">=</span> <span class="st">"N"</span>),</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Put the manufacturers in order of frequency. </span></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">manufacturer =</span> <span class="fu">fct_infreq</span>(manufacturer)) <span class="sc">%&gt;%</span></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort the rows in order of sugars</span></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="sc">-</span>sugar_per_cup) <span class="sc">%&gt;%</span></span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 14
  name      manufacturer type  shelf weight  cups rating calories sugars protein
  &lt;chr&gt;     &lt;fct&gt;        &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 100% Bran Nabisco      C         3      1  0.33   68.4       70      6       4
2 All-Bran  Kellogg's    C         3      1  0.33   59.4       70      5       4
3 Great Gr… Post         C         3      1  0.33   45.8      120      4       3
4 Grape-Nu… Post         C         3      1  0.25   53.4      110      3       3
5 Quaker O… Quaker Oats  C         3      1  0.5    49.5      100      6       4
# ℹ 23 more rows
# ℹ 4 more variables: fat &lt;dbl&gt;, sodium &lt;dbl&gt;, fiber &lt;dbl&gt;, sugar_per_cup &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot it</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cereal, <span class="fu">aes</span>(manufacturer)) <span class="sc">+</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Of course, the first thing I do is read in the data, but the very next step I like to do is rename the columns. They way I don’t refer to <code>mfr</code> for part of the block and <code>manufacturer</code> in another part.</p>
<p>I then filter the data to only show those with a higher-than-average rating. The filter is early in the block for two reasons. First, it cuts down on the number of remaining rows in the dataset early on. In theory, this makes the whole block of code run faster because the subsequent functions don’t have to work with quite as much data. In small datasets like this, the difference is negligible, but if you work with very large datasets and run complicated functions, this can save a lot of time.</p>
<p>The second reason is that it comes early, specifically, before sorting the manufacturer levels frequency, is that the order of the manufacturers does in fact change after we’ve applied the filter. If you compare this to the following very similar block that has been modified so that the filter comes last, you’ll see that the bars are in a different order, namely the original order of how many brands of cereal there are per company.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read it in as a tab-delineated file</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>cereal <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Users/joeystanley/Desktop/github/joeystanley/data/cereal.txt"</span>, </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Make sure the column types are correct.</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="cn">NULL</span>),</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">mfr  =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="cn">NULL</span>)</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>           )) <span class="sc">%&gt;%</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename manufacturer</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">manufacturer =</span> mfr) <span class="sc">%&gt;%</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create the sugar_per_cup variable</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sugar_per_cup =</span> sugars <span class="sc">/</span> cups,</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Recode the manufacturers</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">manufacturer =</span> <span class="fu">fct_recode</span>(manufacturer,</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Kellogg's"</span> <span class="ot">=</span> <span class="st">"K"</span>,</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"General Mills"</span> <span class="ot">=</span> <span class="st">"G"</span>,</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Post"</span> <span class="ot">=</span> <span class="st">"P"</span>,</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Quaker Oats"</span> <span class="ot">=</span> <span class="st">"Q"</span>,</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Ralston Purina"</span> <span class="ot">=</span> <span class="st">"R"</span>,</span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Nabisco"</span> <span class="ot">=</span> <span class="st">"N"</span>),</span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Put the manufacturers in order of frequency. </span></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">manufacturer =</span> <span class="fu">fct_infreq</span>(manufacturer)) <span class="sc">%&gt;%</span></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort the rows in order of sugars</span></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="sc">-</span>sugar_per_cup) <span class="sc">%&gt;%</span></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Only show those that are better than average rating.</span></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(rating <span class="sc">&gt;</span> <span class="fu">mean</span>(rating)) <span class="sc">%&gt;%</span></span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28 × 14
   name     manufacturer type  shelf weight  cups rating calories sugars protein
   &lt;chr&gt;    &lt;fct&gt;        &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 100% Br… Nabisco      C         3      1  0.33   68.4       70      6       4
 2 All-Bran Kellogg's    C         3      1  0.33   59.4       70      5       4
 3 Great G… Post         C         3      1  0.33   45.8      120      4       3
 4 Grape-N… Post         C         3      1  0.25   53.4      110      3       3
 5 Quaker … Quaker Oats  C         3      1  0.5    49.5      100      6       4
 6 Raisin … Kellogg's    C         3      1  0.5    55.3       90      6       2
 7 Bran Ch… Ralston Pur… C         1      1  0.67   49.1       90      6       2
 8 Life     Quaker Oats  C         2      1  0.67   45.3      100      6       4
 9 Frosted… Kellogg's    C         2      1  0.8    58.3      100      7       3
10 Bran Fl… Post         C         3      1  0.67   53.3       90      5       3
# ℹ 18 more rows
# ℹ 4 more variables: fat &lt;dbl&gt;, sodium &lt;dbl&gt;, fiber &lt;dbl&gt;, sugar_per_cup &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot it</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cereal, <span class="fu">aes</span>(manufacturer)) <span class="sc">+</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>(Incidentally, we learn a lot about Nabisco and General Mills through this: Nabisco has relatively few kinds of cereal, but they tend to be rated pretty high, while General Mills has a lot that get generally lower ratings.)</p>
</section>
</section>
</section>
</section>
<section id="final-remarks" class="level2">
<h2 class="anchored" data-anchor-id="final-remarks">Final remarks</h2>
<p>This workshops has covered a <em>lot</em> of material. But, it’s clear that the tidyverse offers a lot for you. You can manipulate and clean your data all you want, often in a single block of code. The code is easier to type and it’s easier for you to read later on when you come back to it.</p>
<p>In a future tidyverse workshop, we’ll cover even more powerful functions like how to merge tables together, perform functions on groups of data (such as only showing the top three cereals for each manufacturer), and reshaping your data from “tall” to “wide” format. But for now, I hope what you’ve learned here will be useful for you and your data.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Additional Materials">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Additional Materials
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may also be interested in <a href="../../../downloads/180119-intro-to-r-part1.pdf">a PDF of the slides I used</a> when I first taught this material as an in-person workshop. An older version that includes additional content can be found here as a <a href="../../../downloads/170912-intro-to-r-handout.pdf">PDF</a> or an <a href="../../../downloads/170913-intro_to_R.html">html</a> file.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This page is largely the same as the second part of <a href="../../../downloads/180119-intro-to-r-part1.html">this tutorial</a> from 2017. The only changes are some slight edits here and there and updates to reflect software changes in the past seven years.</p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/joeystanley\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>