<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joey Stanley">
<meta name="dcterms.date" content="2025-03-21">

<title>Simulating Candyland – Joey Stanley</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=350348361"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '350348361', { 'anonymize_ip': true});
</script>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,200..900;1,200..900&amp;family=Noto+Music&amp;family=Noto+Sans+Display:ital,wght@0,100..900;1,100..900&amp;family=Noto+Sans+Math&amp;family=Noto+Sans+Mono:wght@100..900&amp;family=Noto+Sans:ital,wght@0,100..900;1,100..900&amp;family=Noto+Serif+Display:ital,wght@0,100..900;1,100..900&amp;family=Noto+Serif:ital,wght@0,100..900;1,100..900&amp;display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title"><span id="name">Joey Stanley</span><br><span id="tagline">assistant professor, linguistics</span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About Me <em>who am I?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv/index.html"> 
<span class="menu-text">CV <em>what have I done?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research/index.html"> 
<span class="menu-text">Research <em>what do I research?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html"> 
<span class="menu-text">Teaching <em>what do I teach?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pages/idiolect"> 
<span class="menu-text">Idiolect <em>what do I sound like?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog <em>what’s going on?</em></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:joey_stanley@byu.edu"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-list" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-list" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-list">    
        <li>
    <a class="dropdown-item" href="https://bsky.app/profile/joeystanley.com">
 <span class="dropdown-text"><i class="fa-brands fa-bluesky" aria-label="bluesky"></i> Bluesky</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://twitter.com/joey_stan"><i class="bi bi-twitter" role="img">
</i> 
 <span class="dropdown-text">Twitter</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://scholar.google.com/citations?user=61pJV_YAAAAJ&amp;hl=en&amp;oi=sra"><i class="bi bi-mortarboard-fill" role="img">
</i> 
 <span class="dropdown-text">Google Scholar</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/JoeyStanley/joeystanley_new"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Github</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../joeystanley.com/feed.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="dropdown-text">RSS feed</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Simulating Candyland</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Side Projects</div>
                <div class="quarto-category">Simulations</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Joey Stanley </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 21, 2025</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">March 21, 2025</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-simulation" id="toc-the-simulation" class="nav-link active" data-scroll-target="#the-simulation"><span class="header-section-number">1</span> The simulation</a>
  <ul class="collapse">
  <li><a href="#setting-up-the-game" id="toc-setting-up-the-game" class="nav-link" data-scroll-target="#setting-up-the-game"><span class="header-section-number">1.1</span> Setting up the game</a></li>
  </ul></li>
  <li><a href="#explaining-the-simulation" id="toc-explaining-the-simulation" class="nav-link" data-scroll-target="#explaining-the-simulation"><span class="header-section-number">2</span> Explaining the simulation</a>
  <ul class="collapse">
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries"><span class="header-section-number">2.1</span> Preliminaries</a></li>
  <li><a href="#setting-up-the-loop" id="toc-setting-up-the-loop" class="nav-link" data-scroll-target="#setting-up-the-loop"><span class="header-section-number">2.2</span> Setting up the loop</a></li>
  <li><a href="#start-at-tile-zero" id="toc-start-at-tile-zero" class="nav-link" data-scroll-target="#start-at-tile-zero"><span class="header-section-number">2.3</span> Start at tile zero</a></li>
  <li><a href="#adding-candy-cards" id="toc-adding-candy-cards" class="nav-link" data-scroll-target="#adding-candy-cards"><span class="header-section-number">2.4</span> Adding candy cards</a></li>
  <li><a href="#adding-other-cards" id="toc-adding-other-cards" class="nav-link" data-scroll-target="#adding-other-cards"><span class="header-section-number">2.5</span> Adding other cards</a></li>
  <li><a href="#ending-the-game" id="toc-ending-the-game" class="nav-link" data-scroll-target="#ending-the-game"><span class="header-section-number">2.6</span> Ending the game</a></li>
  <li><a href="#adding-shortcuts" id="toc-adding-shortcuts" class="nav-link" data-scroll-target="#adding-shortcuts"><span class="header-section-number">2.7</span> Adding shortcuts</a></li>
  <li><a href="#wrap-it-up-into-a-function" id="toc-wrap-it-up-into-a-function" class="nav-link" data-scroll-target="#wrap-it-up-into-a-function"><span class="header-section-number">2.8</span> Wrap it up into a function</a></li>
  <li><a href="#simulate-lots-of-games" id="toc-simulate-lots-of-games" class="nav-link" data-scroll-target="#simulate-lots-of-games"><span class="header-section-number">2.9</span> Simulate lots of games!</a></li>
  </ul></li>
  <li><a href="#sec-results" id="toc-sec-results" class="nav-link" data-scroll-target="#sec-results"><span class="header-section-number">3</span> Results</a>
  <ul class="collapse">
  <li><a href="#sec-num_turns" id="toc-sec-num_turns" class="nav-link" data-scroll-target="#sec-num_turns"><span class="header-section-number">3.1</span> Number of turns</a></li>
  <li><a href="#single-color-cards" id="toc-single-color-cards" class="nav-link" data-scroll-target="#single-color-cards"><span class="header-section-number">3.2</span> Single-color cards</a></li>
  <li><a href="#double-color-cards" id="toc-double-color-cards" class="nav-link" data-scroll-target="#double-color-cards"><span class="header-section-number">3.3</span> Double-color cards</a></li>
  <li><a href="#shortcuts" id="toc-shortcuts" class="nav-link" data-scroll-target="#shortcuts"><span class="header-section-number">3.4</span> Shortcuts</a></li>
  <li><a href="#candy-cards" id="toc-candy-cards" class="nav-link" data-scroll-target="#candy-cards"><span class="header-section-number">3.5</span> Candy Cards</a></li>
  <li><a href="#sec-gains_and_losses" id="toc-sec-gains_and_losses" class="nav-link" data-scroll-target="#sec-gains_and_losses"><span class="header-section-number">3.6</span> Gains and Losses</a></li>
  <li><a href="#most-likely-tiles" id="toc-most-likely-tiles" class="nav-link" data-scroll-target="#most-likely-tiles"><span class="header-section-number">3.7</span> Most likely tiles</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">3.8</span> Summary</a></li>
  </ul></li>
  <li><a href="#changes" id="toc-changes" class="nav-link" data-scroll-target="#changes"><span class="header-section-number">4</span> Changes</a>
  <ul class="collapse">
  <li><a href="#triple-cards" id="toc-triple-cards" class="nav-link" data-scroll-target="#triple-cards"><span class="header-section-number">4.1</span> Triple cards</a></li>
  <li><a href="#sec-removing_candies" id="toc-sec-removing_candies" class="nav-link" data-scroll-target="#sec-removing_candies"><span class="header-section-number">4.2</span> Removing Candies</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">5</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<p>About six years ago, I did a blog post about how I <a href="../../blog/simulating_chutes_and_ladders">simulated Chutes and Ladders</a> after playing it countless times with my child. Recently, I’ve been playing tons of Candyland with my next child. The games are kinda similar and they take zero skill, which means they’re perfect for little kiddos. It also means I can simulate them pretty easily.</p>
<p>I’m going to base the game off the board that I’ve been playing with, which we got at a thrift store. Here’s what that looks like:</p>
<p><img src="board.jpg" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re not interested in how I did the simulation and just want to see the results, just jump to <a href="#sec-results" class="quarto-xref">Section&nbsp;3</a>.</p>
</div>
</div>
<section id="the-simulation" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="the-simulation"><span class="header-section-number">1</span> The simulation</h2>
<section id="setting-up-the-game" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="setting-up-the-game"><span class="header-section-number">1.1</span> Setting up the game</h3>
<p>The first step in simulating Candyland is to set up the board. There’s no real easy way to do that, so I just went through and hard-coded the tiles and colors. I’ve got a simple dataframe with a column for the tile number, the color of the tile, and if there’s anything special about it. In my original spreadsheet, if there was nothing special about the tile, I left it blank, but because of issues with <code>NA</code>s down the road, I’ve replaced those blank cells with <code>"none"</code>. Here’s what that looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>board <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"candyland_data.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">special =</span> <span class="fu">replace_na</span>(special, <span class="st">"none"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 132 × 3
    tile color  special              
   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;                
 1     1 red    none                 
 2     2 purple none                 
 3     3 yellow none                 
 4     4 blue   peppermint pass start
 5     5 orange none                 
 6     6 green  none                 
 7     7 red    none                 
 8     8 purple none                 
 9     9 pink   cupcake              
10    10 yellow none                 
# ℹ 122 more rows</code></pre>
</div>
</div>
<p>Now that we’ve got the board, we need to get the cards. This one is actually straightforward enough that I can create it on the fly. First, I’ll create the seven candy cards. I’m not sure if these are the official names, but that’s what we call them in my house.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>candy_cards <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cupcake"</span>, <span class="st">"ice cream cone"</span>, <span class="st">"gummy star"</span>, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"gingerbread man"</span>, <span class="st">"lollipop"</span>, <span class="st">"popsicle"</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"chocolate truffle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are six “single-color” cards four “double-color” cards for each color. So, I’ve first created a function that takes in a color name and creates those ten cards as a vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>create_one_color_card <span class="ot">&lt;-</span> <span class="cf">function</span>(.color) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"double "</span>, .color), <span class="dv">4</span>), </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"single "</span>, .color), <span class="dv">6</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">create_one_color_card</span>(<span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "double red" "double red" "double red" "double red" "single red"
 [6] "single red" "single red" "single red" "single red" "single red"</code></pre>
</div>
</div>
<p>So now, I can use that those to generate the full deck of 67 cards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>cards <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">create_one_color_card</span>(<span class="st">"red"</span>),</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"purple"</span>),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"yellow"</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"blue"</span>),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"orange"</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"green"</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>           candy_cards)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(cards)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "single red"        "popsicle"          "single purple"    
 [4] "single purple"     "single green"      "single yellow"    
 [7] "gingerbread man"   "double blue"       "single orange"    
[10] "single blue"       "single red"        "double orange"    
[13] "single yellow"     "double yellow"     "single green"     
[16] "single green"      "single red"        "single orange"    
[19] "single red"        "single green"      "double blue"      
[22] "single green"      "double orange"     "single purple"    
[25] "double yellow"     "single blue"       "single orange"    
[28] "double purple"     "double yellow"     "single green"     
[31] "double red"        "lollipop"          "single purple"    
[34] "single purple"     "single red"        "ice cream cone"   
[37] "double purple"     "single purple"     "double green"     
[40] "double yellow"     "double red"        "single blue"      
[43] "single yellow"     "double red"        "single blue"      
[46] "single blue"       "single orange"     "single red"       
[49] "double blue"       "double red"        "single yellow"    
[52] "double orange"     "cupcake"           "gummy star"       
[55] "single orange"     "single yellow"     "chocolate truffle"
[58] "double blue"       "single orange"     "double green"     
[61] "double green"      "double purple"     "double purple"    
[64] "double orange"     "double green"      "single blue"      
[67] "single yellow"    </code></pre>
</div>
</div>
<p>So, with the board and cards set up, let’s start simulating some games. Note that because there is virtually zero interaction between the players, I’m just going to simulate single-player games.</p>
</section>
</section>
<section id="explaining-the-simulation" class="level2 page-columns page-full" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="explaining-the-simulation"><span class="header-section-number">2</span> Explaining the simulation</h2>
<p>In this section, I’ll explain the mechanics of the simulation. If you’re not interested in that and just want to get to the results, feel free to skip to <a href="#sec-results" class="quarto-xref">Section&nbsp;3</a>. The mechanics are similar to my <a href="../../blog/simulating-chutes-and-ladders">Chutes and Ladders</a> simulation.</p>
<section id="preliminaries" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">2.1</span> Preliminaries</h3>
<p>First, I want to allocate space for a full game. First, I’ll create a tibble called <code>turns</code> that has as many rows as twice the number of cards in the deck. After doing some simulations, I’ve found that, very rarely, a single player can get through all the cards and will need to shuffle them. I haven’t yet run into a simulation where a second shuffle is needed, though I suppose it could theoretically go on forever I think.</p>
<p>I’ll then simulate shuffling the cards by randomly sorting the cards with <code>sample(cards, replace = FALSE)</code>. And I’ll string—not shuffle—two decks together in case we have a really long game. I’ll do that by just doing that <code>sample(...)</code> two times and strung together with <code>c()</code>.</p>
<p>As additional columns in this tibble, I’ll create empty columns for the start time number, the end tile number, whether that tile was a shortcut or not. Those will be populated as the game happens.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>n_cards <span class="ot">&lt;-</span> <span class="fu">length</span>(cards)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>turns <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">turn_num =</span> <span class="dv">1</span><span class="sc">:</span>(n_cards<span class="sc">*</span><span class="dv">2</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">start    =</span> <span class="cn">NA</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">card  =</span> <span class="fu">c</span>(<span class="fu">sample</span>(cards, <span class="at">replace =</span> <span class="cn">FALSE</span>), </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">sample</span>(cards, <span class="at">replace =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">shortcut =</span> <span class="cn">NA</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">end      =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since I’ll need to do this a lot in the explanation of the simulation, I’ll save it as a function so it takes up less room.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>setup_turns <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  n_cards <span class="ot">&lt;-</span> <span class="fu">length</span>(cards)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">turn_num =</span> <span class="dv">1</span><span class="sc">:</span>(n_cards<span class="sc">*</span><span class="dv">2</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">start    =</span> <span class="cn">NA</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">card  =</span> <span class="fu">c</span>(<span class="fu">sample</span>(cards, <span class="at">replace =</span> <span class="cn">FALSE</span>), </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sample</span>(cards, <span class="at">replace =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">shortcut =</span> <span class="cn">NA</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">end      =</span> <span class="cn">NA</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>turns <span class="ot">&lt;-</span> <span class="fu">setup_turns</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="setting-up-the-loop" class="level3 page-columns page-full" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="setting-up-the-loop"><span class="header-section-number">2.2</span> Setting up the loop</h3>
<p>Now that we’ve got the cards shuffled and ready to go for this game, let’s start the turns. Since I don’t know how many iterations I’ll need, I’ll set up a <code>while</code> loop that goes until I tell it to stop.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Here’s what the barebones loop looks like:</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;There might be a more elegant way using <code>for</code> loop. Maybe my R looping skills aren’t where they need to be, but I just couldn’t figure out how to get it to exit the loop the way I wanted to and return the dataframe. I’ve hacked a bit of a solution by incrementing <code>i</code> each iteration. I miss Perl’s <code>last</code> function which made it so that it would exit the loop at the end of the current iteration, not necessarily right at that moment like R’s <code>break</code> function does. The <code>keep_playing</code> variable simulates that.</p></div></div><div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>turns <span class="ot">&lt;-</span> <span class="fu">setup_turns</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop until the game is over</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(keep_playing) {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put the game here</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># don't run this code though; it'll go on forever</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Of course, this is going to run forever because we haven’t put in any for it to stop. So I’ll increment <code>i</code> each iteration and end the loop after <code>n_cards*2</code> iterations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>turns <span class="ot">&lt;-</span> <span class="fu">setup_turns</span>()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop until the game is over</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(keep_playing) {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;=</span> (n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Okay, so we’re now looping through code enough times to go through the game. Now let’s start to add some content to that game.</p>
</section>
<section id="start-at-tile-zero" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="start-at-tile-zero"><span class="header-section-number">2.3</span> Start at tile zero</h3>
<p>First, I need to get the start tile. On the first turn, the start tile is zero. Let’s add that. Here’s what that code looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, I’ve added a conditional that checks what iteration number we’re on. If we’re on the first one, then go ahead and declare the start tile for this iteration to be zero. Here’s that code in context:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>turns <span class="ot">&lt;-</span> <span class="fu">setup_turns</span>()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(keep_playing) {</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the start tile</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># End the game</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;=</span> (n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>turns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 134 × 5
   turn_num start card          shortcut end  
      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;lgl&gt;    &lt;lgl&gt;
 1        1     0 single red    NA       NA   
 2        2    NA double orange NA       NA   
 3        3    NA double red    NA       NA   
 4        4    NA lollipop      NA       NA   
 5        5    NA double purple NA       NA   
 6        6    NA single green  NA       NA   
 7        7    NA double green  NA       NA   
 8        8    NA double orange NA       NA   
 9        9    NA single yellow NA       NA   
10       10    NA single yellow NA       NA   
# ℹ 124 more rows</code></pre>
</div>
</div>
<p>Later on, we’ll add code saying that the start tile for all other turns is the end tile of the previous turn, but because we haven’t added any code yet for the end tiles, it won’t do us any good yet. So, to avoid issues with <code>NA</code>s, I’ll skip that for now.</p>
</section>
<section id="adding-candy-cards" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="adding-candy-cards"><span class="header-section-number">2.4</span> Adding candy cards</h3>
<p>What we do need to do though is “draw a card” and figure out how many tiles we need to advance. Keep in mind that the cards are already there for us, so we don’t need to randomly sample from the deck or anything. We just need to take the info that’s already there and use it to figure out where to end up.</p>
<p>First, let’s account for the candy cards. These are easy: regardless of what your start tile is, your end tile will always be the same. The code that I’ll add looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (turns<span class="sc">$</span>card[[i]] <span class="sc">%in%</span> candy_cards) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> board[board<span class="sc">$</span>special <span class="sc">==</span> turns<span class="sc">$</span>card[[i]],]<span class="sc">$</span>tile</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So here, I’m checking to see if the name of the card that has been assigned for this turn matches the one of the candy cards I have saved in the <code>candy_cards</code> vector I declared earlier. If there’s a match, then I’ll basically look up the tile of that candy card in my <code>board</code> dataframe—that’s the one I manually created in a separate file. It searches for the name of the candy, and fetches the tile number for it. That number is then assigned to this turn’s end tile. Here’s that code in context:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>turns <span class="ot">&lt;-</span> <span class="fu">setup_turns</span>()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(keep_playing) {</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the start tile</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If it's a candy card, go straight there.</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (turns<span class="sc">$</span>card[[i]] <span class="sc">%in%</span> candy_cards) {</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> board[board<span class="sc">$</span>special <span class="sc">==</span> turns<span class="sc">$</span>card[[i]],]<span class="sc">$</span>tile</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># End the game</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;=</span> (n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>turns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 134 × 5
   turn_num start card           shortcut   end
      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;          &lt;lgl&gt;    &lt;dbl&gt;
 1        1     0 double yellow  NA          NA
 2        2    NA double red     NA          NA
 3        3    NA ice cream cone NA          20
 4        4    NA single yellow  NA          NA
 5        5    NA double yellow  NA          NA
 6        6    NA double purple  NA          NA
 7        7    NA single green   NA          NA
 8        8    NA single red     NA          NA
 9        9    NA single orange  NA          NA
10       10    NA double yellow  NA          NA
# ℹ 124 more rows</code></pre>
</div>
</div>
<p>So far, the game does nothing unless you run into a candy card. If you do, it’ll note where the end position should be.</p>
<p>At this point, I might as well add some code in that makes it so that the start tile of the next turn is the previous tile of the last turn.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>turns <span class="ot">&lt;-</span> <span class="fu">setup_turns</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(keep_playing) {</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the start tile</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Otherwise, start where the last turn ended.</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> turns<span class="sc">$</span>end[[i <span class="sc">-</span> <span class="dv">1</span>]]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If it's a candy card, go straight there.</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (turns<span class="sc">$</span>card[[i]] <span class="sc">%in%</span> candy_cards) {</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> board[board<span class="sc">$</span>special <span class="sc">==</span> turns<span class="sc">$</span>card[[i]],]<span class="sc">$</span>tile</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;=</span> (n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>turns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 134 × 5
   turn_num start card              shortcut   end
      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;lgl&gt;    &lt;dbl&gt;
 1        1     0 double green      NA          NA
 2        2    NA double red        NA          NA
 3        3    NA double orange     NA          NA
 4        4    NA chocolate truffle NA         117
 5        5   117 double green      NA          NA
 6        6    NA double green      NA          NA
 7        7    NA single green      NA          NA
 8        8    NA gingerbread man   NA          69
 9        9    69 single green      NA          NA
10       10    NA single yellow     NA          NA
# ℹ 124 more rows</code></pre>
</div>
</div>
<p>So in the above game, we see that we got candy tiles in two of the first couple turns. The end position is saved and the start position of the next turn is the same.</p>
</section>
<section id="adding-other-cards" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="adding-other-cards"><span class="header-section-number">2.5</span> Adding other cards</h3>
<p>Adding the colored cards is slightly less straightforward than the candy cards, but still isn’t too bad. There are two kinds of cards for each color: single cards, which means you advance to the next tile of that color, and double cards, which means you advance to to the second next tile of that color. Keep in mind that the cards have already been shuffled and assigned turns, so all I need to do is take the card and figure out how far I need to get.</p>
<p>So, right now, the cards take the form of a character vector with values like <code>"single red"</code> or <code>"double blue"</code>. To extract the color, I’ll use <code>str_extract</code> and pull out the last word. And to get whether it’s a single or double, I’ll do the same thing and pull out the first word.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>card_color  <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">Z"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>card_amount <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">A</span><span class="sc">\\</span><span class="st">w+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, I need to figure out where to go then. I’m less concerned about figuring out the exact number of tiles I need to advance. I think it’ll be easier to select all upcoming tiles of that color and find the tile number of the first or second one. So, first, I’ll create <code>eligible_spots</code>, which takes the board, filters it so that only tiles greater than the tile I’m on and whose color matches the card I drew, and pull out just the tile numbers. So if my starting position were 0 and I drew a single red, here are the eligible spots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>start_position <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>card_color <span class="ot">&lt;-</span> <span class="st">"red"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>eligible_spots <span class="ot">&lt;-</span> board <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tile <span class="sc">&gt;</span> start_position,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         color <span class="sc">==</span> card_color) <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(tile)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>eligible_spots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]   1   7  14  21  27  33  39  46  52  58  64  71  77  83  89  96 103 109 115
[20] 121 127</code></pre>
</div>
</div>
<p>Now I need to just take the first one if it’s a single card and then take the second one if it’s a double.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (card_amount <span class="sc">==</span> <span class="st">"single"</span>) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">1</span>]]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">2</span>]]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>turns<span class="sc">$</span>end[[i]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now if we just incorporate that bit of code into the main loop, we <em>should</em> be well on our way to a functioning game.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>turns <span class="ot">&lt;-</span> <span class="fu">setup_turns</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(keep_playing) {</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the start tile</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Otherwise, start where the last turn ended.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> turns<span class="sc">$</span>end[[i <span class="sc">-</span> <span class="dv">1</span>]]</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If it's a candy card, go straight there.</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (turns<span class="sc">$</span>card[[i]] <span class="sc">%in%</span> candy_cards) {</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> board[board<span class="sc">$</span>special <span class="sc">==</span> turns<span class="sc">$</span>card[[i]],]<span class="sc">$</span>tile</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If it's not, find the next colors.</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    card_color  <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">Z"</span>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    card_amount <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">A</span><span class="sc">\\</span><span class="st">w+"</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move to the next spot</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    eligible_spots <span class="ot">&lt;-</span> board <span class="sc">|&gt;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(tile <span class="sc">&gt;</span> turns<span class="sc">$</span>start[[i]],</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>             color <span class="sc">==</span> card_color) <span class="sc">|&gt;</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(tile)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (card_amount <span class="sc">==</span> <span class="st">"single"</span>) {</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">1</span>]]</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">2</span>]]</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># End the game</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;=</span> (n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Except, if you’re like me, then the loop breaks. After digging around, I found out that the game works perfectly until the end. So let’s add some better code to account for the end.</p>
</section>
<section id="ending-the-game" class="level3" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="ending-the-game"><span class="header-section-number">2.6</span> Ending the game</h3>
<p>Candyland ends when someone reaches the end of the board. The problem with how our loop works now is that if you’re close to the end and there are no more eligible tiles left, it crashes because it doesn’t know where to go. So, what we need to do is add a conditional that says if there are no more eligible tiles, to move it to “tile 133”, which is just one space after the last tile. We also need to account for the possibility of getting a double when there’s just one eligible tile left, which causes the person to win. So let’s program that in. That updated block of code looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find the number of eligible spots</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>n_eligible_spots <span class="ot">&lt;-</span> <span class="fu">length</span>(eligible_spots)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># regular single card</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"single"</span>) {</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">1</span>]]</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># regular double card</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"double"</span>) {</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">2</span>]]</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># no more eligible spots</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">133</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we hit the end of the board, we should end the game. As is, the loop will continue drawing cards until we’ve gone through the deck twice. This may seem like innocent extra iterations of the loop, but the problem is that when we draw another candy card we get pulled back into the game.</p>
<p>So, let’s add some code at the end that says to end the game we’re on tile 133. That means we’ll extend that <code>if-else</code> statement at the bottom of the loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run out of cards</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (i <span class="sc">&gt;=</span> <span class="fu">c</span>(n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># win</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">&gt;=</span> <span class="fu">max</span>(board<span class="sc">$</span>tile)) {</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># keep going</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, the game ends when we run out of cards (programmed as going through the deck twice) or we hit the end of the board. We tell the program that the game is over by setting <code>keep_going</code> to <code>FALSE</code>. That’ll stop the <code>while</code> loop from doing any more iterations. Here’s the game so far:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>turns <span class="ot">&lt;-</span> <span class="fu">setup_turns</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(keep_playing) {</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the start tile</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Otherwise, start where the last turn ended.</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> turns<span class="sc">$</span>end[[i <span class="sc">-</span> <span class="dv">1</span>]]</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If it's a candy card, go straight there.</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (turns<span class="sc">$</span>card[[i]] <span class="sc">%in%</span> candy_cards) {</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> board[board<span class="sc">$</span>special <span class="sc">==</span> turns<span class="sc">$</span>card[[i]],]<span class="sc">$</span>tile</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If it's not, find the next colors.</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    card_color  <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">Z"</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    card_amount <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">A</span><span class="sc">\\</span><span class="st">w+"</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move to the next spot</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    eligible_spots <span class="ot">&lt;-</span> board <span class="sc">|&gt;</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(tile <span class="sc">&gt;</span> turns<span class="sc">$</span>start[[i]],</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>             color <span class="sc">==</span> card_color) <span class="sc">|&gt;</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(tile)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find the number of eligible spots</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    n_eligible_spots <span class="ot">&lt;-</span> <span class="fu">length</span>(eligible_spots)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># regular single card</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"single"</span>) {</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">1</span>]]</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># regular double card</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"double"</span>) {</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">2</span>]]</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no more eligible spots</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">133</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run out of cards</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;=</span> <span class="fu">c</span>(n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>    keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># win</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">&gt;=</span> <span class="fu">max</span>(board<span class="sc">$</span>tile)) {</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>turns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 134 × 5
   turn_num start card          shortcut   end
      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;lgl&gt;    &lt;dbl&gt;
 1        1     0 single orange NA           5
 2        2     5 double yellow NA          16
 3        3    16 single green  NA          19
 4        4    19 double green  NA          32
 5        5    32 double yellow NA          41
 6        6    41 single green  NA          45
 7        7    45 single blue   NA          49
 8        8    49 double green  NA          57
 9        9    57 single blue   NA          61
10       10    61 single green  NA          63
# ℹ 124 more rows</code></pre>
</div>
</div>
<p>Because we’ve allocated room in our <code>turns</code> dataframe for many more turns, what you’ll see if you scroll down to the bottom is a bunch of <code>NA</code>s in the <code>start</code> and <code>end</code> tiles. We’ll filter those out later. But first, we have to add one more component to the game: the shortcuts!</p>
</section>
<section id="adding-shortcuts" class="level3" data-number="2.7">
<h3 data-number="2.7" class="anchored" data-anchor-id="adding-shortcuts"><span class="header-section-number">2.7</span> Adding shortcuts</h3>
<p>The shortcuts are pretty easy to program. In fact, they’re the same as what I did for Chutes and Ladders. We add a conditional that says if the end tile is a certain number, change it to another number. Since there are only two, I’ll just hard-code it in. Here’s what that bit of code looks like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do the shortcuts.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>shortcut[[i]] <span class="ot">&lt;-</span> <span class="st">"peppermint pass"</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">==</span> <span class="dv">29</span>) {</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">41</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  turns<span class="sc">$</span>shortcut[[i]] <span class="ot">&lt;-</span> <span class="st">"gummy pass"</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to keep track of which shortcuts were encountered, I added a small bit of code that saves the name of the shortcut to the <code>shortcut</code> column. That’ll come in handy later when we do lots of games and query the simulations.</p>
<p>Now our code is complete:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>turns <span class="ot">&lt;-</span> <span class="fu">setup_turns</span>()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(keep_playing) {</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the start tile</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Otherwise, start where the last turn ended.</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> turns<span class="sc">$</span>end[[i <span class="sc">-</span> <span class="dv">1</span>]]</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If it's a candy card, go straight there.</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (turns<span class="sc">$</span>card[[i]] <span class="sc">%in%</span> candy_cards) {</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> board[board<span class="sc">$</span>special <span class="sc">==</span> turns<span class="sc">$</span>card[[i]],]<span class="sc">$</span>tile</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If it's not, find the next colors.</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    card_color  <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">Z"</span>)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    card_amount <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">A</span><span class="sc">\\</span><span class="st">w+"</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move to the next spot</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    eligible_spots <span class="ot">&lt;-</span> board <span class="sc">|&gt;</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(tile <span class="sc">&gt;</span> turns<span class="sc">$</span>start[[i]],</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>             color <span class="sc">==</span> card_color) <span class="sc">|&gt;</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(tile)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find the number of eligible spots</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    n_eligible_spots <span class="ot">&lt;-</span> <span class="fu">length</span>(eligible_spots)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># regular single card</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"single"</span>) {</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">1</span>]]</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># regular double card</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"double"</span>) {</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">2</span>]]</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no more eligible spots</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">133</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run out of cards</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;=</span> <span class="fu">c</span>(n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># win</span></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">&gt;=</span> <span class="fu">max</span>(board<span class="sc">$</span>tile)) {</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>    keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>turns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 134 × 5
   turn_num start card          shortcut   end
      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;lgl&gt;    &lt;dbl&gt;
 1        1     0 double orange NA          12
 2        2    12 double yellow NA          23
 3        3    23 single yellow NA          29
 4        4    29 single green  NA          32
 5        5    32 gummy star    NA          42
 6        6    42 single yellow NA          48
 7        7    48 single red    NA          52
 8        8    52 single yellow NA          54
 9        9    54 single purple NA          59
10       10    59 double green  NA          70
# ℹ 124 more rows</code></pre>
</div>
</div>
<p>So, we now have a loop that does a full simulation of Candyland!</p>
<p>But, if you’re like me, just one simulation isn’t enough. I want to run <em>lots</em> of simulations! And since we’ve got this nice and tidy, might as well do just a little bit more and wrap it up into a function! Let’s do that now.</p>
</section>
<section id="wrap-it-up-into-a-function" class="level3" data-number="2.8">
<h3 data-number="2.8" class="anchored" data-anchor-id="wrap-it-up-into-a-function"><span class="header-section-number">2.8</span> Wrap it up into a function</h3>
<p>Turning this into a function is actually pretty straightforward from here. All we need to do is put this entire chunk of code into a function and then make sure we’re exporting the final dataset. Here’s where I’ll filter out the <code>NA</code> turns at the end of the game. I’ve also added the argument <code>game_num = 0</code> to the function call, mostly to help with the <code>map</code> function later on, since I can’t figure out how to <code>map</code> through a list without sending an argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>simulate_game <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">game_num =</span> <span class="dv">0</span>) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put everything we've done so far here</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  turns <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(turn_num <span class="sc">&lt;=</span> i) <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>()</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">simulate_game</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, to see that in context, here is the entire function from start to finish.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>simulate_game <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">game_num =</span> <span class="dv">0</span>) {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Declare space for the full game.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  turns <span class="ot">&lt;-</span> <span class="fu">setup_turns</span>()</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop until the game is over</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(keep_playing) {</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Start at zero</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Otherwise, start where the last turn ended.</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> turns<span class="sc">$</span>end[[i <span class="sc">-</span> <span class="dv">1</span>]]</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: This is where the game actually happens.</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If it's a candy card, go straight there.</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (turns<span class="sc">$</span>card[[i]] <span class="sc">%in%</span> candy_cards) {</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> board[board<span class="sc">$</span>special <span class="sc">==</span> turns<span class="sc">$</span>card[[i]],]<span class="sc">$</span>tile</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If it's not, find the next colors.</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>      card_color  <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">Z"</span>)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>      card_amount <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">A</span><span class="sc">\\</span><span class="st">w+"</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># move to the next spot</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>      eligible_spots <span class="ot">&lt;-</span> board <span class="sc">|&gt;</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(tile <span class="sc">&gt;</span> turns<span class="sc">$</span>start[[i]],</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>               color <span class="sc">==</span> card_color) <span class="sc">|&gt;</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(tile)</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># find the number of eligible spots</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>      n_eligible_spots <span class="ot">&lt;-</span> <span class="fu">length</span>(eligible_spots)</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># regular single card</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"single"</span>) {</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>        turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">1</span>]]</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># regular double card</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"double"</span>) {</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>        turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">2</span>]]</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no more eligible spots</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>        turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">133</span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Do the shortcuts.</span></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>shortcut[[i]] <span class="ot">&lt;-</span> <span class="st">"peppermint pass"</span></span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">==</span> <span class="dv">29</span>) {</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">41</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>shortcut[[i]] <span class="ot">&lt;-</span> <span class="st">"gummy pass"</span></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 4: Check if it's game over.</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># run out of cards</span></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">&gt;=</span> <span class="fu">c</span>(n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>      keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># win</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">&gt;=</span> <span class="fu">max</span>(board<span class="sc">$</span>tile)) {</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>      keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a>  turns <span class="sc">%&gt;%</span></span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(turn_num <span class="sc">&lt;=</span> i) <span class="sc">%&gt;%</span></span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>()</span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a><span class="fu">simulate_game</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 42 × 5
   turn_num start card          shortcut   end
      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;lgl&gt;    &lt;dbl&gt;
 1        1     0 double red    NA           7
 2        2     7 double purple NA          15
 3        3    15 double green  NA          26
 4        4    26 single purple NA          28
 5        5    28 double yellow NA          35
 6        6    35 double blue   NA          43
 7        7    43 double yellow NA          54
 8        8    54 single red    NA          58
 9        9    58 single red    NA          64
10       10    64 single blue   NA          67
# ℹ 32 more rows</code></pre>
</div>
</div>
</section>
<section id="simulate-lots-of-games" class="level3" data-number="2.9">
<h3 data-number="2.9" class="anchored" data-anchor-id="simulate-lots-of-games"><span class="header-section-number">2.9</span> Simulate lots of games!</h3>
<p>We can now call <code>simulate_game()</code> as many times as we want, and it’ll do a new simulation each time. Let’s set up a dataframe so that we can save the output of each game. Here, I’ll create a dataframe that has one column called <code>game_num</code> that is just the numbers 1 to 10,000. I’ll then use <code>purrr::map</code> to run the simulation once for each row. This takes about 1.8 minutes on my computer, so be patient if it’s a little slow for you. (Or just decrease the number of games.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>games <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">game_num =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">game =</span> <span class="fu">map</span>(game_num, simulate_game)) <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(game))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For what it’s worth, when I have code blocks that I know will take a long time to run, I wrap them up in some code to track the time, so I can remember that next time I run. I also add <code>beepr::beep()</code> to the bottom so that my computer makes a satisfying sound once the block is completed. I’ll also set the seed to today’s date to make all this replicable. You can do this if you want, but you obviously don’t need to.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Takes 1.7ish minutes for 10K simulations.</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">250312</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>games <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">game_num =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">game =</span> <span class="fu">map</span>(game_num, simulate_game)) <span class="sc">|&gt;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(game))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>beepr<span class="sc">::</span><span class="fu">beep</span>()</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.time</span>() <span class="sc">-</span> start_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.639684 mins</code></pre>
</div>
</div>
<p>Hooray! We now have a function that simulates an entire game of Candyland, and with just a few additional lines of code and a little bit of patience, we were able to run that simulation thousands of times. Let’s take a look at the output, just to see what we’re working with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>games</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 224,150 × 6
   game_num turn_num start card          shortcut   end
      &lt;int&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;    &lt;dbl&gt;
 1        1        1     0 single purple &lt;NA&gt;         2
 2        1        2     2 double orange &lt;NA&gt;        12
 3        1        3    12 single blue   &lt;NA&gt;        17
 4        1        4    17 single yellow &lt;NA&gt;        23
 5        1        5    23 single green  &lt;NA&gt;        26
 6        1        6    26 double red    &lt;NA&gt;        33
 7        1        7    33 single red    &lt;NA&gt;        39
 8        1        8    39 single yellow &lt;NA&gt;        41
 9        1        9    41 double green  &lt;NA&gt;        51
10        1       10    51 double orange &lt;NA&gt;        62
# ℹ 224,140 more rows</code></pre>
</div>
</div>
<p>We’ve got the same five columns that we’ve been used to working with, with the addition of one more, showing the game number. In total, there were 218,035 turns taken across these 10,000 games. So, you might be able to see where this is going: we can now query this giant spreadsheet to see patterns across the games.</p>
</section>
</section>
<section id="sec-results" class="level2 page-columns page-full" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="sec-results"><span class="header-section-number">3</span> Results</h2>
<p>So, now that we have the simulation done, let’s take a look at the results! First, I’ll take the giant <code>games</code> object and summarize it. I don’t necessarily need to keep information about every single turn, but I can start to count some things that we can think about analyzing later. For now, Ill count the number of turns, candies, singles, doubles, and shortcuts, and I’ll do so by game.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>games_summary <span class="ot">&lt;-</span> games <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">turns =</span> <span class="fu">max</span>(turn_num),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_candies =</span> <span class="fu">sum</span>(card <span class="sc">%in%</span> candy_cards),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_singles =</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(card, <span class="st">"single"</span>)),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_doubles =</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(card, <span class="st">"double"</span>)),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_shortcuts =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(shortcut)),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> game_num) <span class="sc">|&gt;</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 6
   game_num turns n_candies n_singles n_doubles n_shortcuts
      &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;       &lt;int&gt;
 1        1    20         0        10        10           0
 2        2    16         4         8         4           0
 3        3    25         2        16         7           1
 4        4     7         1         5         1           0
 5        5    23         0        16         7           1
 6        6    29         4        18         7           0
 7        7    13         1         8         4           0
 8        8    18         1        11         6           0
 9        9    27         2        15        10           0
10       10    17         3         9         5           0
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>We now have a spreadsheet that has one row per game, and how many times those things happened. We’ll do some additional queries of the <code>games</code> dataset later, but for now let’s work with that.</p>
<section id="sec-num_turns" class="level3 page-columns page-full" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="sec-num_turns"><span class="header-section-number">3.1</span> Number of turns</h3>
<p>First, let’s look at the number of turns. This plot shows how many turns it took to complete each game.</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(games_summary, <span class="fu">aes</span>(turns)) <span class="sc">+</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">5</span>)) <span class="sc">+</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of turns required to finish a solo game of Candyland"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>) <span class="sc">+</span> </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>This is an interesting distribution. I’ll bet a statistician could identify what kind of <a href="https://en.wikipedia.org/wiki/Probability_distribution">probability distribution</a> it looks like but it’s not one that I recognize. Broadly, we see that the typical number of turns is about 12–22. There’s an interesting double peak at the top there, one at around 13–14 turns and another centered around 20. I’m not sure what’s going on there, but it seems to show up every time I run these simulations, so there must be something real that is causing that distribution. (Edit: I found out what’s happening! See <a href="#sec-removing_candies" class="quarto-xref">Section&nbsp;4.2</a>!)</p>
<p>The number of a games that had more than about 22 turns goes down the more turns there were. It follows a nice (reverse?) exponential function. Keep in mind that there are 67 cards in the deck, which appears to be about the limit. There were a small number of games (just 28 out of 10,000) that took more than 67 turns. So, if you’re playing a solo game and have to reshuffle the deck, that’s a pretty rare thing!</p>
<p>The most number of turns I saw in this simulation was a whopping 114. It was an unfortunate sequence of going for a long time without getting any candy cards (or getting ones that were close to where they already were), nearly making it to the end, and then getting yanked back to close to the beginning. It happened over and over. There was one exciting set of turns (about 60 turns in) where they got four candies in just 10 turns. They were right near the end, got the beloved Chocolate Truffle and moved ahead six tiles, then immediately got pulled back to the Lollipop, made it a few turns and then when the deck reshuffled they got pulled back by the Gummy Star, and three turns later pulled back again to the Cupcake.</p>
<p>The fewest number of turns was three, which happened 38 times in my 10,000 games. My five-year-old had this happen to him just the other day—I didn’t realize there was a 0.38% chance of that happening!<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> In all cases, these three-turn games got the Chocolate Truffle on their first turn, and at least one double-color card after that.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;Again, a statistician could probably figure out the precise probability, but I figure these numbers based on the simulation are close.</p></div></div></section>
<section id="single-color-cards" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="single-color-cards"><span class="header-section-number">3.2</span> Single-color cards</h3>
<p>Let’s take a look at the single-color cards. What is the distribution of those cards across these simulations?</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>games_summary <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_singles) <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n_singles, prop)) <span class="sc">+</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">10</span>),) <span class="sc">+</span> </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.02</span>),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span> </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of single-color cards drawn in a game of Candyland"</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"number of single-color cards drawn"</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"percent of games"</span>) <span class="sc">+</span> </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>Because they’re the most common kind of card, it should come as no surprise that the distribution of the number of single-color cards you draw parallels the total number of cards drawn in the came. We a hint of that mysterious double peak like we saw in the previous plot, but the first peak is more prominent instead of the second. Overall though, the general shape is the same as the number of turns in the game, only this time it peaks at around 9 rather than 20.</p>
<p>47 games saw zero single-color cards. Most of these involved drawing the Chocolate Truffle or Popsicle on the first turn and then getting two or three double-color cards until the end. A few got some double-candy cards, and then draw one of those candies and then continued to get doubles. Three games got some other candy card (or two) and otherwise “legitimately” made it across the board with just the double-color cards.</p>
</section>
<section id="double-color-cards" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="double-color-cards"><span class="header-section-number">3.3</span> Double-color cards</h3>
<p>Now, let’s focus on the double-candy cards.</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>games_summary <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_doubles) <span class="sc">|&gt;</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n_doubles, prop)) <span class="sc">+</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#6e6cff"</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">5</span>)) <span class="sc">+</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.02</span>),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span> </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of double-color cards drawn in a game of Candyland"</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"number of double-color cards drawn"</span>,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"percent of games"</span>) <span class="sc">+</span> </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>This distribution is starting to look familiar now. The most likely outcome is that you’ll see roughly 5–10 double-color cards per game. A few games saw far more, more than 20 or even 25, but the odds of that are quite low. Like the single-color cards, there were a few games that saw no double-color cards. Most of those got a candy pretty early on and then finished the game without seeing any singles.</p>
</section>
<section id="shortcuts" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="shortcuts"><span class="header-section-number">3.4</span> Shortcuts</h3>
<p>There are two shortcuts in the game: the peppermint pass, which is available right at the start of the game and takes you ahead about a third of the way, and the gummy pass, which is a short pass again towards the beginning of the game. How many shortcuts are typically seen in a game?</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>games_summary <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_shortcuts) <span class="sc">|&gt;</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n_shortcuts, prop)) <span class="sc">+</span> </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of shortcuts in a solo game of Candyland"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"shortcuts"</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"percentage of games"</span>) <span class="sc">+</span> </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>This figure shows that most of the time, about 73.4%, you’re not going to see a shortcut. About 25.2% of games saw one shortcut.</p>
<p>Interestingly, you can’t take both shortcuts without a candy card taking you back close to the beginning because the Peppermint Pass starts before and ends after the Gummy Pass. So, you need to get the Cupcake or Ice Cream Cone to bring you back. And even then, you’d only be able to take the Gummy Pass because once you’ve passed the beginning of the Peppermint Pass, there’s no chance of it again. Nevertheless, 1.35% of games took two shortcuts. In about 60.4% of those cases, the first shortcut was the Gummy Pass.</p>
<p>In two cases (just 0.02% of the time!), there were three shortcuts taken in a single game! In one case, they took the Gummy Pass three times. They got it their first time passing through, again after getting the Cupcake, and again after getting the Ice Cream Cone. In the other case, they took the Peppermint Pass the first time, and then again hit the Gummy Pass after getting the Cupcake and again after getting the Ice Cream Cone.</p>
<p>Three is the maximum unless you go through the deck a second time. But given how rare that happens, the odds of getting three shortcuts, going through the entire deck, and then getting either the Cupcake or Ice Cream Cone and getting the Gummy Pass yet again, is so slim. But not impossible!</p>
<p>Finally, what are the relative odds of the two shortcuts in relation to each other? Surprisingly, the Peppermint Pass is not as rare as I thought. Of all the shortcuts taken, it made up 41% of them. So, the Gummy Pass is about 1.4 times as likely. (I thought that number would be a lot higher!)</p>
</section>
<section id="candy-cards" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="candy-cards"><span class="header-section-number">3.5</span> Candy Cards</h3>
<p>Now let’s look at the number of candy cards that a person might encounter in a typical game of Candyland. Right now, we’re not so much concerned about which card but rather just the total number they see. This plot shows the distribution across the simulated games. I’ve added percentages at the top because we had some <em>very</em> small bars towards the right of the plot.</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>games_summary <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_candies) <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n_candies, prop)) <span class="sc">+</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span> </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(prop)),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_y =</span> <span class="fl">0.01</span>) <span class="sc">+</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">2</span>),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">minor_breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="fl">0.1</span>)) <span class="sc">+</span> </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="fl">0.01</span>),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of candy cards drawn in a game of Candyland"</span>,</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of candies"</span>) <span class="sc">+</span> </span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>So, it looks like in about 91–92% of games, you’ll draw at least one candy card. The most typical outcome was just one card, but drawing up to four was not too uncommon. The most I saw in my simulations was drawing 13 cards, but that happened exactly one time. Keep in mind that there are only seven candy cards in the deck, so drawing that many would involve getting through the entire deck without finishing, and then drawing six of the seven cards <em>again</em> before finishing. In fact just 0.1% of games draw eight or more, meaning they went through the entire deck.</p>
<p>But that’s if we’re considering all the candy cards collectively. Let’s take a look at the candy cards individually to see if they have their own patterns.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This next bit of discussion gets into probability distributions and statistics a little bit.</p>
</div>
</div>
<p>This plot shows the percentage of times each candy card was drawn.</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>candycard_distributions <span class="ot">&lt;-</span> games <span class="sc">|&gt;</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(card <span class="sc">%in%</span> candy_cards) <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(card) <span class="sc">|&gt;</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">card =</span> <span class="fu">factor</span>(candy_cards, </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"cupcake"</span>, <span class="st">"ice cream cone"</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"gummy star"</span>, <span class="st">"gingerbread man"</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"lollipop"</span>, <span class="st">"popsicle"</span>,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"chocolate truffle"</span>)))</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(candycard_distributions, <span class="fu">aes</span>(card, prop)) <span class="sc">+</span> </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span> </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1675</span>),</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span> </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of candy cards across 10,000 simulated games"</span>,</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"candy card"</span>,</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"perentage"</span>) <span class="sc">+</span> </span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>You would expect the candies to be pretty evenly distributed, and they are pretty close. However, there is more variation between the cards than I expected. I’ve overlayed a gray dashed line at 14.28% (one-seventh), showing what the expected height of each bar would be if they were all drawn evenly. Some of these are a bit higher and lower than I expected. The Cupcake, for example, was drawn 16.34% of the time—just about a full 1% more than expected—and the ice cream code and Lollipop were drawn 13.01% of the time, more than 1% lower than expected.</p>
<p>You might be thinking, “Who cares? 1% is basically nothing. It’s just random chance.” I’m not so sure. Here’s what the distribution would be if it were truly random, plotted on the same scale as the above plot. I’ve randomly chosen a number between one and seven 10,000 times and plot them:</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">250313</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">num =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(num) <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff =</span> prop <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(prop) <span class="sc">|&gt;</span> </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">as.factor</span>(num), prop)) <span class="sc">+</span> </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span> </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1675</span>),</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.04</span>),</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span> </span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of </span><span class="sc">\"</span><span class="st">Pick a number between one and seven</span><span class="sc">\"</span><span class="st"> 10,000 times"</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"number"</span>, </span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"percentage"</span>) <span class="sc">+</span> </span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>These numbers are all much closer to the predicted value of 14.28%. None are further than 0.6% away. You might be thinking, “Okay, so you got lucky one time. The deviance observed in the candy cards is well within the range of possible values.” But still, I don’t think it is! I did the above experiment—pick a number between one and seven 10,000 times and then get the proportions of each number—itself 10,000 times. So I have 100 million data points. Below, I’ve plotted the distribution of those proportions from the 10,0000 experiments (where each experiment had 10,000 random draws).</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">250313</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>tenthousand_draws <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">iteration =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">num =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)))) <span class="sc">|&gt;</span> </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(iteration, num) <span class="sc">|&gt;</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">.by =</span> iteration)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tenthousand_draws, <span class="fu">aes</span>(prop)) <span class="sc">+</span> </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.001</span>, <span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span> </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span> </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>num) <span class="sc">+</span> </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"What happens if you pick a number between one and seven 10,000 times, tally up how many</span><span class="sc">\n</span><span class="st">of each number you get, and repeat that 10,000 times? This plot shows the distribution of</span><span class="sc">\n</span><span class="st">those 10,000 tallies."</span>,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"They basically all look like the same bell curve."</span>) <span class="sc">+</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) <span class="sc">+</span> </span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>tenthousand_draws <span class="sc">|&gt;</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(prop),</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(prop),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> num) <span class="sc">|&gt;</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_mean =</span> <span class="fu">mean</span>(mean),</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_sd   =</span> <span class="fu">mean</span>(sd)) <span class="sc">|&gt;</span> </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_diff =</span> mean <span class="sc">-</span> <span class="fu">mean</span>(mean),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd_diff   =</span> sd <span class="sc">-</span> <span class="fu">mean</span>(sd)) <span class="sc">|&gt;</span> </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 7
    num  mean      sd mean_mean mean_sd   mean_diff    sd_diff
  &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;
1     4 0.143 0.00345     0.143 0.00349 -0.0000305  -0.0000343
2     7 0.143 0.00346     0.143 0.00349 -0.0000281  -0.0000244
3     6 0.143 0.00353     0.143 0.00349 -0.00000965  0.0000461
4     3 0.143 0.00345     0.143 0.00349 -0.00000472 -0.0000344
5     5 0.143 0.00350     0.143 0.00349  0.00000650  0.0000146
6     2 0.143 0.00354     0.143 0.00349  0.0000250   0.0000485
7     1 0.143 0.00347     0.143 0.00349  0.0000415  -0.0000160</code></pre>
</div>
</div>
<p>Unsurprisingly, those seven distributions are basically identical. Their means are 0.14285 ± 0.000041 and their standard deviations are 0.003489 ± .0000343. I’ll therefore collapse the seven numbers together and treat them as a single distribution. That’s visualized below with the means of each of the candy cards.</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>tenthousand_draws <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_rounded =</span> <span class="fu">round</span>(prop, <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(prop_rounded) <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(prop_rounded, prop)) <span class="sc">+</span> </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> candycard_distributions,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> prop), <span class="at">color =</span> <span class="st">"#ff7575"</span>) <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> candycard_distributions,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> prop, <span class="at">label =</span> card),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">250318</span>,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">direction =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of seven candy cards compared to their expected distributions"</span>,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>,</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"expected proportion of draws"</span>,</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"probability of expected draws"</span>) <span class="sc">+</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>One candy card (the Gummy Star) is well within the expected range. The Popsicle is on the edge of the distribution, but still a plausible value. But the Cupcake was so far away from the expected value. The <em>z</em>-score was 5.688 and the <em>p</em>-value is about 0.0000001. So the odds of getting these cards as infrequently as we did, assuming they’re evenly probable, is quite small. I have no explanation for why that is, but I think it’s an intriguing finding here. It’s also intriguing that the Ice Cream Cone and the Lollipop are consistently drawn at around the same rate, and far lower than expected.</p>
<p>Finally, when I did this whole thing again based on a different random seed, I got strikingly similar results. There’s something here and I’m not sure what it is!</p>
</section>
<section id="sec-gains_and_losses" class="level3 page-columns page-full" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="sec-gains_and_losses"><span class="header-section-number">3.6</span> Gains and Losses</h3>
<p>One of the biggest questions I have as to do with the candy cards still. It’s often the case that when you get a candy card, it’s an exciting thing because you jump ahead a lot. But, it also seems like a lot of the time it’s a bad thing because you fall back quite a bit.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> So, is it overall better to get a candy card, or is it on average worse for your game?</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;Fortunately, my five-year-old doesn’t care either way and is just excited to get a candy card!</p></div></div><div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>diffs <span class="ot">&lt;-</span> games <span class="sc">|&gt;</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(card <span class="sc">%in%</span> candy_cards) <span class="sc">|&gt;</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> end <span class="sc">-</span> start)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diffs, <span class="fu">aes</span>(diff)) <span class="sc">+</span> </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span> </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">20</span>),</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">5</span>)) <span class="sc">+</span> </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"How far ahead or behind does a candy card take you?"</span>,</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games of Candyland"</span>,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"tiles advanced"</span>) <span class="sc">+</span> </span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>Okay, so there’s a lot to unpack here. First off, we see that it’s centered right around zero with similar-looking distributions on either sides. The biggest jumps ahead were when a Chocolate Truffle was drawn right at the beginning of the game. The biggest fallbacks were when the Cupcake was drawn just before the end of the game. The dreaded scenario of drawing a Cupcake while sitting on the last tile happened 24 times!</p>
<p>The next thing I see in this plot is a few random spikes on the right side of the plot. Those are cases where you draw a candy right right at the start of the game.</p>
<p>Overall, the average number of tiles advanced across all these candy car draws was 1.26, with a median of 5. If we ignore the first turn of each game (since that seems to have caused those spikes), the average drops to -1.62 and the median is just 2 tiles. So, candy cards are sometimes good and sometimes bad, but overall it really is just a wash.</p>
</section>
<section id="most-likely-tiles" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="most-likely-tiles"><span class="header-section-number">3.7</span> Most likely tiles</h3>
<p>Finally, the last thing I’ll explore with these simulated games is the tiles on the board. Which ones are landed on the most? This figure below shows how many times each tile was landed on across the 10,000 games.</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>games <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(end <span class="sc">!=</span> <span class="dv">133</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(end)) <span class="sc">+</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">10</span>),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">5</span>)) <span class="sc">+</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most likely landed-on tiles in a game of Candyland"</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"tile number"</span>,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"times landed on"</span>) <span class="sc">+</span> </span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>The patterns here make a lot of sense. First, there are 11 tiles that are about twice as high. Seven of those are candy tiles and two of them are the ends of the shortcuts. It makes sense why the ends of the shortcuts are twice as high because you’ve got twice the odds of landing on them: once from taking the shortcut and once by approaching the end point the long way. The candy tiles are twice as high because they’re about as likely as taking the shortcuts.</p>
<p>You’ll also notice two tiles that were never landed on. Those are the beginning of the shortcuts. So, technically you do land on them, but you don’t <em>end your turn</em> on them.</p>
<p>The other two tiles that are landed on the most are two yellow tiles right at the end of the game. Why would those be landed on more than other tiles? As it turns out, I think it’s an error in how the game is laid out. Normally, when a candy tile is placed, it interrupts the sequence of colors across the board. However, in the case of the Chocolate Truffle, it actually takes the place of a yellow tile. Normally, if you’re within six tiles of a yellow tile (or any color), and draw a single color, you’ll land on that. But because that yellow was skipped, now if you’re within 12 tiles of that penultimate yellow, you’ll land there. And if you’re further back and get a double yellow, you’ll land there. So, the odds are just twice as greater because a yellow tile was skipped. That very last spike towards the end is the subsequent yellow, which you’d get if you drew a double yellow within five tiles of the Chocolate Truffle (on either side).</p>
<div class="callout callout-style-default callout-tip callout-titled" title="See the board again if you'd like">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
See the board again if you’d like
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><img src="board.jpg" class="img-fluid"></p>
</div>
</div>
</div>
<p>The other kind of intriguing pattern is that the number of times a tile is landed on decreases the further away one gets from a candy and shortcut tile. Since those tiles are the most likely, it makes sense then that the tiles immediately following them are more common. The further away you get from them though, the odds go up that you’ll see another candy card or something, pulling you away from that part of the board. The gap between tile 20 (Ice Cream Cone) and 41 (the end of the Gummy Pass followed by the Gummy Star) and the gap between tile 69 (Gingerbread Man) and 92 (Lollipop) show this especially well.</p>
</section>
<section id="summary" class="level3" data-number="3.8">
<h3 data-number="3.8" class="anchored" data-anchor-id="summary"><span class="header-section-number">3.8</span> Summary</h3>
<p>So, so far we’ve seen a lot of patterns in Candyland based on 10,000 simulated solo games. Most of the results are not too surprising, but it’s nice to put some numbers to things, like the number turns it takes, how many candy cards you’re likely to draw, whether candy cards are ultimately good or bad for your game, and how much more common one shortcut is compared to the other.</p>
</section>
</section>
<section id="changes" class="level2 page-columns page-full" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="changes"><span class="header-section-number">4</span> Changes</h2>
<p>Since we’ve got this all simulated, I can actually pretty easily change a few things about the game to see what kind of effect it might have on the results. I did this last time with my simulation of <a href="../../blog/simulating_chutes_and_ladders">Chutes and Ladders</a> and found that if you remove the longest chute, sure enough the average game length was shorter. What kinds of changes can we make to Candyland?</p>
<section id="triple-cards" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="triple-cards"><span class="header-section-number">4.1</span> Triple cards</h3>
<p>I think it would be fun to add one triple-color card for each color in the deck. It’d be a rare but really cool thing to encounter. Let’s add those six cards to the deck and see what happens to the stats.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Click here to see the details and code">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click here to see the details and code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>First, I’ll need to modify my <code>create_one_color_card</code> function to create a triple.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>create_one_color_card <span class="ot">&lt;-</span> <span class="cf">function</span>(.color) {</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"double "</span>, .color), <span class="dv">4</span>), </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"single "</span>, .color), <span class="dv">6</span>),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"triple "</span>,  .color), <span class="dv">1</span>))</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>cards_with_triples <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">create_one_color_card</span>(<span class="st">"red"</span>),</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"purple"</span>),</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"yellow"</span>),</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"blue"</span>),</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"orange"</span>),</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"green"</span>),</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>           candy_cards)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will increase the overall size of the deck, which might have some consequences by itself, but I don’t think it’ll matter too much.</p>
<p>I now have to modify the code I use for the simulation to account for triple cards</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>simulate_game_with_triples <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">game_num =</span> <span class="dv">0</span>) {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Declare space for the full game.</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  n_cards <span class="ot">&lt;-</span> <span class="fu">length</span>(cards_with_triples)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  turns <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">turn_num =</span> <span class="dv">1</span><span class="sc">:</span>(n_cards<span class="sc">*</span><span class="dv">2</span>),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">start    =</span> <span class="cn">NA</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">card  =</span> <span class="fu">c</span>(<span class="fu">sample</span>(cards_with_triples, <span class="at">replace =</span> <span class="cn">FALSE</span>), </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sample</span>(cards_with_triples, <span class="at">replace =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">shortcut =</span> <span class="cn">NA</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">end      =</span> <span class="cn">NA</span>)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop until the game is over</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(keep_playing) {</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Start at zero</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Otherwise, start where the last turn ended.</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> turns<span class="sc">$</span>end[[i <span class="sc">-</span> <span class="dv">1</span>]]</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: This is where the game actually happens.</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If it's a candy card, go straight there.</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (turns<span class="sc">$</span>card[[i]] <span class="sc">%in%</span> candy_cards) {</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> board[board<span class="sc">$</span>special <span class="sc">==</span> turns<span class="sc">$</span>card[[i]],]<span class="sc">$</span>tile</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If it's not, find the next colors.</span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>      card_color  <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">Z"</span>)</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>      card_amount <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">A</span><span class="sc">\\</span><span class="st">w+"</span>)</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># move to the next spot</span></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>      eligible_spots <span class="ot">&lt;-</span> board <span class="sc">|&gt;</span></span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(tile <span class="sc">&gt;</span> turns<span class="sc">$</span>start[[i]],</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>               color <span class="sc">==</span> card_color) <span class="sc">|&gt;</span></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(tile)</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>      <span class="co"># find the number of eligible spots</span></span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>      n_eligible_spots <span class="ot">&lt;-</span> <span class="fu">length</span>(eligible_spots)</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># regular single card</span></span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"single"</span>) {</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>        turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">1</span>]]</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>      <span class="co"># regular double card</span></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"double"</span>) {</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>        turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">2</span>]]</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>      <span class="co"># triple cards</span></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"triple"</span>) {</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>        turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">3</span>]]</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no more eligible spots</span></span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>        turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">133</span></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Do the shortcuts.</span></span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>shortcut[[i]] <span class="ot">&lt;-</span> <span class="st">"peppermint pass"</span></span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">==</span> <span class="dv">29</span>) {</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">41</span></span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>shortcut[[i]] <span class="ot">&lt;-</span> <span class="st">"gummy pass"</span></span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 4: Check if it's game over.</span></span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># run out of cards</span></span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">&gt;=</span> <span class="fu">c</span>(n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>      keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># win</span></span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">&gt;=</span> <span class="fu">max</span>(board<span class="sc">$</span>tile)) {</span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>      keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a>  turns <span class="sc">%&gt;%</span></span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(turn_num <span class="sc">&lt;=</span> i) <span class="sc">%&gt;%</span></span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>()</span>
<span id="cb56-83"><a href="#cb56-83" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s actually run the 10,000 simulated games.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">250320</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>games_triple <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">game_num =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">game =</span> <span class="fu">map</span>(game_num, simulate_game_with_triples)) <span class="sc">|&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(game))</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>games_triple_summary <span class="ot">&lt;-</span> games_triple <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">turns =</span> <span class="fu">max</span>(turn_num),</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_candies =</span> <span class="fu">sum</span>(card <span class="sc">%in%</span> candy_cards),</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_singles =</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(card, <span class="st">"single"</span>)),</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_doubles =</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(card, <span class="st">"double"</span>)),</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_triples =</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(card, <span class="st">"triple"</span>)),</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_shortcuts =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(shortcut)),</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> game_num) <span class="sc">|&gt;</span> </span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 7
   game_num turns n_candies n_singles n_doubles n_triples n_shortcuts
      &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;       &lt;int&gt;
 1        1    30         1        17         9         3           1
 2        2    16         3         6         4         3           0
 3        3     7         1         2         4         0           0
 4        4    24         1        12        10         1           0
 5        5    16         1         6         7         2           0
 6        6    18         0         8         8         2           0
 7        7    25         1        13        11         0           0
 8        8    13         2         7         3         1           0
 9        9    22         1        10         9         2           0
10       10    18         2        10         4         2           0
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>Now we can take a look at the results!</p>
</div>
</div>
</div>
<p>First, we’ll see how many triple cards were drawn in a typical game.</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>games_triple_summary <span class="sc">|&gt;</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(n_triples) <span class="sc">|&gt;</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n_triples, prop)) <span class="sc">+</span> </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#6e6cff"</span>) <span class="sc">+</span> </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of triple-color cards drawn in a game of Candyland"</span>,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games with triple-color cards added"</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"number of triple cards drawn"</span>,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"percent of games"</span>) <span class="sc">+</span> </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>There are only six triples in the deck, so it’s unsurprising that there are relatively few drawn in a game. But most games encountered at least one, just like the candy cards. Let’s see what overall effect this hand on the number of turns in the game.</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="st">`</span><span class="at">normal</span><span class="st">`</span> <span class="ot">=</span> games_summary, <span class="st">`</span><span class="at">with triples added</span><span class="st">`</span> <span class="ot">=</span> games_triple_summary, <span class="at">.id =</span> <span class="st">"game_type"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(turns, <span class="at">color =</span> game_type, <span class="at">fill =</span> game_type)) <span class="sc">+</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.45</span>) <span class="sc">+</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span> </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_ptol</span>() <span class="sc">+</span> </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_fill_ptol</span>() <span class="sc">+</span> </span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of turns to finish a solo game of Candyland"</span>,</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"percent of games"</span>,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span> </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) <span class="sc">+</span> </span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>So, unsurprisingly, the overall number of turns it takes to complete a game of Candyland goes down if you add some triple-color cards. Interestingly, the most likely outcome is still to finish in about 12–20 turns. But, you’re a little more likely to finish in that range, you’re more likely to finish in fewer turns than that, and less likely to finish in more terns.</p>
<p>So, if the creators wanted to change the game a little bit, they could tweak the deck and run some simulations. If they feel the game is too long, add some more doubles or triples. If it’s too short, add more singles.</p>
</section>
<section id="sec-removing_candies" class="level3 page-columns page-full" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="sec-removing_candies"><span class="header-section-number">4.2</span> Removing Candies</h3>
<p>We’ve established in <a href="#sec-gains_and_losses" class="quarto-xref">Section&nbsp;3.6</a> that the candy cards ultimately don’t benefit the player if the only objective is to finish the game. They are, of course, the most fun part of the game. (My family’s Chocolate Truffle card is starting to fall apart because my kids like to hold it so much!) But, what would happen if we took those cards out entirely? How would that affect the length of the game?</p>
<div class="callout callout-style-default callout-note callout-titled" title="Click here to see the details and code">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click here to see the details and code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>First, I’ll need to modify my deck of cards to not have those candy cards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>create_one_color_card <span class="ot">&lt;-</span> <span class="cf">function</span>(.color) {</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"double "</span>, .color), <span class="dv">4</span>), </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"single "</span>, .color), <span class="dv">6</span>))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>cards_without_candies <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">create_one_color_card</span>(<span class="st">"red"</span>),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"purple"</span>),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"yellow"</span>),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"blue"</span>),</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"orange"</span>),</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">create_one_color_card</span>(<span class="st">"green"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will decrease the overall size of the deck, so I’ll allocate room for going through the deck a third time. I’ll now modify the simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>simulate_game_without_candies <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">game_num =</span> <span class="dv">0</span>) {</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Declare space for the full game.</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  n_cards <span class="ot">&lt;-</span> <span class="fu">length</span>(cards_without_candies)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  turns <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">turn_num =</span> <span class="dv">1</span><span class="sc">:</span>(n_cards<span class="sc">*</span><span class="dv">3</span>),</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">start    =</span> <span class="cn">NA</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">card  =</span> <span class="fu">c</span>(<span class="fu">sample</span>(cards_without_candies, <span class="at">replace =</span> <span class="cn">FALSE</span>), </span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sample</span>(cards_without_candies, <span class="at">replace =</span> <span class="cn">FALSE</span>), </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sample</span>(cards_without_candies, <span class="at">replace =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">shortcut =</span> <span class="cn">NA</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">end      =</span> <span class="cn">NA</span>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop until the game is over</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  keep_playing <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(keep_playing) {</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Start at zero</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Otherwise, start where the last turn ended.</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>start[[i]] <span class="ot">&lt;-</span> turns<span class="sc">$</span>end[[i <span class="sc">-</span> <span class="dv">1</span>]]</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: This is where the game actually happens.</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    card_color  <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">Z"</span>)</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>    card_amount <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(turns<span class="sc">$</span>card[[i]], <span class="st">"</span><span class="sc">\\</span><span class="st">A</span><span class="sc">\\</span><span class="st">w+"</span>)</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move to the next spot</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>    eligible_spots <span class="ot">&lt;-</span> board <span class="sc">|&gt;</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(tile <span class="sc">&gt;</span> turns<span class="sc">$</span>start[[i]],</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>             color <span class="sc">==</span> card_color) <span class="sc">|&gt;</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(tile)</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find the number of eligible spots</span></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>    n_eligible_spots <span class="ot">&lt;-</span> <span class="fu">length</span>(eligible_spots)</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># regular single card</span></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"single"</span>) {</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">1</span>]]</span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># regular double card</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (n_eligible_spots <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> card_amount <span class="sc">==</span> <span class="st">"double"</span>) {</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> eligible_spots[[<span class="dv">2</span>]]</span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no more eligible spots</span></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">133</span></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Do the shortcuts.</span></span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>shortcut[[i]] <span class="ot">&lt;-</span> <span class="st">"peppermint pass"</span></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">==</span> <span class="dv">29</span>) {</span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>end[[i]] <span class="ot">&lt;-</span> <span class="dv">41</span></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>      turns<span class="sc">$</span>shortcut[[i]] <span class="ot">&lt;-</span> <span class="st">"gummy pass"</span></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 4: Check if it's game over.</span></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># run out of cards</span></span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">&gt;=</span> <span class="fu">c</span>(n_cards<span class="sc">*</span><span class="dv">2</span>)) {</span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>      keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># win</span></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (turns<span class="sc">$</span>end[[i]] <span class="sc">&gt;=</span> <span class="fu">max</span>(board<span class="sc">$</span>tile)) {</span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a>      keep_playing <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a>  turns <span class="sc">%&gt;%</span></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(turn_num <span class="sc">&lt;=</span> i) <span class="sc">%&gt;%</span></span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>()</span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s actually run the 10,000 simulated games.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">250320</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>games_without_candies <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">game_num =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">game =</span> <span class="fu">map</span>(game_num, simulate_game_without_candies)) <span class="sc">|&gt;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(game))</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>games_without_candies_summary <span class="ot">&lt;-</span> games_without_candies <span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">turns =</span> <span class="fu">max</span>(turn_num),</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_singles =</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(card, <span class="st">"single"</span>)),</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_doubles =</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(card, <span class="st">"double"</span>)),</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_shortcuts =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(shortcut)),</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> game_num) <span class="sc">|&gt;</span> </span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 5
   game_num turns n_singles n_doubles n_shortcuts
      &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;       &lt;int&gt;
 1        1    23        13        10           0
 2        2    24        18         6           1
 3        3    24        15         9           0
 4        4    26        17         9           0
 5        5    25        17         8           0
 6        6    13         8         5           1
 7        7    28        18        10           0
 8        8    22        15         7           1
 9        9    18         7        11           0
10       10    10         4         6           1
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>Now let’s take a look at the results.</p>
</div>
</div>
</div>
<p>In this plot, I’ve shown the distribution of the number of turns it takes to finish a game of Candyland. In blue is a normal game, while in red is the game if we took all the candy cards out.</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="st">`</span><span class="at">normal</span><span class="st">`</span> <span class="ot">=</span> games_summary, <span class="st">`</span><span class="at">without candies</span><span class="st">`</span> <span class="ot">=</span> games_without_candies_summary, <span class="at">.id =</span> <span class="st">"game_type"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(turns, <span class="at">color =</span> game_type, <span class="at">fill =</span> game_type)) <span class="sc">+</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.45</span>, <span class="at">adjust =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span> </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_ptol</span>() <span class="sc">+</span> </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_fill_ptol</span>() <span class="sc">+</span> </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of turns to finish a solo game of Candyland"</span>,</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>,</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"percent of games"</span>,</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span> </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) <span class="sc">+</span> </span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>These results surprised me! I thought that because candy cards, on average, don’t help the player advance that much, that the number of turns required to finish a game would be basically the same. I was prepared to make the conclusion that while they don’t help advance the game, they certainly make it more fun. I was wrong! Well, kinda. They’re still fun regardless, but taking out the candy cards has several effects.</p>
<p>First, the minimum number of turns it takes to finish the game goes up. The shortest game took just eight turns. In all four that this happened, the simulation got six double-color cards <em>and</em> the peppermint pass. This makes sense because you have to work your way across the entire board “the long way.”</p>
<p>Second, the longest game is considerably shorter. This also makes sense because every turn brings you closer to the end and there’s nothing pulling you back. You might think the longest game in theory would be 133 turns because that’s how many tiles there are, but you’d have to start drawing double cards at some point, so it’d have to be shorter. In these 10,000 simulations, the longest game took 32 turns. There’s nothing special about it other than they just got crummy luck. Many of their single cards advanced them just two or three tiles, and several of their doubles advanced them just seven or eight tiles.</p>
<p>The combined effects of lengthening the shortest game and shortening the longest game means that the variability in number of turns needed to finish the game goes down. This is visually apparent in the plot: there’s a tighter cluster centered around 21–22 games, rather than the much more spread out distribution in a regular game.</p>
<p>The final effect that I see is a greater exaggeration of the bimodal distribution. In <a href="#sec-num_turns" class="quarto-xref">Section&nbsp;3.1</a>, I pointed out there was a spike around 13–14 turns and another around 20. We see those same numbers, maybe shifted slightly, but in a much more stark way. It’s really hard to pick out what’s going on here, but I think the obvious answer is that the games that took a shortcut took fewer turns. I mean, of course taking a shortcut will make the whole game shorter, but is the effect as strong as it seems?</p>
<p>It seems so. I classified the games based on whether they finished in 15 turns or less and whether they took the Peppermint Pass (the really good shortcut at the beginning of the game). Sure enough, 95% of games that took that shortcut also finished in 15 turns or less, and 98% of games that did <em>not</em> take the shortcut finished the game in more than 15 turns.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> When I plot the data split up by whether the peppermint pass was taken, the pattern is crystal clear.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;I ran a chi-squared on this data and it supports the idea of a relationship between these two categories (<span class="math inline">\(\chi^2\)</span> = 159,941.1, df = 1, <em>p</em> &lt; 0.0001). I’m not really sure if chi-squared tests work with such large numbers, but the results are so clear in just the summary that stats aren’t needed to show the pattern.</p></div></div><div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>games_without_candies <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">turns =</span> <span class="fu">n</span>(),</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">took_peppermint =</span> <span class="fu">if_else</span>(<span class="fu">sum</span>(shortcut <span class="sc">==</span> <span class="st">"peppermint pass"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"took the peppermint pass"</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"did not take the peppermint pass"</span>),</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> game_num) <span class="sc">|&gt;</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(turns, <span class="at">color =</span> took_peppermint, <span class="at">fill =</span> took_peppermint)) <span class="sc">+</span> </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.45</span>, <span class="at">adjust =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.02</span>)),</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_ptol</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"took the peppermint pass"</span>, <span class="st">"did not take the peppermint pass"</span>)) <span class="sc">+</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_fill_ptol</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"took the peppermint pass"</span>, <span class="st">"did not take the peppermint pass"</span>)) <span class="sc">+</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of turns to finish a solo game of Candyland without candy cards"</span>,</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>,</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"percent of games"</span>,</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) <span class="sc">+</span> </span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>So, going back to the original data plotted in <a href="#sec-num_turns" class="quarto-xref">Section&nbsp;3.1</a>, I’ll bet that’s what’s going on. It’s not as clear of a pattern in a real game because it mostly gets washed out from the candies, but I’ll bet that’s what’s going on. Let me plot that original data again just to make sure.</p>
<div class="cell">
<details class="code-fold">
<summary>See code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>games <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">turns =</span> <span class="fu">n</span>(),</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">took_peppermint =</span> <span class="fu">if_else</span>(<span class="fu">sum</span>(shortcut <span class="sc">==</span> <span class="st">"peppermint pass"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"took the peppermint pass"</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"did not take the peppermint pass"</span>),</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> game_num) <span class="sc">|&gt;</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(turns, <span class="at">color =</span> took_peppermint, <span class="at">fill =</span> took_peppermint)) <span class="sc">+</span> </span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.45</span>, <span class="at">adjust =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.02</span>)),</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_ptol</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"took the peppermint pass"</span>, <span class="st">"did not take the peppermint pass"</span>)) <span class="sc">+</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_fill_ptol</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"took the peppermint pass"</span>, <span class="st">"did not take the peppermint pass"</span>)) <span class="sc">+</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of turns to finish a solo game of Candyland"</span>,</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on 10,000 simulated games"</span>,</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"percent of games"</span>,</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">base_family =</span> <span class="st">"Avenir"</span>) <span class="sc">+</span> </span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>Yep, there it is. So, that bimodal distribution is because of the peppermint pass. Pretty cool.</p>
</section>
</section>
<section id="conclusion" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">5</span> Conclusion</h2>
<p>Okay, so I had some fun with this. Simulating Candyland is pretty straightforward, and once you’ve got it going, it’s easy to query and see patterns. And it’s easy to make some adjustments and see what kind of effect it has on the gameplay.</p>
<p>Here’s a summary of the main findings:</p>
<ul>
<li>The typical number of turns to finish a game is 10–25, more on the lower end if you take the Peppermint Pass and more on the upper end if you don’t.</li>
<li>It’s typical to see 5–15 single-color cards and 3-10 double cards.</li>
<li>Only about a third of games take one of the shortcuts, and the Gummy Pass is 1.4 times as likely as the Peppermint Pass.</li>
<li>You’ll see at least one candy card in 90% of games. For some inexplicable reason, the Cupcake and Chocolate Truffle are far more common than due to random chance alone, and the Lollipop, Ice Cream Cone, and Gingerbread Man are far less common.</li>
<li>The candy cards are, overall, neither an advantage nor a disadvantage. If you remove candy cards drawn on the first turn, the average number of tiles advanced because of a candy card is basically zero.</li>
</ul>


</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/joeystanley\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>