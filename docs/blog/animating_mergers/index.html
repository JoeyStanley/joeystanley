<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joey Stanley">
<meta name="dcterms.date" content="2019-11-04">

<title>Animating Mergers – Joey Stanley</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=350348361"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '350348361', { 'anonymize_ip': true});
</script>
<link rel="stylesheet" media="screen" href="https://font.download/font/iowanoldst-bt" type="text/css">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title"><span id="name">Joey Stanley</span><br><span id="tagline">assistant professor, linguistics</span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About Me <em>who am I?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv/index.html"> 
<span class="menu-text">CV <em>what have I done?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research/index.html"> 
<span class="menu-text">Research <em>what do I research?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html"> 
<span class="menu-text">Teaching <em>what do I teach?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pages/idiolect"> 
<span class="menu-text">Idiolect <em>what do I sound like?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog <em>what’s going on?</em></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:joey_stanley@byu.edu"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-list" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-list" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-list">    
        <li>
    <a class="dropdown-item" href="https://bsky.app/profile/joeystanley.com">
 <span class="dropdown-text"><i class="fa-brands fa-bluesky" aria-label="bluesky"></i> Bluesky</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://twitter.com/joey_stan"><i class="bi bi-twitter" role="img">
</i> 
 <span class="dropdown-text">Twitter</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://scholar.google.com/citations?user=61pJV_YAAAAJ&amp;hl=en&amp;oi=sra"><i class="bi bi-mortarboard-fill" role="img">
</i> 
 <span class="dropdown-text">Google Scholar</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/JoeyStanley/joeystanley_new"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Github</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../joeystanley.com/feed.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="dropdown-text">RSS feed</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Animating Mergers</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Animations</div>
                <div class="quarto-category">Data Viz</div>
                <div class="quarto-category">Github</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">Side Projects</div>
                <div class="quarto-category">Simulations</div>
                <div class="quarto-category">Teaching</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Joey Stanley </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 4, 2019</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#using-gganimate" id="toc-using-gganimate" class="nav-link active" data-scroll-target="#using-gganimate">Using gganimate</a></li>
  <li><a href="#merger-by-approximation" id="toc-merger-by-approximation" class="nav-link" data-scroll-target="#merger-by-approximation">Merger by Approximation</a></li>
  <li><a href="#merger-by-transfer" id="toc-merger-by-transfer" class="nav-link" data-scroll-target="#merger-by-transfer">Merger by Transfer</a></li>
  <li><a href="#merger-by-phonological-transfer" id="toc-merger-by-phonological-transfer" class="nav-link" data-scroll-target="#merger-by-phonological-transfer">Merger by Phonological Transfer</a></li>
  <li><a href="#merger-by-expansion" id="toc-merger-by-expansion" class="nav-link" data-scroll-target="#merger-by-expansion">Merger by Expansion</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<p>I’ve dabbled with creating animations in R, but since the newest version of <a href="https://gganimate.com">gganimate</a> came out, I’ve been trying to find a useful way to use it. (I don’t know if <a href="../../blog/simulating_chutes_and_ladders">visualizing simulations of Chutes and Ladders</a> counts as “useful”…) But as I was putting together a lecture on mergers last semester, it occured to me that the best way to illustrate them would be with animations! So I took the opportunity and created some fun visuals.</p>
<section id="using-gganimate" class="level2">
<h2 class="anchored" data-anchor-id="using-gganimate">Using gganimate</h2>
<p>As it turns out, gganimate is awesome! I mean all you need to do is add literally one line of code to your plot and it animates it! I find it easiest to think of the data in movie frames. When I group things by frame, gganimate will take care of the rest for me.</p>
<p>The tricky part is creating the underlying dataset. Let’s say I want to illustrate a merger with 50 hypothetical datapoints from vowel A and 50 from vowel B—that’s 100 data points total. If I’ve got an animation of in mind that has 15 different frames, I’m going to need a dataframe with 1500 rows in it. And when the data is all artificial, it gets tricky to create all those carefully.</p>
<p>So, this is not a tutorial because my code was awful, hacky, clunky, etc. It’s on <a href="https://github.com/JoeyStanley/merger_animations">my Github</a> for reproducibility and stuff but I won’t talk about it much here because detracts from what I really wanted to show: the animations.</p>
</section>
<section id="merger-by-approximation" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="merger-by-approximation">Merger by Approximation</h2>
<p>I’ll start with a <em>Merger by Approximation</em> because it’s the most straightforward. The first to describe this was Trudgill &amp; Foxcroft, who looked at the merger of Middle English <strong>ō</strong> [ɔː] (<em>road</em>, <em>go</em>) with the diphthong [ɔu] (<em>flow</em>, <em>know</em>). My American ears can’t even imagine these being pronounced differently, but apparently some speakers in East Anglia retain the distinction, though they were in the process of becoming merged.</p>
<div class="page-columns page-full"><p>I’ll let you dig into the original study , but the main point they make is that the merger happens “gradually.” Their description of this merger tactic is that speakers</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Trudgill, Peter, and Tina Foxcroft. 1978. On the Sociolinguistics of Vocalic Mergers: Transfer and Approximation in East Anglia. In <em>Sociolinguistic Patterns in British English</em>, edited by Peter Trudgill, 69–79. London: Edward Arnold.</span></div></div>
<blockquote class="blockquote">
<p>“could gradually approximate the two vowels by bringing them closer together phonetically until, finally, they become identical.” (Trudgill &amp; Foxcroft 1978:73)</p>
</blockquote>
<p>Here’s what I have in mind for what a merger by approximation is like:</p>
<p><img src="approximation.gif" class="img-fluid"></p>
<div class="page-columns page-full"><p>After several additional cases of this merger had been documented, Labov (1994:321) further clarifies, saying that the final vowel can end up somewhere between the two historic vowel classes. In other cases, like what I’ve illustrated above, one vowel stays put while the other vowel shifts to join it. In either case, the overall distribution of the final vowel is approximately the same size as one the original ones, leaving a gap in the F1-F2 space.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Labov, William. 1994. <em>Principles of Linguistic Change. Vol. 1: Internal Features.</em> Language in Society. Oxford: Wiley-Blackwell.</span></div></div>
</section>
<section id="merger-by-transfer" class="level2">
<h2 class="anchored" data-anchor-id="merger-by-transfer">Merger by Transfer</h2>
<p>In the very same paper, with the very same phenomenon, and among the same people, Trudgill and Foxcroft describe another mechanism of merger, which has since been called a <em>Merger by Transfer</em>. With this method, speakers</p>
<blockquote class="blockquote">
<p>“could variably, one by one, transfer lexical items from one lexical set to another.” (Trudgill &amp; Foxcroft 1978:72)</p>
</blockquote>
<p>Here’s how I visualize this type of merger. I’ve animated so words shift slowly at first, then a whole bunch very quickly, and then tapering off. I don’t know if that S-shaped rate of change is officially part of a merger by transfer, but it’s kind of how I picture it.</p>
<p><img src="transfer.gif" class="img-fluid"></p>
<p>Labov (1994:321) points out that you don’t really find any words phonetically intermediate between the two historic classes, which I think is the most distinguishing property of this merger. They’re either vowel A or vowel B. Labov also finds that this type of merger is more often found when there’s prestige involved and that the merger is a change from above.</p>
<p>It’s a haphazard shift, and during the change each person could have their own personal distribution of which words belong to which vowel class. Which probably makes it really juicy to study.</p>
</section>
<section id="merger-by-phonological-transfer" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="merger-by-phonological-transfer">Merger by Phonological Transfer</h2>
<div class="page-columns page-full"><p> Nearly 40 years later, Aaron Dinkin published a paper describing what he calls a <em>Merger by Phonological Transfer</em>. The phenomenon in question is the merger of <sc>lot</sc> with <sc>thought</sc>. In upstate New York, he finds that many speakers do not have the merger—except in before coda laterals. Thus, <em>cot</em> and <em>caught</em> are distinct, and <em>collar</em> and <em>caller</em> are distinct, but <em>doll</em> rhymes with <em>hall</em>. In Dinkin’s words, what’s happening here is</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Dinkin, Aaron J. 2016. Phonological Transfer as a Forerunner of Merger in Upstate New York. <em>Journal of English Linguistics</em> 44(2): 162–88. doi:<a href="https://doi.org/10.1177/0075424216634795">10.1177/0075424216634795</a></span></div></div>
<blockquote class="blockquote">
<p>“the discrete replacement of one phoneme in a given phonological environment with a different phoneme.” (Dinkin 2016:183)</p>
</blockquote>
<p>It’s a type of merger by transfer, only it happens phonologically rather than lexically. Instead of individual words defecting to another category, entire groups of words, defined by some phonological property, jump ship <em>en bloc</em> to the new phoneme.</p>
<p>Trudgill and Foxcroft also hint at this in their original 1978 paper, saying that</p>
<blockquote class="blockquote">
<p>“In some cases, that is, diffusion of the innovation may not be genuinely lexical but rather influenced by phonological conditioning. In other words, the change may also be <em>linguistically</em> gradual, in that it affects some environments before others.” (Trudgill &amp; Foxcroft 1978:73)</p>
</blockquote>
<p>In Dinkin’s data, it appears that it’s not quite so abrupt. Before one vowel is replaced by another, words in that phonological category phonetically approximate the new vowel first, before switching over. So in the animation, I’ve included that detail:</p>
<p><img src="phon_transfer.gif" class="img-fluid"></p>
<p>Incidentally, I’ve totally got this merger in <a href="../../pages/idiolect.html">my own speech</a>. The vowels in <em>collar</em> and <em>caller</em> are distinct but in <em>doll</em> and <em>hall</em> they are not. I grew up in a suburb of St.&nbsp;Louis, but my dad is from Upstate New York. I’ll have to ask him what his vowels are like in those words.</p>
</section>
<section id="merger-by-expansion" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="merger-by-expansion">Merger by Expansion</h2>
<div class="page-columns page-full"><p> The final merger I’ll show is was described by Ruth Herold in her 1990 dissertation. She too looks at the merger of <sc>lot</sc> and <sc>thought</sc>, this time in Western Pennsylvania. She describes a <em>merger by expansion</em> as follows</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Herold, Ruth. 1990. Mechanisms of Merger: The Implementation and Distribution of the Low Back Merger in Eastern Pennsylvania. Dissertation, University of Pennsylvania, 1990.</span></div></div>
<blockquote class="blockquote">
<p>“The lexical constraints on the distribution of two former phonemes are lifted. As a result, the entire phonetic range formally divided between the two phonemes becomes available for the realization of either. (Herold 1990:91–92)</p>
</blockquote>
<p>She provides some really excellent plots, showing a father-son pair where the father has a distinction and the son does not. The crucial part though is that “the phonetic range of the new phoneme is roughly equivalent to the union of the range of the two phonemes that merged” (Labov 1994:322). Here’s my interpretation of this merger.</p>
<p><img src="expansion.gif" class="img-fluid"></p>
<p>This is a very abrupt change, happening quite suddenly, and Herold uses the word <em>explode</em> several times to describe what happens, so I wanted to convey that in my animation. Dan Johnson (2010) finds that even within the same family, younger children may have the merger and older kids do not.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>I’ve learned that I’m a visual learner, so when the gganimate package came out, I thought I’d use it to illustrate different mechanisms of merger. These are my interpretations of how they progress, but I feel like these may be useful to other people as well.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/joeystanley\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>