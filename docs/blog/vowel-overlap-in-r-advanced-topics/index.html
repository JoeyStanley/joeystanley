<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joey Stanley">
<meta name="dcterms.date" content="2019-02-07">

<title>Vowel overlap in R: More advanced topics – Joey Stanley</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=350348361"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '350348361', { 'anonymize_ip': true});
</script>
<link rel="stylesheet" media="screen" href="https://font.download/font/iowanoldst-bt" type="text/css">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title"><span id="name">Joey Stanley</span><br><span id="tagline">assistant professor, linguistics</span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About Me <em>who am I?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv/index.html"> 
<span class="menu-text">CV <em>what have I done?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research/index.html"> 
<span class="menu-text">Research <em>what do I research?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html"> 
<span class="menu-text">Teaching <em>what do I teach?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pages/idiolect"> 
<span class="menu-text">Idiolect <em>what do I sound like?</em></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog <em>what’s going on?</em></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:joey_stanley@byu.edu"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-list" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-list" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-list">    
        <li>
    <a class="dropdown-item" href="https://bsky.app/profile/joeystanley.com">
 <span class="dropdown-text"><i class="fa-brands fa-bluesky" aria-label="bluesky"></i> Bluesky</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://twitter.com/joey_stan"><i class="bi bi-twitter" role="img">
</i> 
 <span class="dropdown-text">Twitter</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://scholar.google.com/citations?user=61pJV_YAAAAJ&amp;hl=en&amp;oi=sra"><i class="bi bi-mortarboard-fill" role="img">
</i> 
 <span class="dropdown-text">Google Scholar</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/JoeyStanley/joeystanley_new"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Github</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../joeystanley.com/feed.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="dropdown-text">RSS feed</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Vowel overlap in R: More advanced topics</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">How-to Guides</div>
                <div class="quarto-category">Methods</div>
                <div class="quarto-category">Phonetics</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">Skills</div>
                <div class="quarto-category">Data Viz</div>
                <div class="quarto-category">Vowel Overlap</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Joey Stanley </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 7, 2019</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-prep" id="toc-data-prep" class="nav-link active" data-scroll-target="#data-prep">Data prep</a></li>
  <li><a href="#multiple-vowel-pairs" id="toc-multiple-vowel-pairs" class="nav-link" data-scroll-target="#multiple-vowel-pairs">Multiple vowel pairs</a></li>
  <li><a href="#the-select-clash-and-bhattacharyyas-affinity" id="toc-the-select-clash-and-bhattacharyyas-affinity" class="nav-link" data-scroll-target="#the-select-clash-and-bhattacharyyas-affinity">The <code>select</code> clash and Bhattacharyya’s Affinity</a></li>
  <li><a href="#making-the-functions-more-robust" id="toc-making-the-functions-more-robust" class="nav-link" data-scroll-target="#making-the-functions-more-robust">Making the functions more robust</a>
  <ul class="collapse">
  <li><a href="#making-bhatt-more-robust" id="toc-making-bhatt-more-robust" class="nav-link" data-scroll-target="#making-bhatt-more-robust">Making <code>bhatt</code> more robust</a></li>
  <li><a href="#trying-to-make-pillai-more-robust" id="toc-trying-to-make-pillai-more-robust" class="nav-link" data-scroll-target="#trying-to-make-pillai-more-robust">Trying to make <code>pillai</code> more robust</a></li>
  </ul></li>
  <li><a href="#miscellaneous-material" id="toc-miscellaneous-material" class="nav-link" data-scroll-target="#miscellaneous-material">Miscellaneous material</a>
  <ul class="collapse">
  <li><a href="#combining-functions" id="toc-combining-functions" class="nav-link" data-scroll-target="#combining-functions">Combining functions</a></li>
  </ul></li>
  <li><a href="#reshape-and-visualize" id="toc-reshape-and-visualize" class="nav-link" data-scroll-target="#reshape-and-visualize">Reshape and visualize</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is a continuation of my <a href="../../blog/a-tutorial-in-calculating-vowel-overlap">previous tutorial</a> on how to calculate Pillai scores and Bhattacharyya’s Affinity in R for the purposes of measuring vowel overlap. It occurred to me as I was putting the previous one together though that I had a <em>lot</em> of things to say and the tutorial got really long and complicated. So I moved all the more advanced topics to this one to keep the main one a little lighter and more approachable.</p>
<p>In this post, I’ll cover some topics like what to do if you have multiple vowel pairs you want to measure in each speaker, errors you may encounter with the <code>select</code> function when you’re calculating Bhattacharyya’s Affinity, ways at making the functions less error-prone, and some visualizations you can do with your data after you’ve collected it.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Update (November 23, 2021):</strong> Betsy Sneller and I have done some recent research on Pillai scores. Please see the summary of our <a href="../../blog/asa2021">ASA2021</a> poster (and the <a href="https://doi.org/10.1121/10.0016757">paper itself</a>) for more information.</p>
</div>
</div>
<section id="data-prep" class="level2">
<h2 class="anchored" data-anchor-id="data-prep">Data prep</h2>
<p>The data prep for this post is covered in Part 1 already, so I’ll put the code here without further comment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>my_vowels <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../../data/joey.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(stress <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(vowel, word, dur, F1.<span class="fl">50.</span>, F2.<span class="fl">50.</span>, fol_seg, plt_manner, plt_place, plt_voice) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">F1 =</span> F1.<span class="fl">50.</span>, <span class="at">F2 =</span> F2.<span class="fl">50.</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">fake_speaker =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Joey"</span>, <span class="st">"Stanley"</span>), <span class="fu">nrow</span>(.), <span class="at">replace =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>low_back <span class="ot">&lt;-</span> my_vowels <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(vowel <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AA"</span>, <span class="st">"AO"</span>), </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>fol_seg <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"L"</span>, <span class="st">"R"</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>           word <span class="sc">!=</span> <span class="st">"ON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So where I left off at the last tutorial was a function that can calculate the Pillai score and another for the Bhattacharyya’s Affinity, each with the help of <code>summarize</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pillai <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(<span class="fu">manova</span>(...))<span class="sc">$</span>stats[<span class="st">"vowel"</span>,<span class="st">"Pillai"</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>bhatt <span class="ot">&lt;-</span> <span class="cf">function</span> (F1, F2, vowel) {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    vowel_data <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(<span class="fu">data.frame</span>(vowel))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    sp_df <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">SpatialPointsDataFrame</span>(<span class="fu">cbind</span>(F1, F2), vowel_data)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    adehabitatHR<span class="sc">::</span><span class="fu">kerneloverlap</span>(sp_df, <span class="at">method=</span><span class="st">'BA'</span>)[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>low_back <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">low_back_pillai =</span> <span class="fu">pillai</span>(<span class="fu">cbind</span>(F1, F2) <span class="sc">~</span> vowel),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">low_back_bhatt =</span> <span class="fu">bhatt</span>(F1, F2, vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  low_back_pillai low_back_bhatt
1       0.2250877      0.8296413</code></pre>
</div>
</div>
<p>Okay cool. Let’s see what else can be done with this.</p>
</section>
<section id="multiple-vowel-pairs" class="level2">
<h2 class="anchored" data-anchor-id="multiple-vowel-pairs">Multiple vowel pairs</h2>
<p>What I’ve shown so far is how to calculate the Pillai score for multiple speakers for a <em>single</em> pair of vowels. The next question is what how to get the Pillai score for multiple speakers for <em>multiple</em> pairs of vowels.</p>
<p>Unfortunately, I don’t really know of a quick way to do that. The problem is a single vowel might be used in multiple pairs (like measuring <sc>trap</sc>-<sc>lot</sc> overlap or <sc>trap</sc>-<sc>fleece</sc> overlap). Plus, you might be only interested in certain vowels in certain phonetic environments, like before nasals or before tautosyllabic /l/, so defining all that on the fly would be tricky. So there’s no good way that I know of to loop through or group everything in a straightforward manner like we could with speaker.</p>
<p>The easiest solution I can think of is to define separate datasets like we’ve done with <code>low_back</code> and run the same code on them. That way, you have all the flexibility of defining specific allophones for each question. And, you probably won’t be getting the Pillai score on <em>too</em> many pairs of vowels, right?</p>
<p>Let’s make two more subsets. First, I’ll look at the <em>pin-pen</em> merger which I don’t really have, but is common in the South where I live right now. (I’ll also remove some stop words from the dataset.) I’ll also look at the <em>fail-fell</em> merger, which I also don’t really have, but can be found in places like Utah and parts of Texas. I’ll create these subsets and plot them so you can see what they look like in my own speech. Maybe you can roughly estimate the Pillai score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pin_pen <span class="ot">&lt;-</span> my_vowels <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(vowel <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IH"</span>, <span class="st">"EH"</span>), </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>           fol_seg <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"N"</span>), </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>word <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IN"</span>, <span class="st">"INTO"</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pin_pen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  vowel        word  dur    F1     F2 fol_seg plt_manner plt_place plt_voice
1    EH       MEANT 0.06 448.8 1631.9       N      nasal    apical    voiced
2    EH      MENTAL 0.06 570.5 1678.6       N      nasal    apical    voiced
3    EH       ENTER 0.12 482.7 1738.0       N      nasal    apical    voiced
4    IH   BEGINNING 0.05 338.9 1968.6       N      nasal    apical    voiced
5    EH TEMPERATURE 0.06 495.6 1674.6       M      nasal    labial    voiced
6    EH TEMPERATURE 0.05 477.2 1612.0       M      nasal    labial    voiced
  fake_speaker
1      Stanley
2         Joey
3         Joey
4         Joey
5         Joey
6      Stanley</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pin_pen, <span class="fu">aes</span>(F2, F1, <span class="at">color =</span> vowel, <span class="at">label =</span> word)) <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_reverse</span>() <span class="sc">+</span> <span class="fu">scale_y_reverse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fail_fell <span class="ot">&lt;-</span> my_vowels <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(vowel <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"EY"</span>, <span class="st">"EH"</span>), fol_seg <span class="sc">==</span><span class="st">"L"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fail_fell)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  vowel         word  dur    F1     F2 fol_seg plt_manner plt_place plt_voice
1    EY     AILMENTS 0.06 387.3 2149.5       L    lateral    apical    voiced
2    EY       SAILOR 0.08 382.5 1898.5       L    lateral    apical    voiced
3    EH    CELLPHONE 0.09 509.4 1549.1       L    lateral    apical    voiced
4    EY SURVEILLANCE 0.09 468.9 2104.8       L    lateral    apical    voiced
5    EY       TAYLOR 0.05 311.7 2069.7       L    lateral    apical    voiced
6    EH         ELSE 0.06 583.1 1343.6       L    lateral    apical    voiced
  fake_speaker
1         Joey
2      Stanley
3         Joey
4      Stanley
5      Stanley
6         Joey</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fail_fell, <span class="fu">aes</span>(F2, F1, <span class="at">color =</span> vowel, <span class="at">label =</span> word)) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_reverse</span>() <span class="sc">+</span> <span class="fu">scale_y_reverse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Okay, so now we’re ready to calculate Pillai scores to those new pairs. Because we’ve created the <code>pillai</code> function, we can relatively easily apply it to each of these datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pin_pen <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pin_pen_pillai =</span> <span class="fu">pillai</span>(<span class="fu">cbind</span>(F1, F2) <span class="sc">~</span> vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pin_pen_pillai
1      0.6964555</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fail_fell <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">fail_fell_pillai =</span> <span class="fu">pillai</span>(<span class="fu">cbind</span>(F1, F2) <span class="sc">~</span> vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  fail_fell_pillai
1        0.8189749</code></pre>
</div>
</div>
<p>So this is pretty cool. Here you can see that my <em>fail-fell</em> vowel classes are quite distinct with a Pillai score of 0.82. My <em>pin-pen</em> vowels are also quite distinct with a Pillai score of 0.70.</p>
<p>So we’ve run the same thing three times on three different datasets. But can we do this even more elegantly? Sure!</p>
<p>Okay, so first, I’ll combine all three datasets (<code>low_back</code>, <code>pin_pen</code> and <code>fail_fell</code>) into one combined dataframe using <code>bind_rows</code>. But in order to “keep track” of which dataframe a particular row came from, I’ll create a new column called <code>vowel_pair</code> using the <code>.id = "vowel_pair"</code> argument. To get this to work then, I’ll “name” each of the dataframes as I combine it. So for example, the <code>low_back</code> dataframe is called <code>"low back"</code> and I show that by putting the new name between ticks (that little thing next to the number 1 key on my keyboard that looks like this: `). If you combine the dataframes in this way, you’ll have a new column saying which one it came from.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="st">`</span><span class="at">low back</span><span class="st">`</span> <span class="ot">=</span> low_back,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">`</span><span class="at">pin pen</span><span class="st">`</span>  <span class="ot">=</span> pin_pen,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">`</span><span class="at">fail fell</span><span class="st">`</span> <span class="ot">=</span> fail_fell, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">.id =</span> <span class="st">"vowel_pair"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_pairs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  vowel_pair vowel   word  dur    F1     F2 fol_seg plt_manner   plt_place
1   low back    AA   TODD 0.17 614.6 1065.2       D       stop      apical
2   low back    AA    GOD 0.09 554.0 1250.3       D       stop      apical
3   low back    AA FATHER 0.12 598.6 1000.2      DH  fricative interdental
4   low back    AO  WATER 0.05 587.5  986.7       T       stop      apical
5   low back    AO   LONG 0.09 577.6 1008.3      NG      nasal       velar
6   low back    AA STOCKS 0.13 578.1 1073.7       K       stop       velar
  plt_voice fake_speaker
1    voiced         Joey
2    voiced      Stanley
3    voiced         Joey
4 voiceless         Joey
5    voiced      Stanley
6 voiceless         Joey</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(all_pairs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    vowel_pair vowel     word  dur    F1     F2 fol_seg plt_manner plt_place
172  fail fell    EY     GAIL 0.12 431.1 1908.6       L    lateral    apical
173  fail fell    EY AILMENTS 0.12 438.0 2048.3       L    lateral    apical
174  fail fell    EY     SAIL 0.06 423.7 1797.2       L    lateral    apical
175  fail fell    EH     FELL 0.05 502.3 1539.2       L    lateral    apical
176  fail fell    EY  WAILING 0.12 421.3 2086.7       L    lateral    apical
177  fail fell    EY    STALE 0.14 437.9 1862.4       L    lateral    apical
    plt_voice fake_speaker
172    voiced         Joey
173    voiced      Stanley
174    voiced         Joey
175    voiced      Stanley
176    voiced         Joey
177    voiced      Stanley</code></pre>
</div>
</div>
<p>Now that may seem like more work than it’s worth, but the payoff is that when you actually go to do the Pillai scores, it’s hardly any more complicated than before. In the <code>group_by</code> function, just put that you want to group the data by the vowel pair <em>and</em> by the speaker and it’ll magically do the rest for you.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vowel_pair, fake_speaker) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pillai =</span> <span class="fu">pillai</span>(<span class="fu">cbind</span>(F1, F2) <span class="sc">~</span> vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   vowel_pair [3]
  vowel_pair fake_speaker pillai
  &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;
1 fail fell  Joey          0.825
2 fail fell  Stanley       0.849
3 low back   Joey          0.117
4 low back   Stanley       0.301
5 pin pen    Joey          0.731
6 pin pen    Stanley       0.708</code></pre>
</div>
</div>
<p>In my opinion, it’s worth it to do the extra bit of work beforehand prepping your data with the whole <code>bind_rows</code> business and creating the new function because the benefit is that when it actually comes time to calculate the Pillai score, you’ve got a tidy dataset to work with and a flexible function to use.</p>
</section>
<section id="the-select-clash-and-bhattacharyyas-affinity" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="the-select-clash-and-bhattacharyyas-affinity">The <code>select</code> clash and Bhattacharyya’s Affinity</h2>
<div class="page-columns page-full"><p> Okay, in Part 1, I talked about the library needed to run Bhattacharyya’s Affinity, <code>adehabitatHR</code>. However, it always seemed to be the case that my tidyverse code, particularly the <code>select</code> function always broke in scripts that used this package. It was super annoying and for the longest time I couldn’t figure out why.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">In Dan Johnson’s <a href="https://danielezrajohnson.shinyapps.io/nwav_44/">NWAV presentation</a> where he introduces Bhattacharyya’s Affinity, he installs and loads an additional package <code>sp</code> so that the <code>SpatialPointsData-Frame</code> function can be used. This is technically not necessary to do explicitly, because <code>sp</code> is a dependency of <code>adehabitatHR</code>, meaning when you install and load <code>adehabitatHR</code> you also are bringing <code>sp</code> along too.</span></div></div>
<p>As it turns out, when you load the <code>adehabitatHR</code> package, it also loads the <code>MASS</code> package. Unfortunately for us, there’s a function in <code>MASS</code> called <code>select</code>. Well, <code>dplyr</code> also has a <code>select</code> function. Having two <code>select</code> functions at the same time creates a clash. So, R chooses the one that was loaded most recently, which is <code>MASS</code> (via <code>adehabitatHR</code>).</p>
<p>You can actually see this in a warning when you load <code>adehabitatHR</code> if <code>dplyr</code> (via <code>tidyverse</code>) is already installed:</p>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="margin-aside">To replicate the messages and output in this section you’ll have to restart R and load the packages again from scratch in this order. To do that, go to Session→Restart R.</span></div></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adehabitatHR)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ...output truncated...</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: MASS</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Attaching package: ‘MASS’</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="do">## The following object is masked from ‘package:dplyr’:</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="do">##     select</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="do">## ...output truncated...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And when you go to use <code>select</code>, R thinks it should run <code>MASS::select</code> instead of <code>dplyr::select</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>low_back <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(vowel)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in select(., vowel) : unused argument (vowel)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, there are two solutions to this. First, you can simply take advantage of the fact that the most recently loaded package takes priority, and load <code>adehabitatHR</code> <em>before</em> you load <code>tidyverse</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adehabitatHR)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>low_back <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(vowel)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="do">##     vowel</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      AA</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2      AA</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3      AA</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 4      AA</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 5      AO</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 6      AA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That’ll ensure that <code>dplyr::select</code> takes precedence. However, I’ve never really liked this for a couple reasons. One, I’m stubborn, and I like to load my packages in a specific order (basically the order that I use them) and at the top of my code it seems weird to load a package <em>before</em> <code>tidyverse</code>. Also, it means that it I’m already going along in an R session, with <code>tidyverse</code> loaded already, if I want to then do some Bhattacharyya’s Affinity, I’ll need to either unload the library or restart R, which is never really all that convenient.</p>
<p>The other option is to not actually load the <code>adehabitatHR</code> package at all. You can still use functions when a package is not loaded (as long as you already have them installed to your computer) by prefacing the function name with the name of the package and a pair of colons. So when it comes time to use the one function I need from <code>adehabitatHR</code>, the <code>kerneloverlap</code> function, I’ll just type <code>adehabitatHR::kerneloverlap</code>. In my opinion, this is a better route just because I don’t like loading an entire package (and reworking lots of others things in my code) just to make sure of one function.</p>
<p>For the remainder of this tutorial, I’m going to implement this second option. And for consistency, I’ll also not load the <code>sp</code> package either and call <code>SpatialPointsDataFrame</code> using <code>sp::</code> prefixed before it.</p>
</section>
<section id="making-the-functions-more-robust" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="making-the-functions-more-robust">Making the functions more robust</h2>
<p>In this section, I’ll go into some more detail about how to make your functions less likely to crash. Some of the topics here get tedious and cover use some more advanced R skills. If you’ve been finding that your code breaks when you apply it to a bunch of speakers, this might help with these issues.</p>
<p>I’ll start with the <code>bhatt</code> function because it’s a little more straightforward. Then we’ll get into some slightly more confusing stuff with <code>pillai</code>.</p>
<section id="making-bhatt-more-robust" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="making-bhatt-more-robust">Making <code>bhatt</code> more robust</h3>
<div class="page-columns page-full"><p>I’ve noticed when running Bhattacharyya’s affinity on my data that it tends to crash if certain conditions aren’t met. For example, the calculation requires at least five observations from each vowel class to work. So, let’s say I wanted to look at the <em>pull-pole</em> merger (that is, the merger of <sc>foot</sc> and <sc>goat</sc> before laterals). We can create the dataset the same way as before</p><div class="no-row-height column-margin column-container"><span class="margin-aside">I <em>think</em> I have this merger, but I’m really not sure. I thought studying it in my data would help my own intuitions, but now I’m always hyperaware of the relatively small group of relevant words. But I digress…</span></div></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pull_pole <span class="ot">&lt;-</span> my_vowels <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(vowel <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"UH"</span>, <span class="st">"OW"</span>), fol_seg <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"L"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">droplevels</span>()</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pull_pole)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  vowel       word  dur    F1    F2 fol_seg plt_manner plt_place plt_voice
1    OW       GOAL 0.22 366.7 827.0       L    lateral    apical    voiced
2    OW       POLO 0.19 418.2 893.9       L    lateral    apical    voiced
3    OW      ROLLS 0.11 385.7 785.1       L    lateral    apical    voiced
4    OW      MOULD 0.06 388.1 732.0       L    lateral    apical    voiced
5    OW  PORTFOLIO 0.06 444.1 988.3       L    lateral    apical    voiced
6    OW CONTROLLED 0.07 389.0 849.7       L    lateral    apical    voiced
  fake_speaker
1      Stanley
2         Joey
3      Stanley
4         Joey
5      Stanley
6      Stanley</code></pre>
</div>
</div>
<p>But when we run it…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pull_pole <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pull_pole_bhatt =</span> <span class="fu">bhatt</span>(F1, F2, vowel))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in kernelUD(xy, same4all = TRUE, ...): At least 5 relocations </span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  are required to fit an home range</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It crashes. You can see in the error message that it says you need at least five “relocations” per “home range”. You can tell this package was intended for animal location data instead of vowel data! But we can see that there aren’t five words in the <sc>pull</sc> (= “UH”) class:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pull_pole<span class="sc">$</span>vowel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
OW UH 
50  1 </code></pre>
</div>
</div>
<p>There’s just one token! This is problematic because if I’m going to apply this function to like 30 speakers, even if one speaker has insufficient data I want it to work on everyone else without crashing.</p>
<p>So, how can I make the <code>bhatt</code> function a little more robust? Expert R users might know of fancier ways to do what I’m about to do, but I just put a little <code>if</code> statement in there: if the lowest value in that table is less than five, then <code>return</code>—meaning abort the function—with the value <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>bhatt <span class="ot">&lt;-</span> <span class="cf">function</span> (F1, F2, vowel) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    vowel_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(vowel) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">droplevels</span>()</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">min</span>(<span class="fu">table</span>(vowel_data)) <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># there are at least 5 of each vowel</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    adehabitatHR<span class="sc">::</span><span class="fu">kerneloverlap</span>(sp<span class="sc">::</span><span class="fu">SpatialPointsDataFrame</span>(<span class="fu">cbind</span>(F1, F2), vowel_data), <span class="at">method=</span><span class="st">'BA'</span>)[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>pull_pole <span class="sc">%&gt;%</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pull_pole_bhatt =</span> <span class="fu">bhatt</span>(F1, F2, vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pull_pole_bhatt
1              NA</code></pre>
</div>
</div>
<p>Now, when I run it, it won’t crash anymore. It won’t return a number and instead it’ll just return <code>NA</code>, but at least it doesn’t crash. You can appreciate now how handy this might be when we combine all the data together and then then the function on all vowel pairs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="st">`</span><span class="at">low back</span><span class="st">`</span> <span class="ot">=</span> low_back,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">`</span><span class="at">pin pen</span><span class="st">`</span>  <span class="ot">=</span> pin_pen,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">`</span><span class="at">fail fell</span><span class="st">`</span> <span class="ot">=</span> fail_fell, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">`</span><span class="at">pull pole</span><span class="st">`</span> <span class="ot">=</span> pull_pole,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">.id =</span> <span class="st">"vowel_pair"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vowel_pair) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">bhatt =</span> <span class="fu">bhatt</span>(F1, F2, vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  vowel_pair  bhatt
  &lt;chr&gt;       &lt;dbl&gt;
1 fail fell   0.122
2 low back    0.830
3 pin pen     0.393
4 pull pole  NA    </code></pre>
</div>
</div>
<p>Now, the function will work just fine on the vowel pairs with enough data and will quietly return <code>NA</code> if there’s not enough data.</p>
<p>As it turns out, there were some other problems I ran into in my data, so I had to make the function even more robust. I’ve gone ahead and added a couple other warnings as well. So like one time I didn’t have <em>any</em> tokens of a particular vowel, but plenty of the other. So after applying <code>droplevels</code>, only one vowel remained, so then when I ran <code>table</code>, the lowest number in that table was indeed higher than 5, but it crashed because there was only one vowel there. So, I added a check to makes sure that the table contained exactly two vowel tokens.</p>
<p>Finally, I found out that sometimes there will be a speaker or a vowel pair that happens to have no data. Zero tokens of either vowel. In theory, the other two checks should handle it, but it turns out the checks <em>themselves</em> crash if there’s zero data. So, I added that first line, <code>if (nrow(vowel_data) &lt; 1) return(NA)</code>, before the other checks are done, to ensure that there’s at least <em>something</em> there.</p>
<p>So, the complete function looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>bhatt <span class="ot">&lt;-</span> <span class="cf">function</span> (F1, F2, vowel) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    vowel_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(vowel) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">droplevels</span>()</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make sure there's enough data</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(vowel_data) <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># not zero</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">table</span>(vowel_data)) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># both vowels are represented</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">min</span>(<span class="fu">table</span>(vowel_data)) <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># there are at least 5 of each vowel</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    adehabitatHR<span class="sc">::</span><span class="fu">kerneloverlap</span>(sp<span class="sc">::</span><span class="fu">SpatialPointsDataFrame</span>(<span class="fu">cbind</span>(F1, F2), vowel_data), <span class="at">method=</span><span class="st">'BA'</span>)[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This version of the function is the one that I use in my data. It’s a little more robust than the simpler version and it can safely iterate over whatever groups you want.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>low_back <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(fake_speaker) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">bhatt =</span> <span class="fu">bhatt</span>(F1, F2, vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  fake_speaker bhatt
  &lt;chr&gt;        &lt;dbl&gt;
1 Joey         0.892
2 Stanley      0.728</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vowel_pair, fake_speaker) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">bhatt =</span> <span class="fu">bhatt</span>(F1, F2, vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
# Groups:   vowel_pair [4]
  vowel_pair fake_speaker   bhatt
  &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
1 fail fell  Joey          0.124 
2 fail fell  Stanley       0.0830
3 low back   Joey          0.892 
4 low back   Stanley       0.728 
5 pin pen    Joey          0.291 
6 pin pen    Stanley       0.453 
7 pull pole  Joey         NA     
8 pull pole  Stanley      NA     </code></pre>
</div>
</div>
<p>So that’s it for the Bhattacharyya’s Affinity (for now). Now let’s more on to <code>pillai</code>.</p>
</section>
<section id="trying-to-make-pillai-more-robust" class="level3">
<h3 class="anchored" data-anchor-id="trying-to-make-pillai-more-robust">Trying to make <code>pillai</code> more robust</h3>
<p>Because of the way <code>pillai</code> is implemented right now, particularly with the <code>...</code> syntax, it’s a little tricky to add the same data validation checks that we added in the <code>bhatt</code> function above. In fact, I spent a bit of time on it, but the main hurdle is that the <code>manova</code> function requires things to be in a formula (that is, something like <code>y ~ x</code>). So, for now, I can’t offer a perfect solution to the <code>pillai</code> function.</p>
<p>Instead, I offer a less-than-ideal solution: two different functions, each with their strengths and weaknesses.</p>
<p>The first is <code>pillai</code>, which is exactly how we have it already (repeated here for clarity):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pillai <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(<span class="fu">manova</span>(...))<span class="sc">$</span>stats[<span class="st">"vowel"</span>,<span class="st">"Pillai"</span>]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The good part about this function is that whatever formula you want to use, works perfectly fine. So if you want to add duration or F3 to the dependent variable matrix, or pack on all sorts of social or phonological factors, go for it and it’ll work as long as <code>manova</code> can handle it.</p>
<p>The bad part about this is that we can’t add any additional data validation procedures to account for potentially missing data. So like if I try to run it on the <code>pull_pole</code> dataset like I did with <code>bhatt</code>, it’ll crash.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vowel_pair, fake_speaker) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pillai_score =</span> <span class="fu">pillai</span>(<span class="fu">cbind</span>(F1, F2) <span class="sc">~</span> vowel))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): </span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="do">## contrasts can be applied only to factors with 2 or more levels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, apparently <code>manova</code> can handle less data than <code>kerneloverlap</code> can, because the only reason that crashed is because one of my fake speakers had zero tokens of <sc>pull</sc>. I’ll try it again but pooling all my data together. If there’s even just one token, it’ll actually run and return a value for you.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vowel_pair) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pillai_score =</span> <span class="fu">pillai</span>(<span class="fu">cbind</span>(F1, F2) <span class="sc">~</span> vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  vowel_pair pillai_score
  &lt;chr&gt;             &lt;dbl&gt;
1 fail fell        0.819 
2 low back         0.225 
3 pin pen          0.696 
4 pull pole        0.0687</code></pre>
</div>
</div>
<p>I’ll admit, I’m a little skeptical of a Pillai score where one of the vowels only has one token in it. And sure enough, if we look at the model output, the <em>p</em>-value is high, probably because there’s just not a lot of data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">manova</span>(<span class="fu">cbind</span>(F1, F2) <span class="sc">~</span> vowel, <span class="at">data =</span> pull_pole))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Df   Pillai approx F num Df den Df Pr(&gt;F)
vowel      1 0.068656   1.7692      2     48 0.1814
Residuals 49                                       </code></pre>
</div>
</div>
<p>So, if I could, I would still implement the data validation checks like I did with <code>bhatt</code> to ensure there’s enough data before running so that I can feel more confident about the values I’m getting, rather than getting values without any sort of warning message informing me of the potentially bad result.</p>
<p>Well, one solution is to create a separate function that <em>can</em> do the checks for sufficient data. I’ll create one called <code>pillai2</code> that actually mimics the syntax used in <code>bhatt</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>pillai2 <span class="ot">&lt;-</span> <span class="cf">function</span>(F1, F2, vowel) {</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    vowel_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(vowel) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">droplevels</span>()</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(vowel_data) <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># not zero</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">table</span>(vowel_data)) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># both vowels are represented</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">min</span>(<span class="fu">table</span>(vowel_data)) <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># there are at least 5 of each vowel</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(<span class="fu">manova</span>(<span class="fu">cbind</span>(F1, F2) <span class="sc">~</span> vowel))<span class="sc">$</span>stats[<span class="st">"vowel"</span>,<span class="st">"Pillai"</span>]</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, when I call <code>pillai2</code>, I don’t need to use <code>cbind</code> or the formula syntax. Instead, I just give it the name of the columns corresponding to my F1, F2, and vowel columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vowel_pair, fake_speaker) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pillai =</span> <span class="fu">pillai2</span>(F1, F2, vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
# Groups:   vowel_pair [4]
  vowel_pair fake_speaker pillai
  &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;
1 fail fell  Joey          0.825
2 fail fell  Stanley       0.849
3 low back   Joey          0.117
4 low back   Stanley       0.301
5 pin pen    Joey          0.731
6 pin pen    Stanley       0.708
7 pull pole  Joey         NA    
8 pull pole  Stanley      NA    </code></pre>
</div>
</div>
<p>So, yay, right? The problem with this version of the <code>pillai2</code> function is that you can’t control the MANOVA formula. So if you want to run a MANOVA that controls for things like following place of articulation, this function, <code>pillai2</code>, won’t be able to do that, unlike the previous version, <code>pillai</code>.</p>
<p>My recommendation is that if you want to add additional variables, use the original <code>pillai</code> function (not this <code>pillai2</code> that we just made) but do the data validation separately.</p>
<p>Switching gears one more time, there’s one more thing we can do to the <code>pillai</code> function to make it more robust. Right now, it assumes that the variable in your dataframe is called “vowel”. Sometimes, that might not be the case. I sometimes use “vowel_class” if I’m working with specific subsets of the data. If I run the <code>pillai</code> function as it is on a dataframe like that, it’ll crash.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">vowel_class =</span> vowel) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vowel_pair, fake_speaker) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pillai =</span> <span class="fu">pillai2</span>(F1, F2, vowel))</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in data.frame(vowel): object 'vowel' not found</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, we’ll have to add a little more robustness to the function. You could use the number <code>1</code> instead of <code>"vowel"</code> because the vowel argument is first in our formula.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>pillai <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(<span class="fu">manova</span>(...))<span class="sc">$</span>stats[<span class="dv">1</span>,<span class="st">"Pillai"</span>]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pillai</span>(<span class="fu">cbind</span>(F1, F2, dur) <span class="sc">~</span> vowel <span class="sc">+</span> plt_place <span class="sc">+</span> plt_manner <span class="sc">+</span> plt_voice, <span class="at">data =</span> low_back)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2767855</code></pre>
</div>
</div>
<p>But that assumes the vowel argument is first, which it might not always be. Here, I’ll put the <code>plt_place</code> variable first after the tilde, and you’ll notice that the result changes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>pillai <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(<span class="fu">manova</span>(...))<span class="sc">$</span>stats[<span class="dv">1</span>,<span class="st">"Pillai"</span>]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pillai</span>(<span class="fu">cbind</span>(F1, F2, dur) <span class="sc">~</span> plt_place <span class="sc">+</span> plt_manner <span class="sc">+</span> plt_voice <span class="sc">+</span> vowel, <span class="at">data =</span> low_back)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3752574</code></pre>
</div>
</div>
<p>The solution here is to either make sure the <code>vowel</code> column is first in your function or to rename whatever it is that your column is called to “vowel.” I don’t like either of those solutions personally but, yet again, I don’t really have a good solution. Using the number <code>1</code> might be slightly better than changing the column name because it doesn’t force you to change the underlying structure of your dataframe.</p>
<p>However, if you like the <code>pillai2</code> function more—the one that has some robustness already built into it but is limited to just one independent variable—you’re in luck because it actually can handle different column names already. Regardless of what my vowel column is called, when it gets passed to the function, it is temporarily renamed <code>"vowel"</code>. So, this will still work:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">this_is_a_random_long_name =</span> vowel) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vowel_pair) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pillai =</span> <span class="fu">pillai2</span>(F1, F2, this_is_a_random_long_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  vowel_pair pillai
  &lt;chr&gt;       &lt;dbl&gt;
1 fail fell   0.819
2 low back    0.225
3 pin pen     0.696
4 pull pole  NA    </code></pre>
</div>
</div>
<p>So again, there’s a toss up between <code>pillai</code>, which can handle any MANOVA function, and <code>pillai2</code> which is less error prone. Perhaps in the future I’ll be able to find a way to combine both into one super robust <code>pillai</code> function. For now, you know as much as I do.</p>
</section>
</section>
<section id="miscellaneous-material" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="miscellaneous-material">Miscellaneous material</h2>
<p>At this point, we’re done; I won’t be playing around with the functions anymore. Instead, in this last section, I’ll look at some fun tricks when using them and how to reshape the output to be more useful for you. Again, parts of this section get a little tedious and use some tricksy R stuff.</p>
<section id="combining-functions" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="combining-functions">Combining functions</h3>
<div class="page-columns page-full"><p> Sometimes, it’s a little bit silly to have both the <code>pillai2</code> function and the <code>bhatt</code> function when they’re mostly similar. So, we can actually combine them into one function, if that makes sense to you. We’ll create a new function called <code>overlap</code>. The first part is the same as both of the other functions.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">This section only works if you want to use <code>pillai2</code>. If you want to be flexible in the MANOVA formula, you’re stuck with <code>pillai</code> and you can’t really combine them like this.</span></div></div>
<p>The difference is I create a new argument called <code>method</code> and by default it’s <code>"pillai"</code>. I then do an <code>if</code> statement that basically does different things depending on what is in that <code>method</code> argument. If it’s <code>"pillai"</code>, then it’ll return the Pillai score. If it’s <code>"BA"</code> it’ll do the Bhattacharyya’s Affinity. If it’s something else, it’ll give a little warning message saying that it was an improper method and will return <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>overlap <span class="ot">&lt;-</span> <span class="cf">function</span>(F1, F2, vowel, <span class="at">method =</span> <span class="st">"pillai"</span>) {</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    vowel_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(vowel) <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">droplevels</span>()</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(vowel_data) <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># not zero</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">table</span>(vowel_data)) <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># both vowels are represented</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">min</span>(<span class="fu">table</span>(vowel_data)) <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="fu">return</span>(<span class="cn">NA</span>) <span class="co"># there are at least 5 of each vowel</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (method <span class="sc">==</span> <span class="st">"pillai"</span>) {</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summary</span>(<span class="fu">manova</span>(<span class="fu">cbind</span>(F1, F2) <span class="sc">~</span> vowel))<span class="sc">$</span>stats[<span class="st">"vowel"</span>, <span class="st">"Pillai"</span>]</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (method <span class="sc">==</span> <span class="st">"BA"</span>) {</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>        adehabitatHR<span class="sc">::</span><span class="fu">kerneloverlap</span>(sp<span class="sc">::</span><span class="fu">SpatialPointsDataFrame</span>(<span class="fu">cbind</span>(F1, F2), vowel_data), <span class="at">method=</span><span class="st">'BA'</span>)[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">"Improper method"</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result is that we just have one function, <code>overlap</code>, that takes care of both measurements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vowel_pair, fake_speaker) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pillai =</span> <span class="fu">overlap</span>(F1, F2, vowel),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">bhatt  =</span> <span class="fu">overlap</span>(F1, F2, vowel, <span class="at">method =</span> <span class="st">"BA"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
# Groups:   vowel_pair [4]
  vowel_pair fake_speaker pillai   bhatt
  &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;
1 fail fell  Joey          0.825  0.124 
2 fail fell  Stanley       0.849  0.0830
3 low back   Joey          0.117  0.892 
4 low back   Stanley       0.301  0.728 
5 pin pen    Joey          0.731  0.291 
6 pin pen    Stanley       0.708  0.453 
7 pull pole  Joey         NA     NA     
8 pull pole  Stanley      NA     NA     </code></pre>
</div>
</div>
<p>This is kinda cool I guess. If you like that better, go for it. But if you like the <code>bhatt</code> and <code>pillai2</code> functions better, use those instead.</p>
<p>Now, if you wanted to get <em>really</em> fancy, you could have the best of both worlds. You could retain the <code>pillai2</code> and <code>bhatt</code> functions for the user, but under the hood they actually do the same thing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>pillai2 <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">overlap</span>(..., <span class="at">method =</span> <span class="st">"pillai"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>bhatt <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">overlap</span>(..., <span class="at">method =</span> <span class="st">"BA"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>all_pairs <span class="sc">%&gt;%</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vowel_pair, fake_speaker) <span class="sc">%&gt;%</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pillai =</span> <span class="fu">pillai2</span>(F1, F2, vowel),</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">bhatt  =</span> <span class="fu">bhatt</span>(F1, F2, vowel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
# Groups:   vowel_pair [4]
  vowel_pair fake_speaker pillai   bhatt
  &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;
1 fail fell  Joey          0.825  0.124 
2 fail fell  Stanley       0.849  0.0830
3 low back   Joey          0.117  0.892 
4 low back   Stanley       0.301  0.728 
5 pin pen    Joey          0.731  0.291 
6 pin pen    Stanley       0.708  0.453 
7 pull pole  Joey         NA     NA     
8 pull pole  Stanley      NA     NA     </code></pre>
</div>
</div>
<div class="page-columns page-full"><p> If I were to put together an R package with these functions, I’d do something like that. It’s easiest to maintain while still being user-friendly.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Incidentally, if you want to help me create an R package with all this stuff, let’s talk.</span></div></div>
</section>
</section>
<section id="reshape-and-visualize" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="reshape-and-visualize">Reshape and visualize</h2>
<p>The last thing I’ll do in this lengthy tutorial is to look at how make a couple visualizations for pillai scores and how to transform your data along the way. But, this is best illustrated with more speakers, so I’m going to do take my data and duplicate it a bunch of times to simulate the effect of a larger sample. I’ll then randomly divide that data up into eight fake speakers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>fake_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(all_pairs, all_pairs, all_pairs, all_pairs, all_pairs, all_pairs, all_pairs, all_pairs) <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(vowel_pair <span class="sc">!=</span> <span class="st">"pull pole"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">fake_speaker =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Andy"</span>, <span class="st">"Betty"</span>, <span class="st">"Chuck"</span>, <span class="st">"Dolly"</span>, <span class="st">"Earl"</span>, <span class="st">"Flo"</span>, <span class="st">"Gary"</span>, <span class="st">"Helga"</span>), <span class="fu">nrow</span>(.), <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_n</span>(fake_data, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   vowel_pair vowel        word  dur    F1     F2 fol_seg plt_manner
1    low back    AA   DOCUMENTS 0.10 623.6 1200.6       K       stop
2     pin pen    EH  IDENTIFIED 0.05 489.4 1707.0       N      nasal
3    low back    AA         FOX 0.07 633.4 1102.7       K       stop
4     pin pen    EH DEMONSTRATE 0.05 420.2 1549.5       M      nasal
5     pin pen    IH     WINNING 0.05 377.2 1678.3       N      nasal
6    low back    AA        BODY 0.11 682.6 1103.2       D       stop
7     pin pen    EH      MENTAL 0.06 570.5 1678.6       N      nasal
8    low back    AA  IMPOSSIBLE 0.09 576.5 1042.1       S  fricative
9    low back    AO       AWFUL 0.13 624.2 1101.2       F  fricative
10   low back    AA      SOCCER 0.11 651.3 1127.5       K       stop
     plt_place plt_voice fake_speaker
1        velar voiceless         Earl
2       apical    voiced        Chuck
3        velar voiceless         Andy
4       labial    voiced         Earl
5       apical    voiced         Earl
6       apical    voiced         Earl
7       apical    voiced        Helga
8       apical voiceless         Andy
9  labiodental voiceless         Andy
10       velar voiceless         Earl</code></pre>
</div>
</div>
<p>When you run the <code>pillai</code> and <code>bhatt</code> functions, the results is a table such that each combination of speaker and vowel pair are on their own unique row.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>pillai_table <span class="ot">&lt;-</span> fake_data <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(fake_speaker, vowel_pair) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pillai =</span> <span class="fu">pillai2</span>(F1, F2, vowel))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>pillai_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
# Groups:   fake_speaker [8]
   fake_speaker vowel_pair pillai
   &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt;
 1 Andy         fail fell   0.805
 2 Andy         low back    0.265
 3 Andy         pin pen     0.712
 4 Betty        fail fell   0.883
 5 Betty        low back    0.188
 6 Betty        pin pen     0.622
 7 Chuck        fail fell   0.828
 8 Chuck        low back    0.236
 9 Chuck        pin pen     0.645
10 Dolly        fail fell   0.801
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>This structure may be handy for some types of visualizations. For example, you can make a plot like this which shows the spread of Pillai scores across each vowel pair. I’ve underlaid a violin plot so you can see the distribution a little better.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pillai_table, <span class="fu">aes</span>(vowel_pair, pillai)) <span class="sc">+</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>(<span class="at">color =</span> <span class="st">"gray75"</span>) <span class="sc">+</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> fake_speaker))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="page-columns page-full"><p>But you may need to rearrange your data in a different way. For example, you may want just one speaker per row and each vowel pair in its own column. Fortunately, the <code>tidyr</code> package has a really handy function called <code>spread</code> that’ll do this. There are two arguments to <code>spread</code>:</p><div class="no-row-height column-margin column-container"><span class="margin-aside">I explain this <code>spread</code> function in a little more detail in my second <a href="making-vowel-plots-in-r-part-2">tutorial</a> on plotting formant data.</span></div></div>
<ol type="1">
<li><p>The name of the column whose values you want to spread out into their own columns. In our case, the <code>vowel_pair</code> column contains the four different pairs.</p></li>
<li><p>The name of the existing columns whose values you want to be contained in the new columns. In our case, the <code>pillai</code> column contains all those numbers and we want those numbers to fill the cells of the new columns being created.</p></li>
</ol>
<p>So, if we put it together, this is what we get.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>pillai_table_wide <span class="ot">&lt;-</span> pillai_table <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">spread</span>(vowel_pair, pillai)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>pillai_table_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
# Groups:   fake_speaker [8]
  fake_speaker `fail fell` `low back` `pin pen`
  &lt;chr&gt;              &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
1 Andy               0.805      0.265     0.712
2 Betty              0.883      0.188     0.622
3 Chuck              0.828      0.236     0.645
4 Dolly              0.801      0.282     0.796
5 Earl               0.828      0.284     0.769
6 Flo                0.849      0.229     0.663
7 Gary               0.827      0.194     0.668
8 Helga              0.803      0.244     0.709</code></pre>
</div>
</div>
<p>Now, with our data reshaped in this way, we could do a scatterplot to see the correlation between two mergers:</p>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="margin-aside">There are ticks around <code>low back</code> and <code>pin pen</code> because those are the column names themselves and when you refer to column names that have spaces in them you have to surround them with ticks. These show up in the plot itself, but you can fix that with <a href="https://ggplot2.tidyverse.org/reference/labs.html"><code>labs</code></a>.</span></div></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pillai_table_wide, <span class="fu">aes</span>(<span class="st">`</span><span class="at">low back</span><span class="st">`</span>, <span class="st">`</span><span class="at">pin pen</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> fake_speaker))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Because I’ve randomly split by data up, there’s really no pattern, but if you suspect a correlation between mergers in your dataset, this plot might be more informative for you.</p>
<p>Another plot you may want to see is the correlation between the Pillai score and the Bhattacharyya’s Affinity. We’ll calculate both of them at once and create an <code>overlap_table</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>overlap_table <span class="ot">&lt;-</span> fake_data <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(fake_speaker, vowel_pair) <span class="sc">%&gt;%</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">pillai =</span> <span class="fu">pillai2</span>(F1, F2, vowel),</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">bhatt  =</span> <span class="fu">bhatt</span>(F1, F2, vowel))</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>overlap_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 4
# Groups:   fake_speaker [8]
   fake_speaker vowel_pair pillai  bhatt
   &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;
 1 Andy         fail fell   0.805 0.118 
 2 Andy         low back    0.265 0.802 
 3 Andy         pin pen     0.712 0.389 
 4 Betty        fail fell   0.883 0.0817
 5 Betty        low back    0.188 0.831 
 6 Betty        pin pen     0.622 0.385 
 7 Chuck        fail fell   0.828 0.119 
 8 Chuck        low back    0.236 0.827 
 9 Chuck        pin pen     0.645 0.424 
10 Dolly        fail fell   0.801 0.128 
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>Now, with this table, we can do another scatterplot, but pitting the two measurements against each other. We’d expect a negative correlation since overlap in Pillai means a 0 and in Bhattacharyya’s Affinity it means 1. But can we find anything that stands out? Here, I’ll plot all the data, but color the names by vowel pair.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(overlap_table, <span class="fu">aes</span>(pillai, bhatt, <span class="at">color =</span> vowel_pair)) <span class="sc">+</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> fake_speaker))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So this is kind of cool. For the low back merger, the distribution is tight and there’s not a lot going on. For the other two, they’re more spread out. We don’t see too many points straying too far from the line, so there’s not a lot of concern here. Maybe because it’s just a bunch of random samples of my own data it’s not particularly enlightening. Perhaps if you try this on your own data, you might find some interesting differences between the two measurements, which will require some digging.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>So that’s it. In this post I covered more of the nitty-gritty detail on a couple topics relating to getting vowel overlap measurements in R. As you can tell, there are some residual problems, like coming up with one function that is flexible enough to allow for any MANOVA formula but still allow for data validation. But the once those formulas are written, you can do some pretty cool stuff in just a couple lines of code. Plus, the visuals are straightforward to implement. Hopefully, thanks to this tutorial, the coding itself is no longer a barrier for you if you’ve been meaning to get vowel overlap measurements for your data.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/joeystanley\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>